{"ast":null,"code":"function _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport api from '../api';\nimport { CancelToken, isCancel } from 'axios';\nimport { throttle } from 'lodash';\nimport { search as emojiSearch } from '../features/emoji/emoji_mart_search_light';\nimport { tagHistory } from '../settings';\nimport { useEmoji } from './emojis';\nimport resizeImage from '../utils/resize_image';\nimport { importFetchedAccounts } from './importer';\nimport { updateTimeline } from './timelines';\nimport { showAlertForError } from './alerts';\nimport { showAlert } from './alerts';\nimport { defineMessages } from 'react-intl';\nvar cancelFetchComposeSuggestionsAccounts, cancelFetchComposeSuggestionsTags;\nexport var COMPOSE_CHANGE = 'COMPOSE_CHANGE';\nexport var COMPOSE_SUBMIT_REQUEST = 'COMPOSE_SUBMIT_REQUEST';\nexport var COMPOSE_SUBMIT_SUCCESS = 'COMPOSE_SUBMIT_SUCCESS';\nexport var COMPOSE_SUBMIT_FAIL = 'COMPOSE_SUBMIT_FAIL';\nexport var COMPOSE_REPLY = 'COMPOSE_REPLY';\nexport var COMPOSE_REPLY_CANCEL = 'COMPOSE_REPLY_CANCEL';\nexport var COMPOSE_DIRECT = 'COMPOSE_DIRECT';\nexport var COMPOSE_MENTION = 'COMPOSE_MENTION';\nexport var COMPOSE_RESET = 'COMPOSE_RESET';\nexport var COMPOSE_UPLOAD_REQUEST = 'COMPOSE_UPLOAD_REQUEST';\nexport var COMPOSE_UPLOAD_SUCCESS = 'COMPOSE_UPLOAD_SUCCESS';\nexport var COMPOSE_UPLOAD_FAIL = 'COMPOSE_UPLOAD_FAIL';\nexport var COMPOSE_UPLOAD_PROGRESS = 'COMPOSE_UPLOAD_PROGRESS';\nexport var COMPOSE_UPLOAD_UNDO = 'COMPOSE_UPLOAD_UNDO';\nexport var THUMBNAIL_UPLOAD_REQUEST = 'THUMBNAIL_UPLOAD_REQUEST';\nexport var THUMBNAIL_UPLOAD_SUCCESS = 'THUMBNAIL_UPLOAD_SUCCESS';\nexport var THUMBNAIL_UPLOAD_FAIL = 'THUMBNAIL_UPLOAD_FAIL';\nexport var THUMBNAIL_UPLOAD_PROGRESS = 'THUMBNAIL_UPLOAD_PROGRESS';\nexport var COMPOSE_SUGGESTIONS_CLEAR = 'COMPOSE_SUGGESTIONS_CLEAR';\nexport var COMPOSE_SUGGESTIONS_READY = 'COMPOSE_SUGGESTIONS_READY';\nexport var COMPOSE_SUGGESTION_SELECT = 'COMPOSE_SUGGESTION_SELECT';\nexport var COMPOSE_SUGGESTION_TAGS_UPDATE = 'COMPOSE_SUGGESTION_TAGS_UPDATE';\nexport var COMPOSE_TAG_HISTORY_UPDATE = 'COMPOSE_TAG_HISTORY_UPDATE';\nexport var COMPOSE_MOUNT = 'COMPOSE_MOUNT';\nexport var COMPOSE_UNMOUNT = 'COMPOSE_UNMOUNT';\nexport var COMPOSE_SENSITIVITY_CHANGE = 'COMPOSE_SENSITIVITY_CHANGE';\nexport var COMPOSE_SPOILERNESS_CHANGE = 'COMPOSE_SPOILERNESS_CHANGE';\nexport var COMPOSE_SPOILER_TEXT_CHANGE = 'COMPOSE_SPOILER_TEXT_CHANGE';\nexport var COMPOSE_VISIBILITY_CHANGE = 'COMPOSE_VISIBILITY_CHANGE';\nexport var COMPOSE_LISTABILITY_CHANGE = 'COMPOSE_LISTABILITY_CHANGE';\nexport var COMPOSE_COMPOSING_CHANGE = 'COMPOSE_COMPOSING_CHANGE';\nexport var COMPOSE_EMOJI_INSERT = 'COMPOSE_EMOJI_INSERT';\nexport var COMPOSE_UPLOAD_CHANGE_REQUEST = 'COMPOSE_UPLOAD_UPDATE_REQUEST';\nexport var COMPOSE_UPLOAD_CHANGE_SUCCESS = 'COMPOSE_UPLOAD_UPDATE_SUCCESS';\nexport var COMPOSE_UPLOAD_CHANGE_FAIL = 'COMPOSE_UPLOAD_UPDATE_FAIL';\nexport var COMPOSE_POLL_ADD = 'COMPOSE_POLL_ADD';\nexport var COMPOSE_POLL_REMOVE = 'COMPOSE_POLL_REMOVE';\nexport var COMPOSE_POLL_OPTION_ADD = 'COMPOSE_POLL_OPTION_ADD';\nexport var COMPOSE_POLL_OPTION_CHANGE = 'COMPOSE_POLL_OPTION_CHANGE';\nexport var COMPOSE_POLL_OPTION_REMOVE = 'COMPOSE_POLL_OPTION_REMOVE';\nexport var COMPOSE_POLL_SETTINGS_CHANGE = 'COMPOSE_POLL_SETTINGS_CHANGE';\nvar messages = defineMessages({\n  uploadErrorLimit: {\n    \"id\": \"upload_error.limit\",\n    \"defaultMessage\": \"File upload limit exceeded.\"\n  },\n  uploadErrorPoll: {\n    \"id\": \"upload_error.poll\",\n    \"defaultMessage\": \"File upload not allowed with polls.\"\n  }\n});\nvar COMPOSE_PANEL_BREAKPOINT = 600 + 285 * 1 + 10 * 1;\nexport var ensureComposeIsVisible = function ensureComposeIsVisible(getState, routerHistory) {\n  if (!getState().getIn(['compose', 'mounted']) && window.innerWidth < COMPOSE_PANEL_BREAKPOINT) {\n    routerHistory.push('/statuses/new');\n  }\n};\nexport function changeCompose(text) {\n  return {\n    type: COMPOSE_CHANGE,\n    text: text\n  };\n}\n;\nexport function replyCompose(status, routerHistory) {\n  return function (dispatch, getState) {\n    dispatch({\n      type: COMPOSE_REPLY,\n      status: status\n    });\n    ensureComposeIsVisible(getState, routerHistory);\n  };\n}\n;\nexport function cancelReplyCompose() {\n  return {\n    type: COMPOSE_REPLY_CANCEL\n  };\n}\n;\nexport function resetCompose() {\n  return {\n    type: COMPOSE_RESET\n  };\n}\n;\nexport function mentionCompose(account, routerHistory) {\n  return function (dispatch, getState) {\n    dispatch({\n      type: COMPOSE_MENTION,\n      account: account\n    });\n    ensureComposeIsVisible(getState, routerHistory);\n  };\n}\n;\nexport function directCompose(account, routerHistory) {\n  return function (dispatch, getState) {\n    dispatch({\n      type: COMPOSE_DIRECT,\n      account: account\n    });\n    ensureComposeIsVisible(getState, routerHistory);\n  };\n}\n;\nexport function submitCompose(routerHistory) {\n  return function (dispatch, getState) {\n    var status = getState().getIn(['compose', 'text'], '');\n    var media = getState().getIn(['compose', 'media_attachments']);\n\n    if ((!status || !status.length) && media.size === 0) {\n      return;\n    }\n\n    dispatch(submitComposeRequest());\n    api(getState).post('/api/v1/statuses', {\n      status,\n      in_reply_to_id: getState().getIn(['compose', 'in_reply_to'], null),\n      media_ids: media.map(function (item) {\n        return item.get('id');\n      }),\n      sensitive: getState().getIn(['compose', 'sensitive']),\n      spoiler_text: getState().getIn(['compose', 'spoiler']) ? getState().getIn(['compose', 'spoiler_text'], '') : '',\n      visibility: getState().getIn(['compose', 'privacy']),\n      poll: getState().getIn(['compose', 'poll'], null)\n    }, {\n      headers: {\n        'Idempotency-Key': getState().getIn(['compose', 'idempotencyKey'])\n      }\n    }).then(function (response) {\n      if (routerHistory && routerHistory.location.pathname === '/statuses/new' && window.history.state) {\n        routerHistory.goBack();\n      }\n\n      dispatch(insertIntoTagHistory(response.data.tags, status));\n      dispatch(submitComposeSuccess(_extends({}, response.data))); // To make the app more responsive, immediately push the status\n      // into the columns\n\n      var insertIfOnline = function insertIfOnline(timelineId) {\n        var timeline = getState().getIn(['timelines', timelineId]);\n\n        if (timeline && timeline.get('items').size > 0 && timeline.getIn(['items', 0]) !== null && timeline.get('online')) {\n          dispatch(updateTimeline(timelineId, _extends({}, response.data)));\n        }\n      };\n\n      if (response.data.visibility !== 'direct') {\n        insertIfOnline('home');\n      }\n\n      if (response.data.in_reply_to_id === null && response.data.visibility === 'public') {\n        insertIfOnline('community');\n        insertIfOnline('public');\n        insertIfOnline(\"account:\" + response.data.account.id);\n      }\n    }).catch(function (error) {\n      dispatch(submitComposeFail(error));\n    });\n  };\n}\n;\nexport function submitComposeRequest() {\n  return {\n    type: COMPOSE_SUBMIT_REQUEST\n  };\n}\n;\nexport function submitComposeSuccess(status) {\n  return {\n    type: COMPOSE_SUBMIT_SUCCESS,\n    status: status\n  };\n}\n;\nexport function submitComposeFail(error) {\n  return {\n    type: COMPOSE_SUBMIT_FAIL,\n    error: error\n  };\n}\n;\nexport function uploadCompose(files) {\n  return function (dispatch, getState) {\n    var uploadLimit = 4;\n    var media = getState().getIn(['compose', 'media_attachments']);\n    var pending = getState().getIn(['compose', 'pending_media_attachments']);\n    var progress = new Array(files.length).fill(0);\n    var total = Array.from(files).reduce(function (a, v) {\n      return a + v.size;\n    }, 0);\n\n    if (files.length + media.size + pending > uploadLimit) {\n      dispatch(showAlert(undefined, messages.uploadErrorLimit));\n      return;\n    }\n\n    if (getState().getIn(['compose', 'poll'])) {\n      dispatch(showAlert(undefined, messages.uploadErrorPoll));\n      return;\n    }\n\n    dispatch(uploadComposeRequest());\n\n    var _loop = function _loop() {\n      var _step$value = _step.value,\n          i = _step$value[0],\n          f = _step$value[1];\n      if (media.size + i > 3) return \"break\";\n      resizeImage(f).then(function (file) {\n        var data = new FormData();\n        data.append('file', file); // Account for disparity in size of original image and resized data\n\n        total += file.size - f.size;\n        return api(getState).post('/api/v2/media', data, {\n          onUploadProgress: function onUploadProgress(_ref) {\n            var loaded = _ref.loaded;\n            progress[i] = loaded;\n            dispatch(uploadComposeProgress(progress.reduce(function (a, v) {\n              return a + v;\n            }, 0), total));\n          }\n        }).then(function (_ref2) {\n          var status = _ref2.status,\n              data = _ref2.data;\n\n          // If server-side processing of the media attachment has not completed yet,\n          // poll the server until it is, before showing the media attachment as uploaded\n          if (status === 200) {\n            dispatch(uploadComposeSuccess(data, f));\n          } else if (status === 202) {\n            var poll = function poll() {\n              api(getState).get(\"/api/v1/media/\" + data.id).then(function (response) {\n                if (response.status === 200) {\n                  dispatch(uploadComposeSuccess(response.data, f));\n                } else if (response.status === 206) {\n                  setTimeout(function () {\n                    return poll();\n                  }, 1000);\n                }\n              }).catch(function (error) {\n                return dispatch(uploadComposeFail(error));\n              });\n            };\n\n            poll();\n          }\n        });\n      }).catch(function (error) {\n        return dispatch(uploadComposeFail(error));\n      });\n    };\n\n    for (var _iterator = _createForOfIteratorHelperLoose(Array.from(files).entries()), _step; !(_step = _iterator()).done;) {\n      var _ret = _loop();\n\n      if (_ret === \"break\") break;\n    }\n\n    ;\n  };\n}\n;\nexport var uploadThumbnail = function uploadThumbnail(id, file) {\n  return function (dispatch, getState) {\n    dispatch(uploadThumbnailRequest());\n    var total = file.size;\n    var data = new FormData();\n    data.append('thumbnail', file);\n    api(getState).put(\"/api/v1/media/\" + id, data, {\n      onUploadProgress: function onUploadProgress(_ref3) {\n        var loaded = _ref3.loaded;\n        dispatch(uploadThumbnailProgress(loaded, total));\n      }\n    }).then(function (_ref4) {\n      var data = _ref4.data;\n      dispatch(uploadThumbnailSuccess(data));\n    }).catch(function (error) {\n      dispatch(uploadThumbnailFail(id, error));\n    });\n  };\n};\nexport var uploadThumbnailRequest = function uploadThumbnailRequest() {\n  return {\n    type: THUMBNAIL_UPLOAD_REQUEST,\n    skipLoading: true\n  };\n};\nexport var uploadThumbnailProgress = function uploadThumbnailProgress(loaded, total) {\n  return {\n    type: THUMBNAIL_UPLOAD_PROGRESS,\n    loaded,\n    total,\n    skipLoading: true\n  };\n};\nexport var uploadThumbnailSuccess = function uploadThumbnailSuccess(media) {\n  return {\n    type: THUMBNAIL_UPLOAD_SUCCESS,\n    media,\n    skipLoading: true\n  };\n};\nexport var uploadThumbnailFail = function uploadThumbnailFail(error) {\n  return {\n    type: THUMBNAIL_UPLOAD_FAIL,\n    error,\n    skipLoading: true\n  };\n};\nexport function changeUploadCompose(id, params) {\n  return function (dispatch, getState) {\n    dispatch(changeUploadComposeRequest());\n    api(getState).put(\"/api/v1/media/\" + id, params).then(function (response) {\n      dispatch(changeUploadComposeSuccess(response.data));\n    }).catch(function (error) {\n      dispatch(changeUploadComposeFail(id, error));\n    });\n  };\n}\n;\nexport function changeUploadComposeRequest() {\n  return {\n    type: COMPOSE_UPLOAD_CHANGE_REQUEST,\n    skipLoading: true\n  };\n}\n;\nexport function changeUploadComposeSuccess(media) {\n  return {\n    type: COMPOSE_UPLOAD_CHANGE_SUCCESS,\n    media: media,\n    skipLoading: true\n  };\n}\n;\nexport function changeUploadComposeFail(error) {\n  return {\n    type: COMPOSE_UPLOAD_CHANGE_FAIL,\n    error: error,\n    skipLoading: true\n  };\n}\n;\nexport function uploadComposeRequest() {\n  return {\n    type: COMPOSE_UPLOAD_REQUEST,\n    skipLoading: true\n  };\n}\n;\nexport function uploadComposeProgress(loaded, total) {\n  return {\n    type: COMPOSE_UPLOAD_PROGRESS,\n    loaded: loaded,\n    total: total\n  };\n}\n;\nexport function uploadComposeSuccess(media, file) {\n  return {\n    type: COMPOSE_UPLOAD_SUCCESS,\n    media: media,\n    file: file,\n    skipLoading: true\n  };\n}\n;\nexport function uploadComposeFail(error) {\n  return {\n    type: COMPOSE_UPLOAD_FAIL,\n    error: error,\n    skipLoading: true\n  };\n}\n;\nexport function undoUploadCompose(media_id) {\n  return {\n    type: COMPOSE_UPLOAD_UNDO,\n    media_id: media_id\n  };\n}\n;\nexport function clearComposeSuggestions() {\n  if (cancelFetchComposeSuggestionsAccounts) {\n    cancelFetchComposeSuggestionsAccounts();\n  }\n\n  return {\n    type: COMPOSE_SUGGESTIONS_CLEAR\n  };\n}\n;\nvar fetchComposeSuggestionsAccounts = throttle(function (dispatch, getState, token) {\n  if (cancelFetchComposeSuggestionsAccounts) {\n    cancelFetchComposeSuggestionsAccounts();\n  }\n\n  api(getState).get('/api/v1/accounts/search', {\n    cancelToken: new CancelToken(function (cancel) {\n      cancelFetchComposeSuggestionsAccounts = cancel;\n    }),\n    params: {\n      q: token.slice(1),\n      resolve: false,\n      limit: 4\n    }\n  }).then(function (response) {\n    dispatch(importFetchedAccounts(response.data));\n    dispatch(readyComposeSuggestionsAccounts(token, response.data));\n  }).catch(function (error) {\n    if (!isCancel(error)) {\n      dispatch(showAlertForError(error));\n    }\n  });\n}, 200, {\n  leading: true,\n  trailing: true\n});\n\nvar fetchComposeSuggestionsEmojis = function fetchComposeSuggestionsEmojis(dispatch, getState, token) {\n  var results = emojiSearch(token.replace(':', ''), {\n    maxResults: 5\n  });\n  dispatch(readyComposeSuggestionsEmojis(token, results));\n};\n\nvar fetchComposeSuggestionsTags = throttle(function (dispatch, getState, token) {\n  if (cancelFetchComposeSuggestionsTags) {\n    cancelFetchComposeSuggestionsTags();\n  }\n\n  dispatch(updateSuggestionTags(token));\n  api(getState).get('/api/v2/search', {\n    cancelToken: new CancelToken(function (cancel) {\n      cancelFetchComposeSuggestionsTags = cancel;\n    }),\n    params: {\n      type: 'hashtags',\n      q: token.slice(1),\n      resolve: false,\n      limit: 4,\n      exclude_unreviewed: true\n    }\n  }).then(function (_ref5) {\n    var data = _ref5.data;\n    dispatch(readyComposeSuggestionsTags(token, data.hashtags));\n  }).catch(function (error) {\n    if (!isCancel(error)) {\n      dispatch(showAlertForError(error));\n    }\n  });\n}, 200, {\n  leading: true,\n  trailing: true\n});\nexport function fetchComposeSuggestions(token) {\n  return function (dispatch, getState) {\n    switch (token[0]) {\n      case ':':\n        fetchComposeSuggestionsEmojis(dispatch, getState, token);\n        break;\n\n      case '#':\n        fetchComposeSuggestionsTags(dispatch, getState, token);\n        break;\n\n      default:\n        fetchComposeSuggestionsAccounts(dispatch, getState, token);\n        break;\n    }\n  };\n}\n;\nexport function readyComposeSuggestionsEmojis(token, emojis) {\n  return {\n    type: COMPOSE_SUGGESTIONS_READY,\n    token,\n    emojis\n  };\n}\n;\nexport function readyComposeSuggestionsAccounts(token, accounts) {\n  return {\n    type: COMPOSE_SUGGESTIONS_READY,\n    token,\n    accounts\n  };\n}\n;\nexport var readyComposeSuggestionsTags = function readyComposeSuggestionsTags(token, tags) {\n  return {\n    type: COMPOSE_SUGGESTIONS_READY,\n    token,\n    tags\n  };\n};\nexport function selectComposeSuggestion(position, token, suggestion, path) {\n  return function (dispatch, getState) {\n    var completion, startPosition;\n\n    if (suggestion.type === 'emoji') {\n      completion = suggestion.native || suggestion.colons;\n      startPosition = position - 1;\n      dispatch(useEmoji(suggestion));\n    } else if (suggestion.type === 'hashtag') {\n      completion = \"#\" + suggestion.name;\n      startPosition = position - 1;\n    } else if (suggestion.type === 'account') {\n      completion = getState().getIn(['accounts', suggestion.id, 'acct']);\n      startPosition = position;\n    }\n\n    dispatch({\n      type: COMPOSE_SUGGESTION_SELECT,\n      position: startPosition,\n      token,\n      completion,\n      path\n    });\n  };\n}\n;\nexport function updateSuggestionTags(token) {\n  return {\n    type: COMPOSE_SUGGESTION_TAGS_UPDATE,\n    token\n  };\n}\nexport function updateTagHistory(tags) {\n  return {\n    type: COMPOSE_TAG_HISTORY_UPDATE,\n    tags\n  };\n}\nexport function hydrateCompose() {\n  return function (dispatch, getState) {\n    var me = getState().getIn(['meta', 'me']);\n    var history = tagHistory.get(me);\n\n    if (history !== null) {\n      dispatch(updateTagHistory(history));\n    }\n  };\n}\n\nfunction insertIntoTagHistory(recognizedTags, text) {\n  return function (dispatch, getState) {\n    var state = getState();\n    var oldHistory = state.getIn(['compose', 'tagHistory']);\n    var me = state.getIn(['meta', 'me']);\n    var names = recognizedTags.map(function (tag) {\n      return text.match(new RegExp(\"#\" + tag.name, 'i'))[0].slice(1);\n    });\n    var intersectedOldHistory = oldHistory.filter(function (name) {\n      return names.findIndex(function (newName) {\n        return newName.toLowerCase() === name.toLowerCase();\n      }) === -1;\n    });\n    names.push.apply(names, intersectedOldHistory.toJS());\n    var newHistory = names.slice(0, 1000);\n    tagHistory.set(me, newHistory);\n    dispatch(updateTagHistory(newHistory));\n  };\n}\n\nexport function mountCompose() {\n  return {\n    type: COMPOSE_MOUNT\n  };\n}\n;\nexport function unmountCompose() {\n  return {\n    type: COMPOSE_UNMOUNT\n  };\n}\n;\nexport function changeComposeSensitivity() {\n  return {\n    type: COMPOSE_SENSITIVITY_CHANGE\n  };\n}\n;\nexport function changeComposeSpoilerness() {\n  return {\n    type: COMPOSE_SPOILERNESS_CHANGE\n  };\n}\n;\nexport function changeComposeSpoilerText(text) {\n  return {\n    type: COMPOSE_SPOILER_TEXT_CHANGE,\n    text\n  };\n}\n;\nexport function changeComposeVisibility(value) {\n  return {\n    type: COMPOSE_VISIBILITY_CHANGE,\n    value\n  };\n}\n;\nexport function insertEmojiCompose(position, emoji, needsSpace) {\n  return {\n    type: COMPOSE_EMOJI_INSERT,\n    position,\n    emoji,\n    needsSpace\n  };\n}\n;\nexport function changeComposing(value) {\n  return {\n    type: COMPOSE_COMPOSING_CHANGE,\n    value\n  };\n}\n;\nexport function addPoll() {\n  return {\n    type: COMPOSE_POLL_ADD\n  };\n}\n;\nexport function removePoll() {\n  return {\n    type: COMPOSE_POLL_REMOVE\n  };\n}\n;\nexport function addPollOption(title) {\n  return {\n    type: COMPOSE_POLL_OPTION_ADD,\n    title\n  };\n}\n;\nexport function changePollOption(index, title) {\n  return {\n    type: COMPOSE_POLL_OPTION_CHANGE,\n    index,\n    title\n  };\n}\n;\nexport function removePollOption(index) {\n  return {\n    type: COMPOSE_POLL_OPTION_REMOVE,\n    index\n  };\n}\n;\nexport function changePollSettings(expiresIn, isMultiple) {\n  return {\n    type: COMPOSE_POLL_SETTINGS_CHANGE,\n    expiresIn,\n    isMultiple\n  };\n}\n;","map":{"version":3,"sources":["/home/runner/Mastodon/live/app/javascript/mastodon/actions/compose.js"],"names":["api","CancelToken","isCancel","throttle","search","emojiSearch","tagHistory","useEmoji","resizeImage","importFetchedAccounts","updateTimeline","showAlertForError","showAlert","defineMessages","cancelFetchComposeSuggestionsAccounts","cancelFetchComposeSuggestionsTags","COMPOSE_CHANGE","COMPOSE_SUBMIT_REQUEST","COMPOSE_SUBMIT_SUCCESS","COMPOSE_SUBMIT_FAIL","COMPOSE_REPLY","COMPOSE_REPLY_CANCEL","COMPOSE_DIRECT","COMPOSE_MENTION","COMPOSE_RESET","COMPOSE_UPLOAD_REQUEST","COMPOSE_UPLOAD_SUCCESS","COMPOSE_UPLOAD_FAIL","COMPOSE_UPLOAD_PROGRESS","COMPOSE_UPLOAD_UNDO","THUMBNAIL_UPLOAD_REQUEST","THUMBNAIL_UPLOAD_SUCCESS","THUMBNAIL_UPLOAD_FAIL","THUMBNAIL_UPLOAD_PROGRESS","COMPOSE_SUGGESTIONS_CLEAR","COMPOSE_SUGGESTIONS_READY","COMPOSE_SUGGESTION_SELECT","COMPOSE_SUGGESTION_TAGS_UPDATE","COMPOSE_TAG_HISTORY_UPDATE","COMPOSE_MOUNT","COMPOSE_UNMOUNT","COMPOSE_SENSITIVITY_CHANGE","COMPOSE_SPOILERNESS_CHANGE","COMPOSE_SPOILER_TEXT_CHANGE","COMPOSE_VISIBILITY_CHANGE","COMPOSE_LISTABILITY_CHANGE","COMPOSE_COMPOSING_CHANGE","COMPOSE_EMOJI_INSERT","COMPOSE_UPLOAD_CHANGE_REQUEST","COMPOSE_UPLOAD_CHANGE_SUCCESS","COMPOSE_UPLOAD_CHANGE_FAIL","COMPOSE_POLL_ADD","COMPOSE_POLL_REMOVE","COMPOSE_POLL_OPTION_ADD","COMPOSE_POLL_OPTION_CHANGE","COMPOSE_POLL_OPTION_REMOVE","COMPOSE_POLL_SETTINGS_CHANGE","messages","uploadErrorLimit","uploadErrorPoll","COMPOSE_PANEL_BREAKPOINT","ensureComposeIsVisible","getState","routerHistory","getIn","window","innerWidth","push","changeCompose","text","type","replyCompose","status","dispatch","cancelReplyCompose","resetCompose","mentionCompose","account","directCompose","submitCompose","media","length","size","submitComposeRequest","post","in_reply_to_id","media_ids","map","item","get","sensitive","spoiler_text","visibility","poll","headers","then","response","location","pathname","history","state","goBack","insertIntoTagHistory","data","tags","submitComposeSuccess","insertIfOnline","timelineId","timeline","id","catch","error","submitComposeFail","uploadCompose","files","uploadLimit","pending","progress","Array","fill","total","from","reduce","a","v","undefined","uploadComposeRequest","i","f","file","FormData","append","onUploadProgress","loaded","uploadComposeProgress","uploadComposeSuccess","setTimeout","uploadComposeFail","entries","uploadThumbnail","uploadThumbnailRequest","put","uploadThumbnailProgress","uploadThumbnailSuccess","uploadThumbnailFail","skipLoading","changeUploadCompose","params","changeUploadComposeRequest","changeUploadComposeSuccess","changeUploadComposeFail","undoUploadCompose","media_id","clearComposeSuggestions","fetchComposeSuggestionsAccounts","token","cancelToken","cancel","q","slice","resolve","limit","readyComposeSuggestionsAccounts","leading","trailing","fetchComposeSuggestionsEmojis","results","replace","maxResults","readyComposeSuggestionsEmojis","fetchComposeSuggestionsTags","updateSuggestionTags","exclude_unreviewed","readyComposeSuggestionsTags","hashtags","fetchComposeSuggestions","emojis","accounts","selectComposeSuggestion","position","suggestion","path","completion","startPosition","native","colons","name","updateTagHistory","hydrateCompose","me","recognizedTags","oldHistory","names","tag","match","RegExp","intersectedOldHistory","filter","findIndex","newName","toLowerCase","toJS","newHistory","set","mountCompose","unmountCompose","changeComposeSensitivity","changeComposeSpoilerness","changeComposeSpoilerText","changeComposeVisibility","value","insertEmojiCompose","emoji","needsSpace","changeComposing","addPoll","removePoll","addPollOption","title","changePollOption","index","removePollOption","changePollSettings","expiresIn","isMultiple"],"mappings":"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","sourcesContent":["import api from '../api';\nimport { CancelToken, isCancel } from 'axios';\nimport { throttle } from 'lodash';\nimport { search as emojiSearch } from '../features/emoji/emoji_mart_search_light';\nimport { tagHistory } from '../settings';\nimport { useEmoji } from './emojis';\nimport resizeImage from '../utils/resize_image';\nimport { importFetchedAccounts } from './importer';\nimport { updateTimeline } from './timelines';\nimport { showAlertForError } from './alerts';\nimport { showAlert } from './alerts';\nimport { defineMessages } from 'react-intl';\n\nlet cancelFetchComposeSuggestionsAccounts, cancelFetchComposeSuggestionsTags;\n\nexport const COMPOSE_CHANGE          = 'COMPOSE_CHANGE';\nexport const COMPOSE_SUBMIT_REQUEST  = 'COMPOSE_SUBMIT_REQUEST';\nexport const COMPOSE_SUBMIT_SUCCESS  = 'COMPOSE_SUBMIT_SUCCESS';\nexport const COMPOSE_SUBMIT_FAIL     = 'COMPOSE_SUBMIT_FAIL';\nexport const COMPOSE_REPLY           = 'COMPOSE_REPLY';\nexport const COMPOSE_REPLY_CANCEL    = 'COMPOSE_REPLY_CANCEL';\nexport const COMPOSE_DIRECT          = 'COMPOSE_DIRECT';\nexport const COMPOSE_MENTION         = 'COMPOSE_MENTION';\nexport const COMPOSE_RESET           = 'COMPOSE_RESET';\nexport const COMPOSE_UPLOAD_REQUEST  = 'COMPOSE_UPLOAD_REQUEST';\nexport const COMPOSE_UPLOAD_SUCCESS  = 'COMPOSE_UPLOAD_SUCCESS';\nexport const COMPOSE_UPLOAD_FAIL     = 'COMPOSE_UPLOAD_FAIL';\nexport const COMPOSE_UPLOAD_PROGRESS = 'COMPOSE_UPLOAD_PROGRESS';\nexport const COMPOSE_UPLOAD_UNDO     = 'COMPOSE_UPLOAD_UNDO';\n\nexport const THUMBNAIL_UPLOAD_REQUEST  = 'THUMBNAIL_UPLOAD_REQUEST';\nexport const THUMBNAIL_UPLOAD_SUCCESS  = 'THUMBNAIL_UPLOAD_SUCCESS';\nexport const THUMBNAIL_UPLOAD_FAIL     = 'THUMBNAIL_UPLOAD_FAIL';\nexport const THUMBNAIL_UPLOAD_PROGRESS = 'THUMBNAIL_UPLOAD_PROGRESS';\n\nexport const COMPOSE_SUGGESTIONS_CLEAR = 'COMPOSE_SUGGESTIONS_CLEAR';\nexport const COMPOSE_SUGGESTIONS_READY = 'COMPOSE_SUGGESTIONS_READY';\nexport const COMPOSE_SUGGESTION_SELECT = 'COMPOSE_SUGGESTION_SELECT';\nexport const COMPOSE_SUGGESTION_TAGS_UPDATE = 'COMPOSE_SUGGESTION_TAGS_UPDATE';\n\nexport const COMPOSE_TAG_HISTORY_UPDATE = 'COMPOSE_TAG_HISTORY_UPDATE';\n\nexport const COMPOSE_MOUNT   = 'COMPOSE_MOUNT';\nexport const COMPOSE_UNMOUNT = 'COMPOSE_UNMOUNT';\n\nexport const COMPOSE_SENSITIVITY_CHANGE = 'COMPOSE_SENSITIVITY_CHANGE';\nexport const COMPOSE_SPOILERNESS_CHANGE = 'COMPOSE_SPOILERNESS_CHANGE';\nexport const COMPOSE_SPOILER_TEXT_CHANGE = 'COMPOSE_SPOILER_TEXT_CHANGE';\nexport const COMPOSE_VISIBILITY_CHANGE  = 'COMPOSE_VISIBILITY_CHANGE';\nexport const COMPOSE_LISTABILITY_CHANGE = 'COMPOSE_LISTABILITY_CHANGE';\nexport const COMPOSE_COMPOSING_CHANGE = 'COMPOSE_COMPOSING_CHANGE';\n\nexport const COMPOSE_EMOJI_INSERT = 'COMPOSE_EMOJI_INSERT';\n\nexport const COMPOSE_UPLOAD_CHANGE_REQUEST     = 'COMPOSE_UPLOAD_UPDATE_REQUEST';\nexport const COMPOSE_UPLOAD_CHANGE_SUCCESS     = 'COMPOSE_UPLOAD_UPDATE_SUCCESS';\nexport const COMPOSE_UPLOAD_CHANGE_FAIL        = 'COMPOSE_UPLOAD_UPDATE_FAIL';\n\nexport const COMPOSE_POLL_ADD             = 'COMPOSE_POLL_ADD';\nexport const COMPOSE_POLL_REMOVE          = 'COMPOSE_POLL_REMOVE';\nexport const COMPOSE_POLL_OPTION_ADD      = 'COMPOSE_POLL_OPTION_ADD';\nexport const COMPOSE_POLL_OPTION_CHANGE   = 'COMPOSE_POLL_OPTION_CHANGE';\nexport const COMPOSE_POLL_OPTION_REMOVE   = 'COMPOSE_POLL_OPTION_REMOVE';\nexport const COMPOSE_POLL_SETTINGS_CHANGE = 'COMPOSE_POLL_SETTINGS_CHANGE';\n\nconst messages = defineMessages({\n  uploadErrorLimit: { id: 'upload_error.limit', defaultMessage: 'File upload limit exceeded.' },\n  uploadErrorPoll:  { id: 'upload_error.poll', defaultMessage: 'File upload not allowed with polls.' },\n});\n\nconst COMPOSE_PANEL_BREAKPOINT = 600 + (285 * 1) + (10 * 1);\n\nexport const ensureComposeIsVisible = (getState, routerHistory) => {\n  if (!getState().getIn(['compose', 'mounted']) && window.innerWidth < COMPOSE_PANEL_BREAKPOINT) {\n    routerHistory.push('/statuses/new');\n  }\n};\n\nexport function changeCompose(text) {\n  return {\n    type: COMPOSE_CHANGE,\n    text: text,\n  };\n};\n\nexport function replyCompose(status, routerHistory) {\n  return (dispatch, getState) => {\n    dispatch({\n      type: COMPOSE_REPLY,\n      status: status,\n    });\n\n    ensureComposeIsVisible(getState, routerHistory);\n  };\n};\n\nexport function cancelReplyCompose() {\n  return {\n    type: COMPOSE_REPLY_CANCEL,\n  };\n};\n\nexport function resetCompose() {\n  return {\n    type: COMPOSE_RESET,\n  };\n};\n\nexport function mentionCompose(account, routerHistory) {\n  return (dispatch, getState) => {\n    dispatch({\n      type: COMPOSE_MENTION,\n      account: account,\n    });\n\n    ensureComposeIsVisible(getState, routerHistory);\n  };\n};\n\nexport function directCompose(account, routerHistory) {\n  return (dispatch, getState) => {\n    dispatch({\n      type: COMPOSE_DIRECT,\n      account: account,\n    });\n\n    ensureComposeIsVisible(getState, routerHistory);\n  };\n};\n\nexport function submitCompose(routerHistory) {\n  return function (dispatch, getState) {\n    const status = getState().getIn(['compose', 'text'], '');\n    const media  = getState().getIn(['compose', 'media_attachments']);\n\n    if ((!status || !status.length) && media.size === 0) {\n      return;\n    }\n\n    dispatch(submitComposeRequest());\n\n    api(getState).post('/api/v1/statuses', {\n      status,\n      in_reply_to_id: getState().getIn(['compose', 'in_reply_to'], null),\n      media_ids: media.map(item => item.get('id')),\n      sensitive: getState().getIn(['compose', 'sensitive']),\n      spoiler_text: getState().getIn(['compose', 'spoiler']) ? getState().getIn(['compose', 'spoiler_text'], '') : '',\n      visibility: getState().getIn(['compose', 'privacy']),\n      poll: getState().getIn(['compose', 'poll'], null),\n    }, {\n      headers: {\n        'Idempotency-Key': getState().getIn(['compose', 'idempotencyKey']),\n      },\n    }).then(function (response) {\n      if (routerHistory && routerHistory.location.pathname === '/statuses/new' && window.history.state) {\n        routerHistory.goBack();\n      }\n\n      dispatch(insertIntoTagHistory(response.data.tags, status));\n      dispatch(submitComposeSuccess({ ...response.data }));\n\n      // To make the app more responsive, immediately push the status\n      // into the columns\n      const insertIfOnline = timelineId => {\n        const timeline = getState().getIn(['timelines', timelineId]);\n\n        if (timeline && timeline.get('items').size > 0 && timeline.getIn(['items', 0]) !== null && timeline.get('online')) {\n          dispatch(updateTimeline(timelineId, { ...response.data }));\n        }\n      };\n\n      if (response.data.visibility !== 'direct') {\n        insertIfOnline('home');\n      }\n\n      if (response.data.in_reply_to_id === null && response.data.visibility === 'public') {\n        insertIfOnline('community');\n        insertIfOnline('public');\n        insertIfOnline(`account:${response.data.account.id}`);\n      }\n    }).catch(function (error) {\n      dispatch(submitComposeFail(error));\n    });\n  };\n};\n\nexport function submitComposeRequest() {\n  return {\n    type: COMPOSE_SUBMIT_REQUEST,\n  };\n};\n\nexport function submitComposeSuccess(status) {\n  return {\n    type: COMPOSE_SUBMIT_SUCCESS,\n    status: status,\n  };\n};\n\nexport function submitComposeFail(error) {\n  return {\n    type: COMPOSE_SUBMIT_FAIL,\n    error: error,\n  };\n};\n\nexport function uploadCompose(files) {\n  return function (dispatch, getState) {\n    const uploadLimit = 4;\n    const media  = getState().getIn(['compose', 'media_attachments']);\n    const pending  = getState().getIn(['compose', 'pending_media_attachments']);\n    const progress = new Array(files.length).fill(0);\n    let total = Array.from(files).reduce((a, v) => a + v.size, 0);\n\n    if (files.length + media.size + pending > uploadLimit) {\n      dispatch(showAlert(undefined, messages.uploadErrorLimit));\n      return;\n    }\n\n    if (getState().getIn(['compose', 'poll'])) {\n      dispatch(showAlert(undefined, messages.uploadErrorPoll));\n      return;\n    }\n\n    dispatch(uploadComposeRequest());\n\n    for (const [i, f] of Array.from(files).entries()) {\n      if (media.size + i > 3) break;\n\n      resizeImage(f).then(file => {\n        const data = new FormData();\n        data.append('file', file);\n        // Account for disparity in size of original image and resized data\n        total += file.size - f.size;\n\n        return api(getState).post('/api/v2/media', data, {\n          onUploadProgress: function({ loaded }){\n            progress[i] = loaded;\n            dispatch(uploadComposeProgress(progress.reduce((a, v) => a + v, 0), total));\n          },\n        }).then(({ status, data }) => {\n          // If server-side processing of the media attachment has not completed yet,\n          // poll the server until it is, before showing the media attachment as uploaded\n\n          if (status === 200) {\n            dispatch(uploadComposeSuccess(data, f));\n          } else if (status === 202) {\n            const poll = () => {\n              api(getState).get(`/api/v1/media/${data.id}`).then(response => {\n                if (response.status === 200) {\n                  dispatch(uploadComposeSuccess(response.data, f));\n                } else if (response.status === 206) {\n                  setTimeout(() => poll(), 1000);\n                }\n              }).catch(error => dispatch(uploadComposeFail(error)));\n            };\n\n            poll();\n          }\n        });\n      }).catch(error => dispatch(uploadComposeFail(error)));\n    };\n  };\n};\n\nexport const uploadThumbnail = (id, file) => (dispatch, getState) => {\n  dispatch(uploadThumbnailRequest());\n\n  const total = file.size;\n  const data = new FormData();\n\n  data.append('thumbnail', file);\n\n  api(getState).put(`/api/v1/media/${id}`, data, {\n    onUploadProgress: ({ loaded }) => {\n      dispatch(uploadThumbnailProgress(loaded, total));\n    },\n  }).then(({ data }) => {\n    dispatch(uploadThumbnailSuccess(data));\n  }).catch(error => {\n    dispatch(uploadThumbnailFail(id, error));\n  });\n};\n\nexport const uploadThumbnailRequest = () => ({\n  type: THUMBNAIL_UPLOAD_REQUEST,\n  skipLoading: true,\n});\n\nexport const uploadThumbnailProgress = (loaded, total) => ({\n  type: THUMBNAIL_UPLOAD_PROGRESS,\n  loaded,\n  total,\n  skipLoading: true,\n});\n\nexport const uploadThumbnailSuccess = media => ({\n  type: THUMBNAIL_UPLOAD_SUCCESS,\n  media,\n  skipLoading: true,\n});\n\nexport const uploadThumbnailFail = error => ({\n  type: THUMBNAIL_UPLOAD_FAIL,\n  error,\n  skipLoading: true,\n});\n\nexport function changeUploadCompose(id, params) {\n  return (dispatch, getState) => {\n    dispatch(changeUploadComposeRequest());\n\n    api(getState).put(`/api/v1/media/${id}`, params).then(response => {\n      dispatch(changeUploadComposeSuccess(response.data));\n    }).catch(error => {\n      dispatch(changeUploadComposeFail(id, error));\n    });\n  };\n};\n\nexport function changeUploadComposeRequest() {\n  return {\n    type: COMPOSE_UPLOAD_CHANGE_REQUEST,\n    skipLoading: true,\n  };\n};\n\nexport function changeUploadComposeSuccess(media) {\n  return {\n    type: COMPOSE_UPLOAD_CHANGE_SUCCESS,\n    media: media,\n    skipLoading: true,\n  };\n};\n\nexport function changeUploadComposeFail(error) {\n  return {\n    type: COMPOSE_UPLOAD_CHANGE_FAIL,\n    error: error,\n    skipLoading: true,\n  };\n};\n\nexport function uploadComposeRequest() {\n  return {\n    type: COMPOSE_UPLOAD_REQUEST,\n    skipLoading: true,\n  };\n};\n\nexport function uploadComposeProgress(loaded, total) {\n  return {\n    type: COMPOSE_UPLOAD_PROGRESS,\n    loaded: loaded,\n    total: total,\n  };\n};\n\nexport function uploadComposeSuccess(media, file) {\n  return {\n    type: COMPOSE_UPLOAD_SUCCESS,\n    media: media,\n    file: file,\n    skipLoading: true,\n  };\n};\n\nexport function uploadComposeFail(error) {\n  return {\n    type: COMPOSE_UPLOAD_FAIL,\n    error: error,\n    skipLoading: true,\n  };\n};\n\nexport function undoUploadCompose(media_id) {\n  return {\n    type: COMPOSE_UPLOAD_UNDO,\n    media_id: media_id,\n  };\n};\n\nexport function clearComposeSuggestions() {\n  if (cancelFetchComposeSuggestionsAccounts) {\n    cancelFetchComposeSuggestionsAccounts();\n  }\n  return {\n    type: COMPOSE_SUGGESTIONS_CLEAR,\n  };\n};\n\nconst fetchComposeSuggestionsAccounts = throttle((dispatch, getState, token) => {\n  if (cancelFetchComposeSuggestionsAccounts) {\n    cancelFetchComposeSuggestionsAccounts();\n  }\n\n  api(getState).get('/api/v1/accounts/search', {\n    cancelToken: new CancelToken(cancel => {\n      cancelFetchComposeSuggestionsAccounts = cancel;\n    }),\n\n    params: {\n      q: token.slice(1),\n      resolve: false,\n      limit: 4,\n    },\n  }).then(response => {\n    dispatch(importFetchedAccounts(response.data));\n    dispatch(readyComposeSuggestionsAccounts(token, response.data));\n  }).catch(error => {\n    if (!isCancel(error)) {\n      dispatch(showAlertForError(error));\n    }\n  });\n}, 200, { leading: true, trailing: true });\n\nconst fetchComposeSuggestionsEmojis = (dispatch, getState, token) => {\n  const results = emojiSearch(token.replace(':', ''), { maxResults: 5 });\n  dispatch(readyComposeSuggestionsEmojis(token, results));\n};\n\nconst fetchComposeSuggestionsTags = throttle((dispatch, getState, token) => {\n  if (cancelFetchComposeSuggestionsTags) {\n    cancelFetchComposeSuggestionsTags();\n  }\n\n  dispatch(updateSuggestionTags(token));\n\n  api(getState).get('/api/v2/search', {\n    cancelToken: new CancelToken(cancel => {\n      cancelFetchComposeSuggestionsTags = cancel;\n    }),\n\n    params: {\n      type: 'hashtags',\n      q: token.slice(1),\n      resolve: false,\n      limit: 4,\n      exclude_unreviewed: true,\n    },\n  }).then(({ data }) => {\n    dispatch(readyComposeSuggestionsTags(token, data.hashtags));\n  }).catch(error => {\n    if (!isCancel(error)) {\n      dispatch(showAlertForError(error));\n    }\n  });\n}, 200, { leading: true, trailing: true });\n\nexport function fetchComposeSuggestions(token) {\n  return (dispatch, getState) => {\n    switch (token[0]) {\n    case ':':\n      fetchComposeSuggestionsEmojis(dispatch, getState, token);\n      break;\n    case '#':\n      fetchComposeSuggestionsTags(dispatch, getState, token);\n      break;\n    default:\n      fetchComposeSuggestionsAccounts(dispatch, getState, token);\n      break;\n    }\n  };\n};\n\nexport function readyComposeSuggestionsEmojis(token, emojis) {\n  return {\n    type: COMPOSE_SUGGESTIONS_READY,\n    token,\n    emojis,\n  };\n};\n\nexport function readyComposeSuggestionsAccounts(token, accounts) {\n  return {\n    type: COMPOSE_SUGGESTIONS_READY,\n    token,\n    accounts,\n  };\n};\n\nexport const readyComposeSuggestionsTags = (token, tags) => ({\n  type: COMPOSE_SUGGESTIONS_READY,\n  token,\n  tags,\n});\n\nexport function selectComposeSuggestion(position, token, suggestion, path) {\n  return (dispatch, getState) => {\n    let completion, startPosition;\n\n    if (suggestion.type === 'emoji') {\n      completion    = suggestion.native || suggestion.colons;\n      startPosition = position - 1;\n\n      dispatch(useEmoji(suggestion));\n    } else if (suggestion.type === 'hashtag') {\n      completion    = `#${suggestion.name}`;\n      startPosition = position - 1;\n    } else if (suggestion.type === 'account') {\n      completion    = getState().getIn(['accounts', suggestion.id, 'acct']);\n      startPosition = position;\n    }\n\n    dispatch({\n      type: COMPOSE_SUGGESTION_SELECT,\n      position: startPosition,\n      token,\n      completion,\n      path,\n    });\n  };\n};\n\nexport function updateSuggestionTags(token) {\n  return {\n    type: COMPOSE_SUGGESTION_TAGS_UPDATE,\n    token,\n  };\n}\n\nexport function updateTagHistory(tags) {\n  return {\n    type: COMPOSE_TAG_HISTORY_UPDATE,\n    tags,\n  };\n}\n\nexport function hydrateCompose() {\n  return (dispatch, getState) => {\n    const me = getState().getIn(['meta', 'me']);\n    const history = tagHistory.get(me);\n\n    if (history !== null) {\n      dispatch(updateTagHistory(history));\n    }\n  };\n}\n\nfunction insertIntoTagHistory(recognizedTags, text) {\n  return (dispatch, getState) => {\n    const state = getState();\n    const oldHistory = state.getIn(['compose', 'tagHistory']);\n    const me = state.getIn(['meta', 'me']);\n    const names = recognizedTags.map(tag => text.match(new RegExp(`#${tag.name}`, 'i'))[0].slice(1));\n    const intersectedOldHistory = oldHistory.filter(name => names.findIndex(newName => newName.toLowerCase() === name.toLowerCase()) === -1);\n\n    names.push(...intersectedOldHistory.toJS());\n\n    const newHistory = names.slice(0, 1000);\n\n    tagHistory.set(me, newHistory);\n    dispatch(updateTagHistory(newHistory));\n  };\n}\n\nexport function mountCompose() {\n  return {\n    type: COMPOSE_MOUNT,\n  };\n};\n\nexport function unmountCompose() {\n  return {\n    type: COMPOSE_UNMOUNT,\n  };\n};\n\nexport function changeComposeSensitivity() {\n  return {\n    type: COMPOSE_SENSITIVITY_CHANGE,\n  };\n};\n\nexport function changeComposeSpoilerness() {\n  return {\n    type: COMPOSE_SPOILERNESS_CHANGE,\n  };\n};\n\nexport function changeComposeSpoilerText(text) {\n  return {\n    type: COMPOSE_SPOILER_TEXT_CHANGE,\n    text,\n  };\n};\n\nexport function changeComposeVisibility(value) {\n  return {\n    type: COMPOSE_VISIBILITY_CHANGE,\n    value,\n  };\n};\n\nexport function insertEmojiCompose(position, emoji, needsSpace) {\n  return {\n    type: COMPOSE_EMOJI_INSERT,\n    position,\n    emoji,\n    needsSpace,\n  };\n};\n\nexport function changeComposing(value) {\n  return {\n    type: COMPOSE_COMPOSING_CHANGE,\n    value,\n  };\n};\n\nexport function addPoll() {\n  return {\n    type: COMPOSE_POLL_ADD,\n  };\n};\n\nexport function removePoll() {\n  return {\n    type: COMPOSE_POLL_REMOVE,\n  };\n};\n\nexport function addPollOption(title) {\n  return {\n    type: COMPOSE_POLL_OPTION_ADD,\n    title,\n  };\n};\n\nexport function changePollOption(index, title) {\n  return {\n    type: COMPOSE_POLL_OPTION_CHANGE,\n    index,\n    title,\n  };\n};\n\nexport function removePollOption(index) {\n  return {\n    type: COMPOSE_POLL_OPTION_REMOVE,\n    index,\n  };\n};\n\nexport function changePollSettings(expiresIn, isMultiple) {\n  return {\n    type: COMPOSE_POLL_SETTINGS_CHANGE,\n    expiresIn,\n    isMultiple,\n  };\n};\n"]},"metadata":{"react-intl":{"messages":[{"id":"upload_error.limit","defaultMessage":"File upload limit exceeded."},{"id":"upload_error.poll","defaultMessage":"File upload not allowed with polls."}]}},"sourceType":"module"}