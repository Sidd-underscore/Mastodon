{"ast":null,"code":"var _jsxFileName = \"/home/runner/Mastodon/live/app/javascript/mastodon/components/modal_root.js\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport 'wicg-inert';\nimport { createBrowserHistory } from 'history';\nimport { multiply } from 'color-blend';\n\nvar ModalRoot = /*#__PURE__*/function (_React$PureComponent) {\n  _inheritsLoose(ModalRoot, _React$PureComponent);\n\n  function ModalRoot() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$PureComponent.call.apply(_React$PureComponent, [this].concat(args)) || this;\n    _this.activeElement = _this.props.children ? document.activeElement : null;\n\n    _this.handleKeyUp = function (e) {\n      if ((e.key === 'Escape' || e.key === 'Esc' || e.keyCode === 27) && !!_this.props.children) {\n        _this.props.onClose();\n      }\n    };\n\n    _this.handleKeyDown = function (e) {\n      if (e.key === 'Tab') {\n        var focusable = Array.from(_this.node.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])')).filter(function (x) {\n          return window.getComputedStyle(x).display !== 'none';\n        });\n        var index = focusable.indexOf(e.target);\n        var element;\n\n        if (e.shiftKey) {\n          element = focusable[index - 1] || focusable[focusable.length - 1];\n        } else {\n          element = focusable[index + 1] || focusable[0];\n        }\n\n        if (element) {\n          element.focus();\n          e.stopPropagation();\n          e.preventDefault();\n        }\n      }\n    };\n\n    _this.getSiblings = function () {\n      return Array.apply(void 0, _this.node.parentElement.childNodes).filter(function (node) {\n        return node !== _this.node;\n      });\n    };\n\n    _this.setRef = function (ref) {\n      _this.node = ref;\n    };\n\n    return _this;\n  }\n\n  var _proto = ModalRoot.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    window.addEventListener('keyup', this.handleKeyUp, false);\n    window.addEventListener('keydown', this.handleKeyDown, false);\n    this.history = this.context.router ? this.context.router.history : createBrowserHistory();\n  };\n\n  _proto.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    if (!!nextProps.children && !this.props.children) {\n      this.activeElement = document.activeElement;\n      this.getSiblings().forEach(function (sibling) {\n        return sibling.setAttribute('inert', true);\n      });\n    }\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate(prevProps) {\n    var _this2 = this;\n\n    if (!this.props.children && !!prevProps.children) {\n      this.getSiblings().forEach(function (sibling) {\n        return sibling.removeAttribute('inert');\n      }); // Because of the wicg-inert polyfill, the activeElement may not be\n      // immediately selectable, we have to wait for observers to run, as\n      // described in https://github.com/WICG/inert#performance-and-gotchas\n\n      Promise.resolve().then(function () {\n        _this2.activeElement.focus({\n          preventScroll: true\n        });\n\n        _this2.activeElement = null;\n      }).catch(console.error);\n\n      this._handleModalClose();\n    }\n\n    if (this.props.children && !prevProps.children) {\n      this._handleModalOpen();\n    }\n\n    if (this.props.children) {\n      this._ensureHistoryBuffer();\n    }\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    window.removeEventListener('keyup', this.handleKeyUp);\n    window.removeEventListener('keydown', this.handleKeyDown);\n  };\n\n  _proto._handleModalOpen = function _handleModalOpen() {\n    var _this3 = this;\n\n    this._modalHistoryKey = Date.now();\n    this.unlistenHistory = this.history.listen(function (_, action) {\n      if (action === 'POP') {\n        _this3.props.onClose();\n      }\n    });\n  };\n\n  _proto._handleModalClose = function _handleModalClose() {\n    if (this.unlistenHistory) {\n      this.unlistenHistory();\n    }\n\n    var state = this.history.location.state;\n\n    if (state && state.mastodonModalKey === this._modalHistoryKey) {\n      this.history.goBack();\n    }\n  };\n\n  _proto._ensureHistoryBuffer = function _ensureHistoryBuffer() {\n    var _this$history$locatio = this.history.location,\n        pathname = _this$history$locatio.pathname,\n        state = _this$history$locatio.state;\n\n    if (!state || state.mastodonModalKey !== this._modalHistoryKey) {\n      this.history.push(pathname, _extends({}, state, {\n        mastodonModalKey: this._modalHistoryKey\n      }));\n    }\n  };\n\n  _proto.render = function render() {\n    var _this$props = this.props,\n        children = _this$props.children,\n        onClose = _this$props.onClose;\n    var visible = !!children;\n\n    if (!visible) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"modal-root\",\n        ref: this.setRef,\n        style: {\n          opacity: 0\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 9\n        }\n      });\n    }\n\n    var backgroundColor = null;\n\n    if (this.props.backgroundColor) {\n      backgroundColor = multiply(_extends({}, this.props.backgroundColor, {\n        a: 1\n      }), {\n        r: 0,\n        g: 0,\n        b: 0,\n        a: 0.7\n      });\n    }\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"modal-root\",\n      ref: this.setRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        pointerEvents: visible ? 'auto' : 'none'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      role: \"presentation\",\n      className: \"modal-root__overlay\",\n      onClick: onClose,\n      style: {\n        backgroundColor: backgroundColor ? \"rgba(\" + backgroundColor.r + \", \" + backgroundColor.g + \", \" + backgroundColor.b + \", 0.7)\" : null\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      role: \"dialog\",\n      className: \"modal-root__container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 11\n      }\n    }, children)));\n  };\n\n  return ModalRoot;\n}(React.PureComponent);\n\nModalRoot.contextTypes = {\n  router: PropTypes.object\n};\nModalRoot.propTypes = {\n  children: PropTypes.node,\n  onClose: PropTypes.func.isRequired,\n  backgroundColor: PropTypes.shape({\n    r: PropTypes.number,\n    g: PropTypes.number,\n    b: PropTypes.number\n  })\n};\nexport { ModalRoot as default };","map":{"version":3,"sources":["/home/runner/Mastodon/live/app/javascript/mastodon/components/modal_root.js"],"names":["React","PropTypes","createBrowserHistory","multiply","ModalRoot","activeElement","props","children","document","handleKeyUp","e","key","keyCode","onClose","handleKeyDown","focusable","Array","from","node","querySelectorAll","filter","x","window","getComputedStyle","display","index","indexOf","target","element","shiftKey","length","focus","stopPropagation","preventDefault","getSiblings","parentElement","childNodes","setRef","ref","componentDidMount","addEventListener","history","context","router","componentWillReceiveProps","nextProps","forEach","sibling","setAttribute","componentDidUpdate","prevProps","removeAttribute","Promise","resolve","then","preventScroll","catch","console","error","_handleModalClose","_handleModalOpen","_ensureHistoryBuffer","componentWillUnmount","removeEventListener","_modalHistoryKey","Date","now","unlistenHistory","listen","_","action","state","location","mastodonModalKey","goBack","pathname","push","render","visible","opacity","backgroundColor","a","r","g","b","pointerEvents","PureComponent","contextTypes","object","propTypes","func","isRequired","shape","number"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport 'wicg-inert';\nimport { createBrowserHistory } from 'history';\nimport { multiply } from 'color-blend';\n\nexport default class ModalRoot extends React.PureComponent {\n\n  static contextTypes = {\n    router: PropTypes.object,\n  };\n\n  static propTypes = {\n    children: PropTypes.node,\n    onClose: PropTypes.func.isRequired,\n    backgroundColor: PropTypes.shape({\n      r: PropTypes.number,\n      g: PropTypes.number,\n      b: PropTypes.number,\n    }),\n  };\n\n  activeElement = this.props.children ? document.activeElement : null;\n\n  handleKeyUp = (e) => {\n    if ((e.key === 'Escape' || e.key === 'Esc' || e.keyCode === 27)\n         && !!this.props.children) {\n      this.props.onClose();\n    }\n  }\n\n  handleKeyDown = (e) => {\n    if (e.key === 'Tab') {\n      const focusable = Array.from(this.node.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])')).filter((x) => window.getComputedStyle(x).display !== 'none');\n      const index = focusable.indexOf(e.target);\n\n      let element;\n\n      if (e.shiftKey) {\n        element = focusable[index - 1] || focusable[focusable.length - 1];\n      } else {\n        element = focusable[index + 1] || focusable[0];\n      }\n\n      if (element) {\n        element.focus();\n        e.stopPropagation();\n        e.preventDefault();\n      }\n    }\n  }\n\n  componentDidMount () {\n    window.addEventListener('keyup', this.handleKeyUp, false);\n    window.addEventListener('keydown', this.handleKeyDown, false);\n    this.history = this.context.router ? this.context.router.history : createBrowserHistory();\n  }\n\n  componentWillReceiveProps (nextProps) {\n    if (!!nextProps.children && !this.props.children) {\n      this.activeElement = document.activeElement;\n\n      this.getSiblings().forEach(sibling => sibling.setAttribute('inert', true));\n    }\n  }\n\n  componentDidUpdate (prevProps) {\n    if (!this.props.children && !!prevProps.children) {\n      this.getSiblings().forEach(sibling => sibling.removeAttribute('inert'));\n\n      // Because of the wicg-inert polyfill, the activeElement may not be\n      // immediately selectable, we have to wait for observers to run, as\n      // described in https://github.com/WICG/inert#performance-and-gotchas\n      Promise.resolve().then(() => {\n        this.activeElement.focus({ preventScroll: true });\n        this.activeElement = null;\n      }).catch(console.error);\n\n      this._handleModalClose();\n    }\n    if (this.props.children && !prevProps.children) {\n      this._handleModalOpen();\n    }\n    if (this.props.children) {\n      this._ensureHistoryBuffer();\n    }\n  }\n\n  componentWillUnmount () {\n    window.removeEventListener('keyup', this.handleKeyUp);\n    window.removeEventListener('keydown', this.handleKeyDown);\n  }\n\n  _handleModalOpen () {\n    this._modalHistoryKey = Date.now();\n    this.unlistenHistory = this.history.listen((_, action) => {\n      if (action === 'POP') {\n        this.props.onClose();\n      }\n    });\n  }\n\n  _handleModalClose () {\n    if (this.unlistenHistory) {\n      this.unlistenHistory();\n    }\n    const { state } = this.history.location;\n    if (state && state.mastodonModalKey === this._modalHistoryKey) {\n      this.history.goBack();\n    }\n  }\n\n  _ensureHistoryBuffer () {\n    const { pathname, state } = this.history.location;\n    if (!state || state.mastodonModalKey !== this._modalHistoryKey) {\n      this.history.push(pathname, { ...state, mastodonModalKey: this._modalHistoryKey });\n    }\n  }\n\n  getSiblings = () => {\n    return Array(...this.node.parentElement.childNodes).filter(node => node !== this.node);\n  }\n\n  setRef = ref => {\n    this.node = ref;\n  }\n\n  render () {\n    const { children, onClose } = this.props;\n    const visible = !!children;\n\n    if (!visible) {\n      return (\n        <div className='modal-root' ref={this.setRef} style={{ opacity: 0 }} />\n      );\n    }\n\n    let backgroundColor = null;\n\n    if (this.props.backgroundColor) {\n      backgroundColor = multiply({ ...this.props.backgroundColor, a: 1 }, { r: 0, g: 0, b: 0, a: 0.7 });\n    }\n\n    return (\n      <div className='modal-root' ref={this.setRef}>\n        <div style={{ pointerEvents: visible ? 'auto' : 'none' }}>\n          <div role='presentation' className='modal-root__overlay' onClick={onClose} style={{ backgroundColor: backgroundColor ? `rgba(${backgroundColor.r}, ${backgroundColor.g}, ${backgroundColor.b}, 0.7)` : null }} />\n          <div role='dialog' className='modal-root__container'>{children}</div>\n        </div>\n      </div>\n    );\n  }\n\n}\n"]},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module"}