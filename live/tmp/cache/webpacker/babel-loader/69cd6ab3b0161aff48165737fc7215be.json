{"ast":null,"code":"var _jsxFileName = \"/home/runner/Mastodon/live/app/javascript/mastodon/components/dropdown_menu.js\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport IconButton from './icon_button';\nimport Overlay from 'react-overlays/lib/Overlay';\nimport Motion from '../features/ui/util/optional_motion';\nimport spring from 'react-motion/lib/spring';\nimport { supportsPassiveEvents } from 'detect-passive-events';\nvar listenerOptions = supportsPassiveEvents ? {\n  passive: true\n} : false;\nvar id = 0;\n\nvar DropdownMenu = /*#__PURE__*/function (_React$PureComponent) {\n  _inheritsLoose(DropdownMenu, _React$PureComponent);\n\n  function DropdownMenu() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$PureComponent.call.apply(_React$PureComponent, [this].concat(args)) || this;\n    _this.state = {\n      mounted: false\n    };\n\n    _this.handleDocumentClick = function (e) {\n      if (_this.node && !_this.node.contains(e.target)) {\n        _this.props.onClose();\n      }\n    };\n\n    _this.setRef = function (c) {\n      _this.node = c;\n    };\n\n    _this.setFocusRef = function (c) {\n      _this.focusedItem = c;\n    };\n\n    _this.handleKeyDown = function (e) {\n      var items = Array.from(_this.node.getElementsByTagName('a'));\n      var index = items.indexOf(document.activeElement);\n      var element = null;\n\n      switch (e.key) {\n        case 'ArrowDown':\n          element = items[index + 1] || items[0];\n          break;\n\n        case 'ArrowUp':\n          element = items[index - 1] || items[items.length - 1];\n          break;\n\n        case 'Tab':\n          if (e.shiftKey) {\n            element = items[index - 1] || items[items.length - 1];\n          } else {\n            element = items[index + 1] || items[0];\n          }\n\n          break;\n\n        case 'Home':\n          element = items[0];\n          break;\n\n        case 'End':\n          element = items[items.length - 1];\n          break;\n\n        case 'Escape':\n          _this.props.onClose();\n\n          break;\n      }\n\n      if (element) {\n        element.focus();\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    };\n\n    _this.handleItemKeyPress = function (e) {\n      if (e.key === 'Enter' || e.key === ' ') {\n        _this.handleClick(e);\n      }\n    };\n\n    _this.handleClick = function (e) {\n      var i = Number(e.currentTarget.getAttribute('data-index'));\n      var _this$props$items$i = _this.props.items[i],\n          action = _this$props$items$i.action,\n          to = _this$props$items$i.to;\n\n      _this.props.onClose();\n\n      if (typeof action === 'function') {\n        e.preventDefault();\n        action(e);\n      } else if (to) {\n        e.preventDefault();\n\n        _this.context.router.history.push(to);\n      }\n    };\n\n    return _this;\n  }\n\n  var _proto = DropdownMenu.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    document.addEventListener('click', this.handleDocumentClick, false);\n    document.addEventListener('keydown', this.handleKeyDown, false);\n    document.addEventListener('touchend', this.handleDocumentClick, listenerOptions);\n\n    if (this.focusedItem && this.props.openedViaKeyboard) {\n      this.focusedItem.focus({\n        preventScroll: true\n      });\n    }\n\n    this.setState({\n      mounted: true\n    });\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    document.removeEventListener('click', this.handleDocumentClick, false);\n    document.removeEventListener('keydown', this.handleKeyDown, false);\n    document.removeEventListener('touchend', this.handleDocumentClick, listenerOptions);\n  };\n\n  _proto.renderItem = function renderItem(option, i) {\n    if (option === null) {\n      return /*#__PURE__*/React.createElement(\"li\", {\n        key: \"sep-\" + i,\n        className: \"dropdown-menu__separator\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 14\n        }\n      });\n    }\n\n    var text = option.text,\n        _option$href = option.href,\n        href = _option$href === void 0 ? '#' : _option$href,\n        _option$target = option.target,\n        target = _option$target === void 0 ? '_blank' : _option$target,\n        method = option.method;\n    return /*#__PURE__*/React.createElement(\"li\", {\n      className: \"dropdown-menu__item\",\n      key: text + \"-\" + i,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"a\", {\n      href: href,\n      target: target,\n      \"data-method\": method,\n      rel: \"noopener noreferrer\",\n      role: \"button\",\n      tabIndex: \"0\",\n      ref: i === 0 ? this.setFocusRef : null,\n      onClick: this.handleClick,\n      onKeyPress: this.handleItemKeyPress,\n      \"data-index\": i,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }\n    }, text));\n  };\n\n  _proto.render = function render() {\n    var _this2 = this;\n\n    var _this$props = this.props,\n        items = _this$props.items,\n        style = _this$props.style,\n        placement = _this$props.placement,\n        arrowOffsetLeft = _this$props.arrowOffsetLeft,\n        arrowOffsetTop = _this$props.arrowOffsetTop;\n    var mounted = this.state.mounted;\n    return /*#__PURE__*/React.createElement(Motion, {\n      defaultStyle: {\n        opacity: 0,\n        scaleX: 0.85,\n        scaleY: 0.75\n      },\n      style: {\n        opacity: spring(1, {\n          damping: 35,\n          stiffness: 400\n        }),\n        scaleX: spring(1, {\n          damping: 35,\n          stiffness: 400\n        }),\n        scaleY: spring(1, {\n          damping: 35,\n          stiffness: 400\n        })\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 7\n      }\n    }, function (_ref) {\n      var opacity = _ref.opacity,\n          scaleX = _ref.scaleX,\n          scaleY = _ref.scaleY;\n      return (\n        /*#__PURE__*/\n        // It should not be transformed when mounting because the resulting\n        // size will be used to determine the coordinate of the menu by\n        // react-overlays\n        React.createElement(\"div\", {\n          className: \"dropdown-menu \" + placement,\n          style: _extends({}, style, {\n            opacity: opacity,\n            transform: mounted ? \"scale(\" + scaleX + \", \" + scaleY + \")\" : null\n          }),\n          ref: _this2.setRef,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          className: \"dropdown-menu__arrow \" + placement,\n          style: {\n            left: arrowOffsetLeft,\n            top: arrowOffsetTop\n          },\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 13\n          }\n        }), /*#__PURE__*/React.createElement(\"ul\", {\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 155,\n            columnNumber: 13\n          }\n        }, items.map(function (option, i) {\n          return _this2.renderItem(option, i);\n        })))\n      );\n    });\n  };\n\n  return DropdownMenu;\n}(React.PureComponent);\n\nDropdownMenu.contextTypes = {\n  router: PropTypes.object\n};\nDropdownMenu.propTypes = {\n  items: PropTypes.array.isRequired,\n  onClose: PropTypes.func.isRequired,\n  style: PropTypes.object,\n  placement: PropTypes.string,\n  arrowOffsetLeft: PropTypes.string,\n  arrowOffsetTop: PropTypes.string,\n  openedViaKeyboard: PropTypes.bool\n};\nDropdownMenu.defaultProps = {\n  style: {},\n  placement: 'bottom'\n};\n\nvar Dropdown = /*#__PURE__*/function (_React$PureComponent2) {\n  _inheritsLoose(Dropdown, _React$PureComponent2);\n\n  function Dropdown() {\n    var _this3;\n\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    _this3 = _React$PureComponent2.call.apply(_React$PureComponent2, [this].concat(args)) || this;\n    _this3.state = {\n      id: id++\n    };\n\n    _this3.handleClick = function (_ref2) {\n      var target = _ref2.target,\n          type = _ref2.type;\n\n      if (_this3.state.id === _this3.props.openDropdownId) {\n        _this3.handleClose();\n      } else {\n        var _target$getBoundingCl = target.getBoundingClientRect(),\n            top = _target$getBoundingCl.top;\n\n        var placement = top * 2 < innerHeight ? 'bottom' : 'top';\n\n        _this3.props.onOpen(_this3.state.id, _this3.handleItemClick, placement, type !== 'click');\n      }\n    };\n\n    _this3.handleClose = function () {\n      if (_this3.activeElement) {\n        _this3.activeElement.focus({\n          preventScroll: true\n        });\n\n        _this3.activeElement = null;\n      }\n\n      _this3.props.onClose(_this3.state.id);\n    };\n\n    _this3.handleMouseDown = function () {\n      if (!_this3.state.open) {\n        _this3.activeElement = document.activeElement;\n      }\n    };\n\n    _this3.handleButtonKeyDown = function (e) {\n      switch (e.key) {\n        case ' ':\n        case 'Enter':\n          _this3.handleMouseDown();\n\n          break;\n      }\n    };\n\n    _this3.handleKeyPress = function (e) {\n      switch (e.key) {\n        case ' ':\n        case 'Enter':\n          _this3.handleClick(e);\n\n          e.stopPropagation();\n          e.preventDefault();\n          break;\n      }\n    };\n\n    _this3.handleItemClick = function (e) {\n      var i = Number(e.currentTarget.getAttribute('data-index'));\n      var _this3$props$items$i = _this3.props.items[i],\n          action = _this3$props$items$i.action,\n          to = _this3$props$items$i.to;\n\n      _this3.handleClose();\n\n      if (typeof action === 'function') {\n        e.preventDefault();\n        action();\n      } else if (to) {\n        e.preventDefault();\n\n        _this3.context.router.history.push(to);\n      }\n    };\n\n    _this3.setTargetRef = function (c) {\n      _this3.target = c;\n    };\n\n    _this3.findTarget = function () {\n      return _this3.target;\n    };\n\n    _this3.componentWillUnmount = function () {\n      if (_this3.state.id === _this3.props.openDropdownId) {\n        _this3.handleClose();\n      }\n    };\n\n    return _this3;\n  }\n\n  var _proto2 = Dropdown.prototype;\n\n  _proto2.render = function render() {\n    var _this$props2 = this.props,\n        icon = _this$props2.icon,\n        items = _this$props2.items,\n        size = _this$props2.size,\n        title = _this$props2.title,\n        disabled = _this$props2.disabled,\n        dropdownPlacement = _this$props2.dropdownPlacement,\n        openDropdownId = _this$props2.openDropdownId,\n        openedViaKeyboard = _this$props2.openedViaKeyboard;\n    var open = this.state.id === openDropdownId;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(IconButton, {\n      icon: icon,\n      title: title,\n      active: open,\n      disabled: disabled,\n      size: size,\n      ref: this.setTargetRef,\n      onClick: this.handleClick,\n      onMouseDown: this.handleMouseDown,\n      onKeyDown: this.handleButtonKeyDown,\n      onKeyPress: this.handleKeyPress,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(Overlay, {\n      show: open,\n      placement: dropdownPlacement,\n      target: this.findTarget,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(DropdownMenu, {\n      items: items,\n      onClose: this.handleClose,\n      openedViaKeyboard: openedViaKeyboard,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 11\n      }\n    })));\n  };\n\n  return Dropdown;\n}(React.PureComponent);\n\nDropdown.contextTypes = {\n  router: PropTypes.object\n};\nDropdown.propTypes = {\n  icon: PropTypes.string.isRequired,\n  items: PropTypes.array.isRequired,\n  size: PropTypes.number.isRequired,\n  title: PropTypes.string,\n  disabled: PropTypes.bool,\n  status: ImmutablePropTypes.map,\n  isUserTouching: PropTypes.func,\n  onOpen: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  dropdownPlacement: PropTypes.string,\n  openDropdownId: PropTypes.number,\n  openedViaKeyboard: PropTypes.bool\n};\nDropdown.defaultProps = {\n  title: 'Menu'\n};\nexport { Dropdown as default };","map":{"version":3,"sources":["/home/runner/Mastodon/live/app/javascript/mastodon/components/dropdown_menu.js"],"names":["React","PropTypes","ImmutablePropTypes","IconButton","Overlay","Motion","spring","supportsPassiveEvents","listenerOptions","passive","id","DropdownMenu","state","mounted","handleDocumentClick","e","node","contains","target","props","onClose","setRef","c","setFocusRef","focusedItem","handleKeyDown","items","Array","from","getElementsByTagName","index","indexOf","document","activeElement","element","key","length","shiftKey","focus","preventDefault","stopPropagation","handleItemKeyPress","handleClick","i","Number","currentTarget","getAttribute","action","to","context","router","history","push","componentDidMount","addEventListener","openedViaKeyboard","preventScroll","setState","componentWillUnmount","removeEventListener","renderItem","option","text","href","method","render","style","placement","arrowOffsetLeft","arrowOffsetTop","opacity","scaleX","scaleY","damping","stiffness","transform","left","top","map","PureComponent","contextTypes","object","propTypes","array","isRequired","func","string","bool","defaultProps","Dropdown","type","openDropdownId","handleClose","getBoundingClientRect","innerHeight","onOpen","handleItemClick","handleMouseDown","open","handleButtonKeyDown","handleKeyPress","setTargetRef","findTarget","icon","size","title","disabled","dropdownPlacement","number","status","isUserTouching"],"mappings":";;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,kBAAP,MAA+B,2BAA/B;AACA,OAAOC,UAAP,MAAuB,eAAvB;AACA,OAAOC,OAAP,MAAoB,4BAApB;AACA,OAAOC,MAAP,MAAmB,qCAAnB;AACA,OAAOC,MAAP,MAAmB,yBAAnB;AACA,SAASC,qBAAT,QAAsC,uBAAtC;AAEA,IAAMC,eAAe,GAAGD,qBAAqB,GAAG;AAAEE,EAAAA,OAAO,EAAE;AAAX,CAAH,GAAuB,KAApE;AACA,IAAIC,EAAE,GAAG,CAAT;;IAEMC,Y;;;;;;;;;;;UAqBJC,K,GAAQ;AACNC,MAAAA,OAAO,EAAE;AADH,K;;UAIRC,mB,GAAsB,UAAAC,CAAC,EAAI;AACzB,UAAI,MAAKC,IAAL,IAAa,CAAC,MAAKA,IAAL,CAAUC,QAAV,CAAmBF,CAAC,CAACG,MAArB,CAAlB,EAAgD;AAC9C,cAAKC,KAAL,CAAWC,OAAX;AACD;AACF,K;;UAkBDC,M,GAAS,UAAAC,CAAC,EAAI;AACZ,YAAKN,IAAL,GAAYM,CAAZ;AACD,K;;UAEDC,W,GAAc,UAAAD,CAAC,EAAI;AACjB,YAAKE,WAAL,GAAmBF,CAAnB;AACD,K;;UAEDG,a,GAAgB,UAAAV,CAAC,EAAI;AACnB,UAAMW,KAAK,GAAGC,KAAK,CAACC,IAAN,CAAW,MAAKZ,IAAL,CAAUa,oBAAV,CAA+B,GAA/B,CAAX,CAAd;AACA,UAAMC,KAAK,GAAGJ,KAAK,CAACK,OAAN,CAAcC,QAAQ,CAACC,aAAvB,CAAd;AACA,UAAIC,OAAO,GAAG,IAAd;;AAEA,cAAOnB,CAAC,CAACoB,GAAT;AACA,aAAK,WAAL;AACED,UAAAA,OAAO,GAAGR,KAAK,CAACI,KAAK,GAAC,CAAP,CAAL,IAAkBJ,KAAK,CAAC,CAAD,CAAjC;AACA;;AACF,aAAK,SAAL;AACEQ,UAAAA,OAAO,GAAGR,KAAK,CAACI,KAAK,GAAC,CAAP,CAAL,IAAkBJ,KAAK,CAACA,KAAK,CAACU,MAAN,GAAa,CAAd,CAAjC;AACA;;AACF,aAAK,KAAL;AACE,cAAIrB,CAAC,CAACsB,QAAN,EAAgB;AACdH,YAAAA,OAAO,GAAGR,KAAK,CAACI,KAAK,GAAC,CAAP,CAAL,IAAkBJ,KAAK,CAACA,KAAK,CAACU,MAAN,GAAa,CAAd,CAAjC;AACD,WAFD,MAEO;AACLF,YAAAA,OAAO,GAAGR,KAAK,CAACI,KAAK,GAAC,CAAP,CAAL,IAAkBJ,KAAK,CAAC,CAAD,CAAjC;AACD;;AACD;;AACF,aAAK,MAAL;AACEQ,UAAAA,OAAO,GAAGR,KAAK,CAAC,CAAD,CAAf;AACA;;AACF,aAAK,KAAL;AACEQ,UAAAA,OAAO,GAAGR,KAAK,CAACA,KAAK,CAACU,MAAN,GAAa,CAAd,CAAf;AACA;;AACF,aAAK,QAAL;AACE,gBAAKjB,KAAL,CAAWC,OAAX;;AACA;AAtBF;;AAyBA,UAAIc,OAAJ,EAAa;AACXA,QAAAA,OAAO,CAACI,KAAR;AACAvB,QAAAA,CAAC,CAACwB,cAAF;AACAxB,QAAAA,CAAC,CAACyB,eAAF;AACD;AACF,K;;UAEDC,kB,GAAqB,UAAA1B,CAAC,EAAI;AACxB,UAAIA,CAAC,CAACoB,GAAF,KAAU,OAAV,IAAqBpB,CAAC,CAACoB,GAAF,KAAU,GAAnC,EAAwC;AACtC,cAAKO,WAAL,CAAiB3B,CAAjB;AACD;AACF,K;;UAED2B,W,GAAc,UAAA3B,CAAC,EAAI;AACjB,UAAM4B,CAAC,GAAGC,MAAM,CAAC7B,CAAC,CAAC8B,aAAF,CAAgBC,YAAhB,CAA6B,YAA7B,CAAD,CAAhB;AACA,gCAAuB,MAAK3B,KAAL,CAAWO,KAAX,CAAiBiB,CAAjB,CAAvB;AAAA,UAAQI,MAAR,uBAAQA,MAAR;AAAA,UAAgBC,EAAhB,uBAAgBA,EAAhB;;AAEA,YAAK7B,KAAL,CAAWC,OAAX;;AAEA,UAAI,OAAO2B,MAAP,KAAkB,UAAtB,EAAkC;AAChChC,QAAAA,CAAC,CAACwB,cAAF;AACAQ,QAAAA,MAAM,CAAChC,CAAD,CAAN;AACD,OAHD,MAGO,IAAIiC,EAAJ,EAAQ;AACbjC,QAAAA,CAAC,CAACwB,cAAF;;AACA,cAAKU,OAAL,CAAaC,MAAb,CAAoBC,OAApB,CAA4BC,IAA5B,CAAiCJ,EAAjC;AACD;AACF,K;;;;;;;SAhFDK,iB,GAAA,6BAAqB;AACnBrB,IAAAA,QAAQ,CAACsB,gBAAT,CAA0B,OAA1B,EAAmC,KAAKxC,mBAAxC,EAA6D,KAA7D;AACAkB,IAAAA,QAAQ,CAACsB,gBAAT,CAA0B,SAA1B,EAAqC,KAAK7B,aAA1C,EAAyD,KAAzD;AACAO,IAAAA,QAAQ,CAACsB,gBAAT,CAA0B,UAA1B,EAAsC,KAAKxC,mBAA3C,EAAgEN,eAAhE;;AACA,QAAI,KAAKgB,WAAL,IAAoB,KAAKL,KAAL,CAAWoC,iBAAnC,EAAsD;AACpD,WAAK/B,WAAL,CAAiBc,KAAjB,CAAuB;AAAEkB,QAAAA,aAAa,EAAE;AAAjB,OAAvB;AACD;;AACD,SAAKC,QAAL,CAAc;AAAE5C,MAAAA,OAAO,EAAE;AAAX,KAAd;AACD,G;;SAED6C,oB,GAAA,gCAAwB;AACtB1B,IAAAA,QAAQ,CAAC2B,mBAAT,CAA6B,OAA7B,EAAsC,KAAK7C,mBAA3C,EAAgE,KAAhE;AACAkB,IAAAA,QAAQ,CAAC2B,mBAAT,CAA6B,SAA7B,EAAwC,KAAKlC,aAA7C,EAA4D,KAA5D;AACAO,IAAAA,QAAQ,CAAC2B,mBAAT,CAA6B,UAA7B,EAAyC,KAAK7C,mBAA9C,EAAmEN,eAAnE;AACD,G;;SAoEDoD,U,GAAA,oBAAYC,MAAZ,EAAoBlB,CAApB,EAAuB;AACrB,QAAIkB,MAAM,KAAK,IAAf,EAAqB;AACnB,0BAAO;AAAI,QAAA,GAAG,WAASlB,CAAhB;AAAqB,QAAA,SAAS,EAAC,0BAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAP;AACD;;AAED,QAAQmB,IAAR,GAAwDD,MAAxD,CAAQC,IAAR;AAAA,uBAAwDD,MAAxD,CAAcE,IAAd;AAAA,QAAcA,IAAd,6BAAqB,GAArB;AAAA,yBAAwDF,MAAxD,CAA0B3C,MAA1B;AAAA,QAA0BA,MAA1B,+BAAmC,QAAnC;AAAA,QAA6C8C,MAA7C,GAAwDH,MAAxD,CAA6CG,MAA7C;AAEA,wBACE;AAAI,MAAA,SAAS,EAAC,qBAAd;AAAoC,MAAA,GAAG,EAAKF,IAAL,SAAanB,CAApD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAG,MAAA,IAAI,EAAEoB,IAAT;AAAe,MAAA,MAAM,EAAE7C,MAAvB;AAA+B,qBAAa8C,MAA5C;AAAoD,MAAA,GAAG,EAAC,qBAAxD;AAA8E,MAAA,IAAI,EAAC,QAAnF;AAA4F,MAAA,QAAQ,EAAC,GAArG;AAAyG,MAAA,GAAG,EAAErB,CAAC,KAAK,CAAN,GAAU,KAAKpB,WAAf,GAA6B,IAA3I;AAAiJ,MAAA,OAAO,EAAE,KAAKmB,WAA/J;AAA4K,MAAA,UAAU,EAAE,KAAKD,kBAA7L;AAAiN,oBAAYE,CAA7N;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGmB,IADH,CADF,CADF;AAOD,G;;SAEDG,M,GAAA,kBAAU;AAAA;;AACR,sBAAqE,KAAK9C,KAA1E;AAAA,QAAQO,KAAR,eAAQA,KAAR;AAAA,QAAewC,KAAf,eAAeA,KAAf;AAAA,QAAsBC,SAAtB,eAAsBA,SAAtB;AAAA,QAAiCC,eAAjC,eAAiCA,eAAjC;AAAA,QAAkDC,cAAlD,eAAkDA,cAAlD;AACA,QAAQxD,OAAR,GAAoB,KAAKD,KAAzB,CAAQC,OAAR;AAEA,wBACE,oBAAC,MAAD;AAAQ,MAAA,YAAY,EAAE;AAAEyD,QAAAA,OAAO,EAAE,CAAX;AAAcC,QAAAA,MAAM,EAAE,IAAtB;AAA4BC,QAAAA,MAAM,EAAE;AAApC,OAAtB;AAAkE,MAAA,KAAK,EAAE;AAAEF,QAAAA,OAAO,EAAEhE,MAAM,CAAC,CAAD,EAAI;AAAEmE,UAAAA,OAAO,EAAE,EAAX;AAAeC,UAAAA,SAAS,EAAE;AAA1B,SAAJ,CAAjB;AAAuDH,QAAAA,MAAM,EAAEjE,MAAM,CAAC,CAAD,EAAI;AAAEmE,UAAAA,OAAO,EAAE,EAAX;AAAeC,UAAAA,SAAS,EAAE;AAA1B,SAAJ,CAArE;AAA2GF,QAAAA,MAAM,EAAElE,MAAM,CAAC,CAAD,EAAI;AAAEmE,UAAAA,OAAO,EAAE,EAAX;AAAeC,UAAAA,SAAS,EAAE;AAA1B,SAAJ;AAAzH,OAAzE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG;AAAA,UAAGJ,OAAH,QAAGA,OAAH;AAAA,UAAYC,MAAZ,QAAYA,MAAZ;AAAA,UAAoBC,MAApB,QAAoBA,MAApB;AAAA;AAAA;AACC;AACA;AACA;AACA;AAAK,UAAA,SAAS,qBAAmBL,SAAjC;AAA8C,UAAA,KAAK,eAAOD,KAAP;AAAcI,YAAAA,OAAO,EAAEA,OAAvB;AAAgCK,YAAAA,SAAS,EAAE9D,OAAO,cAAY0D,MAAZ,UAAuBC,MAAvB,SAAmC;AAArF,YAAnD;AAAgJ,UAAA,GAAG,EAAE,MAAI,CAACnD,MAA1J;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBACE;AAAK,UAAA,SAAS,4BAA0B8C,SAAxC;AAAqD,UAAA,KAAK,EAAE;AAAES,YAAAA,IAAI,EAAER,eAAR;AAAyBS,YAAAA,GAAG,EAAER;AAA9B,WAA5D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACG3C,KAAK,CAACoD,GAAN,CAAU,UAACjB,MAAD,EAASlB,CAAT;AAAA,iBAAe,MAAI,CAACiB,UAAL,CAAgBC,MAAhB,EAAwBlB,CAAxB,CAAf;AAAA,SAAV,CADH,CAHF;AAJD;AAAA,KADH,CADF;AAgBD,G;;;EArJwB3C,KAAK,CAAC+E,a;;AAA3BpE,Y,CAEGqE,Y,GAAe;AACpB9B,EAAAA,MAAM,EAAEjD,SAAS,CAACgF;AADE,C;AAFlBtE,Y,CAMGuE,S,GAAY;AACjBxD,EAAAA,KAAK,EAAEzB,SAAS,CAACkF,KAAV,CAAgBC,UADN;AAEjBhE,EAAAA,OAAO,EAAEnB,SAAS,CAACoF,IAAV,CAAeD,UAFP;AAGjBlB,EAAAA,KAAK,EAAEjE,SAAS,CAACgF,MAHA;AAIjBd,EAAAA,SAAS,EAAElE,SAAS,CAACqF,MAJJ;AAKjBlB,EAAAA,eAAe,EAAEnE,SAAS,CAACqF,MALV;AAMjBjB,EAAAA,cAAc,EAAEpE,SAAS,CAACqF,MANT;AAOjB/B,EAAAA,iBAAiB,EAAEtD,SAAS,CAACsF;AAPZ,C;AANf5E,Y,CAgBG6E,Y,GAAe;AACpBtB,EAAAA,KAAK,EAAE,EADa;AAEpBC,EAAAA,SAAS,EAAE;AAFS,C;;IAyIHsB,Q;;;;;;;;;;;WAyBnB7E,K,GAAQ;AACNF,MAAAA,EAAE,EAAEA,EAAE;AADA,K;;WAIRgC,W,GAAc,iBAAsB;AAAA,UAAnBxB,MAAmB,SAAnBA,MAAmB;AAAA,UAAXwE,IAAW,SAAXA,IAAW;;AAClC,UAAI,OAAK9E,KAAL,CAAWF,EAAX,KAAkB,OAAKS,KAAL,CAAWwE,cAAjC,EAAiD;AAC/C,eAAKC,WAAL;AACD,OAFD,MAEO;AACL,oCAAgB1E,MAAM,CAAC2E,qBAAP,EAAhB;AAAA,YAAQhB,GAAR,yBAAQA,GAAR;;AACA,YAAMV,SAAS,GAAGU,GAAG,GAAG,CAAN,GAAUiB,WAAV,GAAwB,QAAxB,GAAmC,KAArD;;AACA,eAAK3E,KAAL,CAAW4E,MAAX,CAAkB,OAAKnF,KAAL,CAAWF,EAA7B,EAAiC,OAAKsF,eAAtC,EAAuD7B,SAAvD,EAAkEuB,IAAI,KAAK,OAA3E;AACD;AACF,K;;WAEDE,W,GAAc,YAAM;AAClB,UAAI,OAAK3D,aAAT,EAAwB;AACtB,eAAKA,aAAL,CAAmBK,KAAnB,CAAyB;AAAEkB,UAAAA,aAAa,EAAE;AAAjB,SAAzB;;AACA,eAAKvB,aAAL,GAAqB,IAArB;AACD;;AACD,aAAKd,KAAL,CAAWC,OAAX,CAAmB,OAAKR,KAAL,CAAWF,EAA9B;AACD,K;;WAEDuF,e,GAAkB,YAAM;AACtB,UAAI,CAAC,OAAKrF,KAAL,CAAWsF,IAAhB,EAAsB;AACpB,eAAKjE,aAAL,GAAqBD,QAAQ,CAACC,aAA9B;AACD;AACF,K;;WAEDkE,mB,GAAsB,UAACpF,CAAD,EAAO;AAC3B,cAAOA,CAAC,CAACoB,GAAT;AACA,aAAK,GAAL;AACA,aAAK,OAAL;AACE,iBAAK8D,eAAL;;AACA;AAJF;AAMD,K;;WAEDG,c,GAAiB,UAACrF,CAAD,EAAO;AACtB,cAAOA,CAAC,CAACoB,GAAT;AACA,aAAK,GAAL;AACA,aAAK,OAAL;AACE,iBAAKO,WAAL,CAAiB3B,CAAjB;;AACAA,UAAAA,CAAC,CAACyB,eAAF;AACAzB,UAAAA,CAAC,CAACwB,cAAF;AACA;AANF;AAQD,K;;WAEDyD,e,GAAkB,UAAAjF,CAAC,EAAI;AACrB,UAAM4B,CAAC,GAAGC,MAAM,CAAC7B,CAAC,CAAC8B,aAAF,CAAgBC,YAAhB,CAA6B,YAA7B,CAAD,CAAhB;AACA,iCAAuB,OAAK3B,KAAL,CAAWO,KAAX,CAAiBiB,CAAjB,CAAvB;AAAA,UAAQI,MAAR,wBAAQA,MAAR;AAAA,UAAgBC,EAAhB,wBAAgBA,EAAhB;;AAEA,aAAK4C,WAAL;;AAEA,UAAI,OAAO7C,MAAP,KAAkB,UAAtB,EAAkC;AAChChC,QAAAA,CAAC,CAACwB,cAAF;AACAQ,QAAAA,MAAM;AACP,OAHD,MAGO,IAAIC,EAAJ,EAAQ;AACbjC,QAAAA,CAAC,CAACwB,cAAF;;AACA,eAAKU,OAAL,CAAaC,MAAb,CAAoBC,OAApB,CAA4BC,IAA5B,CAAiCJ,EAAjC;AACD;AACF,K;;WAEDqD,Y,GAAe,UAAA/E,CAAC,EAAI;AAClB,aAAKJ,MAAL,GAAcI,CAAd;AACD,K;;WAEDgF,U,GAAa,YAAM;AACjB,aAAO,OAAKpF,MAAZ;AACD,K;;WAEDwC,oB,GAAuB,YAAM;AAC3B,UAAI,OAAK9C,KAAL,CAAWF,EAAX,KAAkB,OAAKS,KAAL,CAAWwE,cAAjC,EAAiD;AAC/C,eAAKC,WAAL;AACD;AACF,K;;;;;;;UAED3B,M,GAAA,kBAAU;AACR,uBAAqG,KAAK9C,KAA1G;AAAA,QAAQoF,IAAR,gBAAQA,IAAR;AAAA,QAAc7E,KAAd,gBAAcA,KAAd;AAAA,QAAqB8E,IAArB,gBAAqBA,IAArB;AAAA,QAA2BC,KAA3B,gBAA2BA,KAA3B;AAAA,QAAkCC,QAAlC,gBAAkCA,QAAlC;AAAA,QAA4CC,iBAA5C,gBAA4CA,iBAA5C;AAAA,QAA+DhB,cAA/D,gBAA+DA,cAA/D;AAAA,QAA+EpC,iBAA/E,gBAA+EA,iBAA/E;AACA,QAAM2C,IAAI,GAAG,KAAKtF,KAAL,CAAWF,EAAX,KAAkBiF,cAA/B;AAEA,wBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,UAAD;AACE,MAAA,IAAI,EAAEY,IADR;AAEE,MAAA,KAAK,EAAEE,KAFT;AAGE,MAAA,MAAM,EAAEP,IAHV;AAIE,MAAA,QAAQ,EAAEQ,QAJZ;AAKE,MAAA,IAAI,EAAEF,IALR;AAME,MAAA,GAAG,EAAE,KAAKH,YANZ;AAOE,MAAA,OAAO,EAAE,KAAK3D,WAPhB;AAQE,MAAA,WAAW,EAAE,KAAKuD,eARpB;AASE,MAAA,SAAS,EAAE,KAAKE,mBATlB;AAUE,MAAA,UAAU,EAAE,KAAKC,cAVnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eAcE,oBAAC,OAAD;AAAS,MAAA,IAAI,EAAEF,IAAf;AAAqB,MAAA,SAAS,EAAES,iBAAhC;AAAmD,MAAA,MAAM,EAAE,KAAKL,UAAhE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,YAAD;AAAc,MAAA,KAAK,EAAE5E,KAArB;AAA4B,MAAA,OAAO,EAAE,KAAKkE,WAA1C;AAAuD,MAAA,iBAAiB,EAAErC,iBAA1E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CAdF,CADF;AAoBD,G;;;EA9HmCvD,KAAK,CAAC+E,a;;AAAvBU,Q,CAEZT,Y,GAAe;AACpB9B,EAAAA,MAAM,EAAEjD,SAAS,CAACgF;AADE,C;AAFHQ,Q,CAMZP,S,GAAY;AACjBqB,EAAAA,IAAI,EAAEtG,SAAS,CAACqF,MAAV,CAAiBF,UADN;AAEjB1D,EAAAA,KAAK,EAAEzB,SAAS,CAACkF,KAAV,CAAgBC,UAFN;AAGjBoB,EAAAA,IAAI,EAAEvG,SAAS,CAAC2G,MAAV,CAAiBxB,UAHN;AAIjBqB,EAAAA,KAAK,EAAExG,SAAS,CAACqF,MAJA;AAKjBoB,EAAAA,QAAQ,EAAEzG,SAAS,CAACsF,IALH;AAMjBsB,EAAAA,MAAM,EAAE3G,kBAAkB,CAAC4E,GANV;AAOjBgC,EAAAA,cAAc,EAAE7G,SAAS,CAACoF,IAPT;AAQjBU,EAAAA,MAAM,EAAE9F,SAAS,CAACoF,IAAV,CAAeD,UARN;AASjBhE,EAAAA,OAAO,EAAEnB,SAAS,CAACoF,IAAV,CAAeD,UATP;AAUjBuB,EAAAA,iBAAiB,EAAE1G,SAAS,CAACqF,MAVZ;AAWjBK,EAAAA,cAAc,EAAE1F,SAAS,CAAC2G,MAXT;AAYjBrD,EAAAA,iBAAiB,EAAEtD,SAAS,CAACsF;AAZZ,C;AANAE,Q,CAqBZD,Y,GAAe;AACpBiB,EAAAA,KAAK,EAAE;AADa,C;SArBHhB,Q","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport IconButton from './icon_button';\nimport Overlay from 'react-overlays/lib/Overlay';\nimport Motion from '../features/ui/util/optional_motion';\nimport spring from 'react-motion/lib/spring';\nimport { supportsPassiveEvents } from 'detect-passive-events';\n\nconst listenerOptions = supportsPassiveEvents ? { passive: true } : false;\nlet id = 0;\n\nclass DropdownMenu extends React.PureComponent {\n\n  static contextTypes = {\n    router: PropTypes.object,\n  };\n\n  static propTypes = {\n    items: PropTypes.array.isRequired,\n    onClose: PropTypes.func.isRequired,\n    style: PropTypes.object,\n    placement: PropTypes.string,\n    arrowOffsetLeft: PropTypes.string,\n    arrowOffsetTop: PropTypes.string,\n    openedViaKeyboard: PropTypes.bool,\n  };\n\n  static defaultProps = {\n    style: {},\n    placement: 'bottom',\n  };\n\n  state = {\n    mounted: false,\n  };\n\n  handleDocumentClick = e => {\n    if (this.node && !this.node.contains(e.target)) {\n      this.props.onClose();\n    }\n  }\n\n  componentDidMount () {\n    document.addEventListener('click', this.handleDocumentClick, false);\n    document.addEventListener('keydown', this.handleKeyDown, false);\n    document.addEventListener('touchend', this.handleDocumentClick, listenerOptions);\n    if (this.focusedItem && this.props.openedViaKeyboard) {\n      this.focusedItem.focus({ preventScroll: true });\n    }\n    this.setState({ mounted: true });\n  }\n\n  componentWillUnmount () {\n    document.removeEventListener('click', this.handleDocumentClick, false);\n    document.removeEventListener('keydown', this.handleKeyDown, false);\n    document.removeEventListener('touchend', this.handleDocumentClick, listenerOptions);\n  }\n\n  setRef = c => {\n    this.node = c;\n  }\n\n  setFocusRef = c => {\n    this.focusedItem = c;\n  }\n\n  handleKeyDown = e => {\n    const items = Array.from(this.node.getElementsByTagName('a'));\n    const index = items.indexOf(document.activeElement);\n    let element = null;\n\n    switch(e.key) {\n    case 'ArrowDown':\n      element = items[index+1] || items[0];\n      break;\n    case 'ArrowUp':\n      element = items[index-1] || items[items.length-1];\n      break;\n    case 'Tab':\n      if (e.shiftKey) {\n        element = items[index-1] || items[items.length-1];\n      } else {\n        element = items[index+1] || items[0];\n      }\n      break;\n    case 'Home':\n      element = items[0];\n      break;\n    case 'End':\n      element = items[items.length-1];\n      break;\n    case 'Escape':\n      this.props.onClose();\n      break;\n    }\n\n    if (element) {\n      element.focus();\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }\n\n  handleItemKeyPress = e => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      this.handleClick(e);\n    }\n  }\n\n  handleClick = e => {\n    const i = Number(e.currentTarget.getAttribute('data-index'));\n    const { action, to } = this.props.items[i];\n\n    this.props.onClose();\n\n    if (typeof action === 'function') {\n      e.preventDefault();\n      action(e);\n    } else if (to) {\n      e.preventDefault();\n      this.context.router.history.push(to);\n    }\n  }\n\n  renderItem (option, i) {\n    if (option === null) {\n      return <li key={`sep-${i}`} className='dropdown-menu__separator' />;\n    }\n\n    const { text, href = '#', target = '_blank', method } = option;\n\n    return (\n      <li className='dropdown-menu__item' key={`${text}-${i}`}>\n        <a href={href} target={target} data-method={method} rel='noopener noreferrer' role='button' tabIndex='0' ref={i === 0 ? this.setFocusRef : null} onClick={this.handleClick} onKeyPress={this.handleItemKeyPress} data-index={i}>\n          {text}\n        </a>\n      </li>\n    );\n  }\n\n  render () {\n    const { items, style, placement, arrowOffsetLeft, arrowOffsetTop } = this.props;\n    const { mounted } = this.state;\n\n    return (\n      <Motion defaultStyle={{ opacity: 0, scaleX: 0.85, scaleY: 0.75 }} style={{ opacity: spring(1, { damping: 35, stiffness: 400 }), scaleX: spring(1, { damping: 35, stiffness: 400 }), scaleY: spring(1, { damping: 35, stiffness: 400 }) }}>\n        {({ opacity, scaleX, scaleY }) => (\n          // It should not be transformed when mounting because the resulting\n          // size will be used to determine the coordinate of the menu by\n          // react-overlays\n          <div className={`dropdown-menu ${placement}`} style={{ ...style, opacity: opacity, transform: mounted ? `scale(${scaleX}, ${scaleY})` : null }} ref={this.setRef}>\n            <div className={`dropdown-menu__arrow ${placement}`} style={{ left: arrowOffsetLeft, top: arrowOffsetTop }} />\n\n            <ul>\n              {items.map((option, i) => this.renderItem(option, i))}\n            </ul>\n          </div>\n        )}\n      </Motion>\n    );\n  }\n\n}\n\nexport default class Dropdown extends React.PureComponent {\n\n  static contextTypes = {\n    router: PropTypes.object,\n  };\n\n  static propTypes = {\n    icon: PropTypes.string.isRequired,\n    items: PropTypes.array.isRequired,\n    size: PropTypes.number.isRequired,\n    title: PropTypes.string,\n    disabled: PropTypes.bool,\n    status: ImmutablePropTypes.map,\n    isUserTouching: PropTypes.func,\n    onOpen: PropTypes.func.isRequired,\n    onClose: PropTypes.func.isRequired,\n    dropdownPlacement: PropTypes.string,\n    openDropdownId: PropTypes.number,\n    openedViaKeyboard: PropTypes.bool,\n  };\n\n  static defaultProps = {\n    title: 'Menu',\n  };\n\n  state = {\n    id: id++,\n  };\n\n  handleClick = ({ target, type }) => {\n    if (this.state.id === this.props.openDropdownId) {\n      this.handleClose();\n    } else {\n      const { top } = target.getBoundingClientRect();\n      const placement = top * 2 < innerHeight ? 'bottom' : 'top';\n      this.props.onOpen(this.state.id, this.handleItemClick, placement, type !== 'click');\n    }\n  }\n\n  handleClose = () => {\n    if (this.activeElement) {\n      this.activeElement.focus({ preventScroll: true });\n      this.activeElement = null;\n    }\n    this.props.onClose(this.state.id);\n  }\n\n  handleMouseDown = () => {\n    if (!this.state.open) {\n      this.activeElement = document.activeElement;\n    }\n  }\n\n  handleButtonKeyDown = (e) => {\n    switch(e.key) {\n    case ' ':\n    case 'Enter':\n      this.handleMouseDown();\n      break;\n    }\n  }\n\n  handleKeyPress = (e) => {\n    switch(e.key) {\n    case ' ':\n    case 'Enter':\n      this.handleClick(e);\n      e.stopPropagation();\n      e.preventDefault();\n      break;\n    }\n  }\n\n  handleItemClick = e => {\n    const i = Number(e.currentTarget.getAttribute('data-index'));\n    const { action, to } = this.props.items[i];\n\n    this.handleClose();\n\n    if (typeof action === 'function') {\n      e.preventDefault();\n      action();\n    } else if (to) {\n      e.preventDefault();\n      this.context.router.history.push(to);\n    }\n  }\n\n  setTargetRef = c => {\n    this.target = c;\n  }\n\n  findTarget = () => {\n    return this.target;\n  }\n\n  componentWillUnmount = () => {\n    if (this.state.id === this.props.openDropdownId) {\n      this.handleClose();\n    }\n  }\n\n  render () {\n    const { icon, items, size, title, disabled, dropdownPlacement, openDropdownId, openedViaKeyboard } = this.props;\n    const open = this.state.id === openDropdownId;\n\n    return (\n      <div>\n        <IconButton\n          icon={icon}\n          title={title}\n          active={open}\n          disabled={disabled}\n          size={size}\n          ref={this.setTargetRef}\n          onClick={this.handleClick}\n          onMouseDown={this.handleMouseDown}\n          onKeyDown={this.handleButtonKeyDown}\n          onKeyPress={this.handleKeyPress}\n        />\n\n        <Overlay show={open} placement={dropdownPlacement} target={this.findTarget}>\n          <DropdownMenu items={items} onClose={this.handleClose} openedViaKeyboard={openedViaKeyboard} />\n        </Overlay>\n      </div>\n    );\n  }\n\n}\n"]},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module"}