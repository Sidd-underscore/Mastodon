{"ast":null,"code":"var _jsxFileName = \"/home/runner/Mastodon/live/app/javascript/mastodon/components/error_boundary.js\";\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { FormattedMessage } from 'react-intl';\nimport { version, source_url } from 'mastodon/initial_state';\nimport StackTrace from 'stacktrace-js';\n\nvar ErrorBoundary = /*#__PURE__*/function (_React$PureComponent) {\n  _inheritsLoose(ErrorBoundary, _React$PureComponent);\n\n  function ErrorBoundary() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$PureComponent.call.apply(_React$PureComponent, [this].concat(args)) || this;\n    _this.state = {\n      hasError: false,\n      errorMessage: undefined,\n      stackTrace: undefined,\n      mappedStackTrace: undefined,\n      componentStack: undefined\n    };\n\n    _this.handleCopyStackTrace = function () {\n      var _this$state = _this.state,\n          errorMessage = _this$state.errorMessage,\n          stackTrace = _this$state.stackTrace,\n          mappedStackTrace = _this$state.mappedStackTrace;\n      var textarea = document.createElement('textarea');\n      var contents = [errorMessage, stackTrace];\n\n      if (mappedStackTrace) {\n        contents.push(mappedStackTrace);\n      }\n\n      textarea.textContent = contents.join('\\n\\n\\n');\n      textarea.style.position = 'fixed';\n      document.body.appendChild(textarea);\n\n      try {\n        textarea.select();\n        document.execCommand('copy');\n      } catch (e) {} finally {\n        document.body.removeChild(textarea);\n      }\n\n      _this.setState({\n        copied: true\n      });\n\n      setTimeout(function () {\n        return _this.setState({\n          copied: false\n        });\n      }, 700);\n    };\n\n    return _this;\n  }\n\n  var _proto = ErrorBoundary.prototype;\n\n  _proto.componentDidCatch = function componentDidCatch(error, info) {\n    var _this2 = this;\n\n    this.setState({\n      hasError: true,\n      errorMessage: error.toString(),\n      stackTrace: error.stack,\n      componentStack: info && info.componentStack,\n      mappedStackTrace: undefined\n    });\n    StackTrace.fromError(error).then(function (stackframes) {\n      _this2.setState({\n        mappedStackTrace: stackframes.map(function (sf) {\n          return sf.toString();\n        }).join('\\n')\n      });\n    }).catch(function () {\n      _this2.setState({\n        mappedStackTrace: undefined\n      });\n    });\n  };\n\n  _proto.render = function render() {\n    var _this$state2 = this.state,\n        hasError = _this$state2.hasError,\n        copied = _this$state2.copied,\n        errorMessage = _this$state2.errorMessage;\n\n    if (!hasError) {\n      return this.props.children;\n    }\n\n    var likelyBrowserAddonIssue = errorMessage && errorMessage.includes('NotFoundError');\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"error-boundary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      className: \"error-boundary__error\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 11\n      }\n    }, likelyBrowserAddonIssue ? /*#__PURE__*/React.createElement(FormattedMessage, {\n      id: \"error.unexpected_crash.explanation_addons\",\n      defaultMessage: \"This page could not be displayed correctly. This error is likely caused by a browser add-on or automatic translation tools.\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 15\n      }\n    }) : /*#__PURE__*/React.createElement(FormattedMessage, {\n      id: \"error.unexpected_crash.explanation\",\n      defaultMessage: \"Due to a bug in our code or a browser compatibility issue, this page could not be displayed correctly.\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 11\n      }\n    }, likelyBrowserAddonIssue ? /*#__PURE__*/React.createElement(FormattedMessage, {\n      id: \"error.unexpected_crash.next_steps_addons\",\n      defaultMessage: \"Try disabling them and refreshing the page. If that does not help, you may still be able to use Mastodon through a different browser or native app.\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 15\n      }\n    }) : /*#__PURE__*/React.createElement(FormattedMessage, {\n      id: \"error.unexpected_crash.next_steps\",\n      defaultMessage: \"Try refreshing the page. If that does not help, you may still be able to use Mastodon through a different browser or native app.\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"error-boundary__footer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 11\n      }\n    }, \"Mastodon v\", version, \" \\xB7 \", /*#__PURE__*/React.createElement(\"a\", {\n      href: source_url,\n      rel: \"noopener noreferrer\",\n      target: \"_blank\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 71\n      }\n    }, /*#__PURE__*/React.createElement(FormattedMessage, {\n      id: \"errors.unexpected_crash.report_issue\",\n      defaultMessage: \"Report issue\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 134\n      }\n    })), \" \\xB7 \", /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.handleCopyStackTrace,\n      className: copied ? 'copied' : '',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 233\n      }\n    }, /*#__PURE__*/React.createElement(FormattedMessage, {\n      id: \"errors.unexpected_crash.copy_stacktrace\",\n      defaultMessage: \"Copy stacktrace to clipboard\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 312\n      }\n    })))));\n  };\n\n  return ErrorBoundary;\n}(React.PureComponent);\n\nErrorBoundary.propTypes = {\n  children: PropTypes.node\n};\nexport { ErrorBoundary as default };","map":{"version":3,"sources":["/home/runner/Mastodon/live/app/javascript/mastodon/components/error_boundary.js"],"names":["React","PropTypes","FormattedMessage","version","source_url","StackTrace","ErrorBoundary","state","hasError","errorMessage","undefined","stackTrace","mappedStackTrace","componentStack","handleCopyStackTrace","textarea","document","createElement","contents","push","textContent","join","style","position","body","appendChild","select","execCommand","e","removeChild","setState","copied","setTimeout","componentDidCatch","error","info","toString","stack","fromError","then","stackframes","map","sf","catch","render","props","children","likelyBrowserAddonIssue","includes","PureComponent","propTypes","node"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { FormattedMessage } from 'react-intl';\nimport { version, source_url } from 'mastodon/initial_state';\nimport StackTrace from 'stacktrace-js';\n\nexport default class ErrorBoundary extends React.PureComponent {\n\n  static propTypes = {\n    children: PropTypes.node,\n  };\n\n  state = {\n    hasError: false,\n    errorMessage: undefined,\n    stackTrace: undefined,\n    mappedStackTrace: undefined,\n    componentStack: undefined,\n  };\n\n  componentDidCatch (error, info) {\n    this.setState({\n      hasError: true,\n      errorMessage: error.toString(),\n      stackTrace: error.stack,\n      componentStack: info && info.componentStack,\n      mappedStackTrace: undefined,\n    });\n\n    StackTrace.fromError(error).then((stackframes) => {\n      this.setState({\n        mappedStackTrace: stackframes.map((sf) => sf.toString()).join('\\n'),\n      });\n    }).catch(() => {\n      this.setState({\n        mappedStackTrace: undefined,\n      });\n    });\n  }\n\n  handleCopyStackTrace = () => {\n    const { errorMessage, stackTrace, mappedStackTrace } = this.state;\n    const textarea = document.createElement('textarea');\n\n    let contents = [errorMessage, stackTrace];\n    if (mappedStackTrace) {\n      contents.push(mappedStackTrace);\n    }\n\n    textarea.textContent    = contents.join('\\n\\n\\n');\n    textarea.style.position = 'fixed';\n\n    document.body.appendChild(textarea);\n\n    try {\n      textarea.select();\n      document.execCommand('copy');\n    } catch (e) {\n\n    } finally {\n      document.body.removeChild(textarea);\n    }\n\n    this.setState({ copied: true });\n    setTimeout(() => this.setState({ copied: false }), 700);\n  }\n\n  render() {\n    const { hasError, copied, errorMessage } = this.state;\n\n    if (!hasError) {\n      return this.props.children;\n    }\n\n    const likelyBrowserAddonIssue = errorMessage && errorMessage.includes('NotFoundError');\n\n    return (\n      <div className='error-boundary'>\n        <div>\n          <p className='error-boundary__error'>\n            { likelyBrowserAddonIssue ? (\n              <FormattedMessage id='error.unexpected_crash.explanation_addons' defaultMessage='This page could not be displayed correctly. This error is likely caused by a browser add-on or automatic translation tools.' />\n            ) : (\n              <FormattedMessage id='error.unexpected_crash.explanation' defaultMessage='Due to a bug in our code or a browser compatibility issue, this page could not be displayed correctly.' />\n            )}\n          </p>\n          <p>\n            { likelyBrowserAddonIssue ? (\n              <FormattedMessage id='error.unexpected_crash.next_steps_addons' defaultMessage='Try disabling them and refreshing the page. If that does not help, you may still be able to use Mastodon through a different browser or native app.' />\n            ) : (\n              <FormattedMessage id='error.unexpected_crash.next_steps' defaultMessage='Try refreshing the page. If that does not help, you may still be able to use Mastodon through a different browser or native app.' />\n            )}\n          </p>\n          <p className='error-boundary__footer'>Mastodon v{version} · <a href={source_url} rel='noopener noreferrer' target='_blank'><FormattedMessage id='errors.unexpected_crash.report_issue' defaultMessage='Report issue' /></a> · <button onClick={this.handleCopyStackTrace} className={copied ? 'copied' : ''}><FormattedMessage id='errors.unexpected_crash.copy_stacktrace' defaultMessage='Copy stacktrace to clipboard' /></button></p>\n        </div>\n      </div>\n    );\n  }\n\n}\n"]},"metadata":{"react-intl":{"messages":[{"id":"error.unexpected_crash.explanation_addons","defaultMessage":"This page could not be displayed correctly. This error is likely caused by a browser add-on or automatic translation tools."},{"id":"error.unexpected_crash.explanation","defaultMessage":"Due to a bug in our code or a browser compatibility issue, this page could not be displayed correctly."},{"id":"error.unexpected_crash.next_steps_addons","defaultMessage":"Try disabling them and refreshing the page. If that does not help, you may still be able to use Mastodon through a different browser or native app."},{"id":"error.unexpected_crash.next_steps","defaultMessage":"Try refreshing the page. If that does not help, you may still be able to use Mastodon through a different browser or native app."},{"id":"errors.unexpected_crash.report_issue","defaultMessage":"Report issue"},{"id":"errors.unexpected_crash.copy_stacktrace","defaultMessage":"Copy stacktrace to clipboard"}]}},"sourceType":"module"}