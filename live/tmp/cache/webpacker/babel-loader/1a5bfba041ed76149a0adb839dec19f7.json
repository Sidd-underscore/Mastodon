{"ast":null,"code":"import axios from 'axios';\nimport * as WebAuthnJSON from '@github/webauthn-json';\nimport ready from '../mastodon/ready';\nimport 'regenerator-runtime/runtime';\n\nfunction getCSRFToken() {\n  var CSRFSelector = document.querySelector('meta[name=\"csrf-token\"]');\n\n  if (CSRFSelector) {\n    return CSRFSelector.getAttribute('content');\n  } else {\n    return null;\n  }\n}\n\nfunction hideFlashMessages() {\n  Array.from(document.getElementsByClassName('flash-message')).forEach(function (flashMessage) {\n    flashMessage.classList.add('hidden');\n  });\n}\n\nfunction callback(url, body) {\n  axios.post(url, JSON.stringify(body), {\n    headers: {\n      'Content-Type': 'application/json',\n      'Accept': 'application/json',\n      'X-CSRF-Token': getCSRFToken()\n    },\n    credentials: 'same-origin'\n  }).then(function (response) {\n    window.location.replace(response.data.redirect_path);\n  }).catch(function (error) {\n    if (error.response.status === 422) {\n      var errorMessage = document.getElementById('security-key-error-message');\n      errorMessage.classList.remove('hidden');\n      console.error(error.response.data.error);\n    } else {\n      console.error(error);\n    }\n  });\n}\n\nready(function () {\n  if (!WebAuthnJSON.supported()) {\n    var unsupported_browser_message = document.getElementById('unsupported-browser-message');\n\n    if (unsupported_browser_message) {\n      unsupported_browser_message.classList.remove('hidden');\n      document.querySelector('.btn.js-webauthn').disabled = true;\n    }\n  }\n\n  var webAuthnCredentialRegistrationForm = document.getElementById('new_webauthn_credential');\n\n  if (webAuthnCredentialRegistrationForm) {\n    webAuthnCredentialRegistrationForm.addEventListener('submit', function (event) {\n      event.preventDefault();\n      var nickname = event.target.querySelector('input[name=\"new_webauthn_credential[nickname]\"]');\n\n      if (nickname.value) {\n        axios.get('/settings/security_keys/options').then(function (response) {\n          var credentialOptions = response.data;\n          WebAuthnJSON.create({\n            'publicKey': credentialOptions\n          }).then(function (credential) {\n            var params = {\n              'credential': credential,\n              'nickname': nickname.value\n            };\n            callback('/settings/security_keys', params);\n          }).catch(function (error) {\n            var errorMessage = document.getElementById('security-key-error-message');\n            errorMessage.classList.remove('hidden');\n            console.error(error);\n          });\n        }).catch(function (error) {\n          console.error(error.response.data.error);\n        });\n      } else {\n        nickname.focus();\n      }\n    });\n  }\n\n  var webAuthnCredentialAuthenticationForm = document.getElementById('webauthn-form');\n\n  if (webAuthnCredentialAuthenticationForm) {\n    webAuthnCredentialAuthenticationForm.addEventListener('submit', function (event) {\n      event.preventDefault();\n      axios.get('sessions/security_key_options').then(function (response) {\n        var credentialOptions = response.data;\n        WebAuthnJSON.get({\n          'publicKey': credentialOptions\n        }).then(function (credential) {\n          var params = {\n            'user': {\n              'credential': credential\n            }\n          };\n          callback('sign_in', params);\n        }).catch(function (error) {\n          var errorMessage = document.getElementById('security-key-error-message');\n          errorMessage.classList.remove('hidden');\n          console.error(error);\n        });\n      }).catch(function (error) {\n        console.error(error.response.data.error);\n      });\n    });\n    var otpAuthenticationForm = document.getElementById('otp-authentication-form');\n    var linkToOtp = document.getElementById('link-to-otp');\n    linkToOtp.addEventListener('click', function () {\n      webAuthnCredentialAuthenticationForm.classList.add('hidden');\n      otpAuthenticationForm.classList.remove('hidden');\n      hideFlashMessages();\n    });\n    var linkToWebAuthn = document.getElementById('link-to-webauthn');\n    linkToWebAuthn.addEventListener('click', function () {\n      otpAuthenticationForm.classList.add('hidden');\n      webAuthnCredentialAuthenticationForm.classList.remove('hidden');\n      hideFlashMessages();\n    });\n  }\n});","map":{"version":3,"sources":["/home/runner/Mastodon/live/app/javascript/packs/two_factor_authentication.js"],"names":["axios","WebAuthnJSON","ready","getCSRFToken","CSRFSelector","document","querySelector","getAttribute","hideFlashMessages","Array","from","getElementsByClassName","forEach","flashMessage","classList","add","callback","url","body","post","JSON","stringify","headers","credentials","then","response","window","location","replace","data","redirect_path","catch","error","status","errorMessage","getElementById","remove","console","supported","unsupported_browser_message","disabled","webAuthnCredentialRegistrationForm","addEventListener","event","preventDefault","nickname","target","value","get","credentialOptions","create","credential","params","focus","webAuthnCredentialAuthenticationForm","otpAuthenticationForm","linkToOtp","linkToWebAuthn"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport * as WebAuthnJSON from '@github/webauthn-json';\nimport ready from '../mastodon/ready';\nimport 'regenerator-runtime/runtime';\n\nfunction getCSRFToken() {\n  var CSRFSelector = document.querySelector('meta[name=\"csrf-token\"]');\n  if (CSRFSelector) {\n    return CSRFSelector.getAttribute('content');\n  } else {\n    return null;\n  }\n}\n\nfunction hideFlashMessages() {\n  Array.from(document.getElementsByClassName('flash-message')).forEach(function(flashMessage) {\n    flashMessage.classList.add('hidden');\n  });\n}\n\nfunction callback(url, body) {\n  axios.post(url, JSON.stringify(body), {\n    headers: {\n      'Content-Type': 'application/json',\n      'Accept': 'application/json',\n      'X-CSRF-Token': getCSRFToken(),\n    },\n    credentials: 'same-origin',\n  }).then(function(response) {\n    window.location.replace(response.data.redirect_path);\n  }).catch(function(error) {\n    if (error.response.status === 422) {\n      const errorMessage = document.getElementById('security-key-error-message');\n      errorMessage.classList.remove('hidden');\n      console.error(error.response.data.error);\n    } else {\n      console.error(error);\n    }\n  });\n}\n\nready(() => {\n  if (!WebAuthnJSON.supported()) {\n    const unsupported_browser_message = document.getElementById('unsupported-browser-message');\n    if (unsupported_browser_message) {\n      unsupported_browser_message.classList.remove('hidden');\n      document.querySelector('.btn.js-webauthn').disabled = true;\n    }\n  }\n\n\n  const webAuthnCredentialRegistrationForm = document.getElementById('new_webauthn_credential');\n  if (webAuthnCredentialRegistrationForm) {\n    webAuthnCredentialRegistrationForm.addEventListener('submit', (event) => {\n      event.preventDefault();\n\n      var nickname = event.target.querySelector('input[name=\"new_webauthn_credential[nickname]\"]');\n      if (nickname.value) {\n        axios.get('/settings/security_keys/options')\n          .then((response) => {\n            const credentialOptions = response.data;\n\n            WebAuthnJSON.create({ 'publicKey': credentialOptions }).then((credential) => {\n              var params = { 'credential': credential, 'nickname': nickname.value };\n              callback('/settings/security_keys', params);\n            }).catch((error) => {\n              const errorMessage = document.getElementById('security-key-error-message');\n              errorMessage.classList.remove('hidden');\n              console.error(error);\n            });\n          }).catch((error) => {\n            console.error(error.response.data.error);\n          });\n      } else {\n        nickname.focus();\n      }\n    });\n  }\n\n  const webAuthnCredentialAuthenticationForm = document.getElementById('webauthn-form');\n  if (webAuthnCredentialAuthenticationForm) {\n    webAuthnCredentialAuthenticationForm.addEventListener('submit', (event) => {\n      event.preventDefault();\n\n      axios.get('sessions/security_key_options')\n        .then((response) => {\n          const credentialOptions = response.data;\n\n          WebAuthnJSON.get({ 'publicKey': credentialOptions }).then((credential) => {\n            var params = { 'user': { 'credential': credential } };\n            callback('sign_in', params);\n          }).catch((error) => {\n            const errorMessage = document.getElementById('security-key-error-message');\n            errorMessage.classList.remove('hidden');\n            console.error(error);\n          });\n        }).catch((error) => {\n          console.error(error.response.data.error);\n        });\n    });\n\n    const otpAuthenticationForm = document.getElementById('otp-authentication-form');\n\n    const linkToOtp = document.getElementById('link-to-otp');\n    linkToOtp.addEventListener('click', () => {\n      webAuthnCredentialAuthenticationForm.classList.add('hidden');\n      otpAuthenticationForm.classList.remove('hidden');\n      hideFlashMessages();\n    });\n\n    const linkToWebAuthn = document.getElementById('link-to-webauthn');\n    linkToWebAuthn.addEventListener('click', () => {\n      otpAuthenticationForm.classList.add('hidden');\n      webAuthnCredentialAuthenticationForm.classList.remove('hidden');\n      hideFlashMessages();\n    });\n  }\n});\n"]},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module"}