{"ast":null,"code":"var _jsxFileName = \"/home/runner/Mastodon/live/app/javascript/mastodon/features/account_gallery/index.js\",\n    _dec,\n    _class,\n    _class2,\n    _temp;\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport PropTypes from 'prop-types';\nimport { fetchAccount } from 'mastodon/actions/accounts';\nimport { expandAccountMediaTimeline } from '../../actions/timelines';\nimport LoadingIndicator from 'mastodon/components/loading_indicator';\nimport Column from '../ui/components/column';\nimport ColumnBackButton from 'mastodon/components/column_back_button';\nimport ImmutablePureComponent from 'react-immutable-pure-component';\nimport { getAccountGallery } from 'mastodon/selectors';\nimport MediaItem from './components/media_item';\nimport HeaderContainer from '../account_timeline/containers/header_container';\nimport ScrollContainer from 'mastodon/containers/scroll_container';\nimport LoadMore from 'mastodon/components/load_more';\nimport MissingIndicator from 'mastodon/components/missing_indicator';\nimport { openModal } from 'mastodon/actions/modal';\nimport { FormattedMessage } from 'react-intl';\n\nvar mapStateToProps = function mapStateToProps(state, props) {\n  return {\n    isAccount: !!state.getIn(['accounts', props.params.accountId]),\n    attachments: getAccountGallery(state, props.params.accountId),\n    isLoading: state.getIn(['timelines', \"account:\" + props.params.accountId + \":media\", 'isLoading']),\n    hasMore: state.getIn(['timelines', \"account:\" + props.params.accountId + \":media\", 'hasMore']),\n    suspended: state.getIn(['accounts', props.params.accountId, 'suspended'], false),\n    blockedBy: state.getIn(['relationships', props.params.accountId, 'blocked_by'], false)\n  };\n};\n\nvar LoadMoreMedia = /*#__PURE__*/function (_ImmutablePureCompone) {\n  _inheritsLoose(LoadMoreMedia, _ImmutablePureCompone);\n\n  function LoadMoreMedia() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _ImmutablePureCompone.call.apply(_ImmutablePureCompone, [this].concat(args)) || this;\n\n    _this.handleLoadMore = function () {\n      _this.props.onLoadMore(_this.props.maxId);\n    };\n\n    return _this;\n  }\n\n  var _proto = LoadMoreMedia.prototype;\n\n  _proto.render = function render() {\n    return /*#__PURE__*/React.createElement(LoadMore, {\n      disabled: this.props.disabled,\n      onClick: this.handleLoadMore,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 42,\n        columnNumber: 7\n      }\n    });\n  };\n\n  return LoadMoreMedia;\n}(ImmutablePureComponent);\n\nLoadMoreMedia.propTypes = {\n  maxId: PropTypes.string,\n  onLoadMore: PropTypes.func.isRequired\n};\nvar AccountGallery = (_dec = connect(mapStateToProps), _dec(_class = (_temp = _class2 = /*#__PURE__*/function (_ImmutablePureCompone2) {\n  _inheritsLoose(AccountGallery, _ImmutablePureCompone2);\n\n  function AccountGallery() {\n    var _this2;\n\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    _this2 = _ImmutablePureCompone2.call.apply(_ImmutablePureCompone2, [this].concat(args)) || this;\n    _this2.state = {\n      width: 323\n    };\n\n    _this2.handleScrollToBottom = function () {\n      if (_this2.props.hasMore) {\n        _this2.handleLoadMore(_this2.props.attachments.size > 0 ? _this2.props.attachments.last().getIn(['status', 'id']) : undefined);\n      }\n    };\n\n    _this2.handleScroll = function (e) {\n      var _e$target = e.target,\n          scrollTop = _e$target.scrollTop,\n          scrollHeight = _e$target.scrollHeight,\n          clientHeight = _e$target.clientHeight;\n      var offset = scrollHeight - scrollTop - clientHeight;\n\n      if (150 > offset && !_this2.props.isLoading) {\n        _this2.handleScrollToBottom();\n      }\n    };\n\n    _this2.handleLoadMore = function (maxId) {\n      _this2.props.dispatch(expandAccountMediaTimeline(_this2.props.params.accountId, {\n        maxId\n      }));\n    };\n\n    _this2.handleLoadOlder = function (e) {\n      e.preventDefault();\n\n      _this2.handleScrollToBottom();\n    };\n\n    _this2.handleOpenMedia = function (attachment) {\n      var dispatch = _this2.props.dispatch;\n      var statusId = attachment.getIn(['status', 'id']);\n\n      if (attachment.get('type') === 'video') {\n        dispatch(openModal('VIDEO', {\n          media: attachment,\n          statusId,\n          options: {\n            autoPlay: true\n          }\n        }));\n      } else if (attachment.get('type') === 'audio') {\n        dispatch(openModal('AUDIO', {\n          media: attachment,\n          statusId,\n          options: {\n            autoPlay: true\n          }\n        }));\n      } else {\n        var media = attachment.getIn(['status', 'media_attachments']);\n        var index = media.findIndex(function (x) {\n          return x.get('id') === attachment.get('id');\n        });\n        dispatch(openModal('MEDIA', {\n          media,\n          index,\n          statusId\n        }));\n      }\n    };\n\n    _this2.handleRef = function (c) {\n      if (c) {\n        _this2.setState({\n          width: c.offsetWidth\n        });\n      }\n    };\n\n    return _this2;\n  }\n\n  var _proto2 = AccountGallery.prototype;\n\n  _proto2.componentDidMount = function componentDidMount() {\n    this.props.dispatch(fetchAccount(this.props.params.accountId));\n    this.props.dispatch(expandAccountMediaTimeline(this.props.params.accountId));\n  };\n\n  _proto2.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    if (nextProps.params.accountId !== this.props.params.accountId && nextProps.params.accountId) {\n      this.props.dispatch(fetchAccount(nextProps.params.accountId));\n      this.props.dispatch(expandAccountMediaTimeline(this.props.params.accountId));\n    }\n  };\n\n  _proto2.render = function render() {\n    var _this3 = this;\n\n    var _this$props = this.props,\n        attachments = _this$props.attachments,\n        isLoading = _this$props.isLoading,\n        hasMore = _this$props.hasMore,\n        isAccount = _this$props.isAccount,\n        multiColumn = _this$props.multiColumn,\n        blockedBy = _this$props.blockedBy,\n        suspended = _this$props.suspended;\n    var width = this.state.width;\n\n    if (!isAccount) {\n      return /*#__PURE__*/React.createElement(Column, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(MissingIndicator, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 11\n        }\n      }));\n    }\n\n    if (!attachments && isLoading) {\n      return /*#__PURE__*/React.createElement(Column, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(LoadingIndicator, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 11\n        }\n      }));\n    }\n\n    var loadOlder = null;\n\n    if (hasMore && !(isLoading && attachments.size === 0)) {\n      loadOlder = /*#__PURE__*/React.createElement(LoadMore, {\n        visible: !isLoading,\n        onClick: this.handleLoadOlder,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 19\n        }\n      });\n    }\n\n    var emptyMessage;\n\n    if (suspended) {\n      emptyMessage = /*#__PURE__*/React.createElement(FormattedMessage, {\n        id: \"empty_column.account_suspended\",\n        defaultMessage: \"Account suspended\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 22\n        }\n      });\n    } else if (blockedBy) {\n      emptyMessage = /*#__PURE__*/React.createElement(FormattedMessage, {\n        id: \"empty_column.account_unavailable\",\n        defaultMessage: \"Profile unavailable\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 22\n        }\n      });\n    }\n\n    return /*#__PURE__*/React.createElement(Column, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(ColumnBackButton, {\n      multiColumn: multiColumn,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(ScrollContainer, {\n      scrollKey: \"account_gallery\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"scrollable scrollable--flex\",\n      onScroll: this.handleScroll,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(HeaderContainer, {\n      accountId: this.props.params.accountId,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 13\n      }\n    }), suspended || blockedBy ? /*#__PURE__*/React.createElement(\"div\", {\n      className: \"empty-column-indicator\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 15\n      }\n    }, emptyMessage) : /*#__PURE__*/React.createElement(\"div\", {\n      role: \"feed\",\n      className: \"account-gallery__container\",\n      ref: this.handleRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 15\n      }\n    }, attachments.map(function (attachment, index) {\n      return attachment === null ? /*#__PURE__*/React.createElement(LoadMoreMedia, {\n        key: 'more:' + attachments.getIn(index + 1, 'id'),\n        maxId: index > 0 ? attachments.getIn(index - 1, 'id') : null,\n        onLoadMore: _this3.handleLoadMore,\n        __self: _this3,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 19\n        }\n      }) : /*#__PURE__*/React.createElement(MediaItem, {\n        key: attachment.get('id'),\n        attachment: attachment,\n        displayWidth: width,\n        onOpenMedia: _this3.handleOpenMedia,\n        __self: _this3,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 19\n        }\n      });\n    }), loadOlder), isLoading && attachments.size === 0 && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"scrollable__append\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(LoadingIndicator, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 17\n      }\n    })))));\n  };\n\n  return AccountGallery;\n}(ImmutablePureComponent), _class2.propTypes = {\n  params: PropTypes.object.isRequired,\n  dispatch: PropTypes.func.isRequired,\n  attachments: ImmutablePropTypes.list.isRequired,\n  isLoading: PropTypes.bool,\n  hasMore: PropTypes.bool,\n  isAccount: PropTypes.bool,\n  blockedBy: PropTypes.bool,\n  suspended: PropTypes.bool,\n  multiColumn: PropTypes.bool\n}, _temp)) || _class);\nexport { AccountGallery as default };","map":{"version":3,"sources":["/home/runner/Mastodon/live/app/javascript/mastodon/features/account_gallery/index.js"],"names":["React","connect","ImmutablePropTypes","PropTypes","fetchAccount","expandAccountMediaTimeline","LoadingIndicator","Column","ColumnBackButton","ImmutablePureComponent","getAccountGallery","MediaItem","HeaderContainer","ScrollContainer","LoadMore","MissingIndicator","openModal","FormattedMessage","mapStateToProps","state","props","isAccount","getIn","params","accountId","attachments","isLoading","hasMore","suspended","blockedBy","LoadMoreMedia","handleLoadMore","onLoadMore","maxId","render","disabled","propTypes","string","func","isRequired","AccountGallery","width","handleScrollToBottom","size","last","undefined","handleScroll","e","target","scrollTop","scrollHeight","clientHeight","offset","dispatch","handleLoadOlder","preventDefault","handleOpenMedia","attachment","statusId","get","media","options","autoPlay","index","findIndex","x","handleRef","c","setState","offsetWidth","componentDidMount","componentWillReceiveProps","nextProps","multiColumn","loadOlder","emptyMessage","map","object","list","bool"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport PropTypes from 'prop-types';\nimport { fetchAccount } from 'mastodon/actions/accounts';\nimport { expandAccountMediaTimeline } from '../../actions/timelines';\nimport LoadingIndicator from 'mastodon/components/loading_indicator';\nimport Column from '../ui/components/column';\nimport ColumnBackButton from 'mastodon/components/column_back_button';\nimport ImmutablePureComponent from 'react-immutable-pure-component';\nimport { getAccountGallery } from 'mastodon/selectors';\nimport MediaItem from './components/media_item';\nimport HeaderContainer from '../account_timeline/containers/header_container';\nimport ScrollContainer from 'mastodon/containers/scroll_container';\nimport LoadMore from 'mastodon/components/load_more';\nimport MissingIndicator from 'mastodon/components/missing_indicator';\nimport { openModal } from 'mastodon/actions/modal';\nimport { FormattedMessage } from 'react-intl';\n\nconst mapStateToProps = (state, props) => ({\n  isAccount: !!state.getIn(['accounts', props.params.accountId]),\n  attachments: getAccountGallery(state, props.params.accountId),\n  isLoading: state.getIn(['timelines', `account:${props.params.accountId}:media`, 'isLoading']),\n  hasMore: state.getIn(['timelines', `account:${props.params.accountId}:media`, 'hasMore']),\n  suspended: state.getIn(['accounts', props.params.accountId, 'suspended'], false),\n  blockedBy: state.getIn(['relationships', props.params.accountId, 'blocked_by'], false),\n});\n\nclass LoadMoreMedia extends ImmutablePureComponent {\n\n  static propTypes = {\n    maxId: PropTypes.string,\n    onLoadMore: PropTypes.func.isRequired,\n  };\n\n  handleLoadMore = () => {\n    this.props.onLoadMore(this.props.maxId);\n  }\n\n  render () {\n    return (\n      <LoadMore\n        disabled={this.props.disabled}\n        onClick={this.handleLoadMore}\n      />\n    );\n  }\n\n}\n\nexport default @connect(mapStateToProps)\nclass AccountGallery extends ImmutablePureComponent {\n\n  static propTypes = {\n    params: PropTypes.object.isRequired,\n    dispatch: PropTypes.func.isRequired,\n    attachments: ImmutablePropTypes.list.isRequired,\n    isLoading: PropTypes.bool,\n    hasMore: PropTypes.bool,\n    isAccount: PropTypes.bool,\n    blockedBy: PropTypes.bool,\n    suspended: PropTypes.bool,\n    multiColumn: PropTypes.bool,\n  };\n\n  state = {\n    width: 323,\n  };\n\n  componentDidMount () {\n    this.props.dispatch(fetchAccount(this.props.params.accountId));\n    this.props.dispatch(expandAccountMediaTimeline(this.props.params.accountId));\n  }\n\n  componentWillReceiveProps (nextProps) {\n    if (nextProps.params.accountId !== this.props.params.accountId && nextProps.params.accountId) {\n      this.props.dispatch(fetchAccount(nextProps.params.accountId));\n      this.props.dispatch(expandAccountMediaTimeline(this.props.params.accountId));\n    }\n  }\n\n  handleScrollToBottom = () => {\n    if (this.props.hasMore) {\n      this.handleLoadMore(this.props.attachments.size > 0 ? this.props.attachments.last().getIn(['status', 'id']) : undefined);\n    }\n  }\n\n  handleScroll = e => {\n    const { scrollTop, scrollHeight, clientHeight } = e.target;\n    const offset = scrollHeight - scrollTop - clientHeight;\n\n    if (150 > offset && !this.props.isLoading) {\n      this.handleScrollToBottom();\n    }\n  }\n\n  handleLoadMore = maxId => {\n    this.props.dispatch(expandAccountMediaTimeline(this.props.params.accountId, { maxId }));\n  };\n\n  handleLoadOlder = e => {\n    e.preventDefault();\n    this.handleScrollToBottom();\n  }\n\n  handleOpenMedia = attachment => {\n    const { dispatch } = this.props;\n    const statusId = attachment.getIn(['status', 'id']);\n\n    if (attachment.get('type') === 'video') {\n      dispatch(openModal('VIDEO', { media: attachment, statusId, options: { autoPlay: true } }));\n    } else if (attachment.get('type') === 'audio') {\n      dispatch(openModal('AUDIO', { media: attachment, statusId, options: { autoPlay: true } }));\n    } else {\n      const media = attachment.getIn(['status', 'media_attachments']);\n      const index = media.findIndex(x => x.get('id') === attachment.get('id'));\n\n      dispatch(openModal('MEDIA', { media, index, statusId }));\n    }\n  }\n\n  handleRef = c => {\n    if (c) {\n      this.setState({ width: c.offsetWidth });\n    }\n  }\n\n  render () {\n    const { attachments, isLoading, hasMore, isAccount, multiColumn, blockedBy, suspended } = this.props;\n    const { width } = this.state;\n\n    if (!isAccount) {\n      return (\n        <Column>\n          <MissingIndicator />\n        </Column>\n      );\n    }\n\n    if (!attachments && isLoading) {\n      return (\n        <Column>\n          <LoadingIndicator />\n        </Column>\n      );\n    }\n\n    let loadOlder = null;\n\n    if (hasMore && !(isLoading && attachments.size === 0)) {\n      loadOlder = <LoadMore visible={!isLoading} onClick={this.handleLoadOlder} />;\n    }\n\n    let emptyMessage;\n\n    if (suspended) {\n      emptyMessage = <FormattedMessage id='empty_column.account_suspended' defaultMessage='Account suspended' />;\n    } else if (blockedBy) {\n      emptyMessage = <FormattedMessage id='empty_column.account_unavailable' defaultMessage='Profile unavailable' />;\n    }\n\n    return (\n      <Column>\n        <ColumnBackButton multiColumn={multiColumn} />\n\n        <ScrollContainer scrollKey='account_gallery'>\n          <div className='scrollable scrollable--flex' onScroll={this.handleScroll}>\n            <HeaderContainer accountId={this.props.params.accountId} />\n\n            {(suspended || blockedBy) ? (\n              <div className='empty-column-indicator'>\n                {emptyMessage}\n              </div>\n            ) : (\n              <div role='feed' className='account-gallery__container' ref={this.handleRef}>\n                {attachments.map((attachment, index) => attachment === null ? (\n                  <LoadMoreMedia key={'more:' + attachments.getIn(index + 1, 'id')} maxId={index > 0 ? attachments.getIn(index - 1, 'id') : null} onLoadMore={this.handleLoadMore} />\n                ) : (\n                  <MediaItem key={attachment.get('id')} attachment={attachment} displayWidth={width} onOpenMedia={this.handleOpenMedia} />\n                ))}\n\n                {loadOlder}\n              </div>\n            )}\n\n            {isLoading && attachments.size === 0 && (\n              <div className='scrollable__append'>\n                <LoadingIndicator />\n              </div>\n            )}\n          </div>\n        </ScrollContainer>\n      </Column>\n    );\n  }\n\n}\n"]},"metadata":{"react-intl":{"messages":[{"id":"empty_column.account_suspended","defaultMessage":"Account suspended"},{"id":"empty_column.account_unavailable","defaultMessage":"Profile unavailable"}]}},"sourceType":"module"}