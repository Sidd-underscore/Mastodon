{"ast":null,"code":"var _jsxFileName = \"/home/runner/Mastodon/live/app/javascript/mastodon/features/audio/index.js\",\n    _class,\n    _class2,\n    _temp;\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { defineMessages, injectIntl } from 'react-intl';\nimport { formatTime } from 'mastodon/features/video';\nimport Icon from 'mastodon/components/icon';\nimport classNames from 'classnames';\nimport { throttle } from 'lodash';\nimport { getPointerPosition, fileNameFromURL } from 'mastodon/features/video';\nimport { debounce } from 'lodash';\nimport Visualizer from './visualizer';\nvar messages = defineMessages({\n  play: {\n    \"id\": \"video.play\",\n    \"defaultMessage\": \"Play\"\n  },\n  pause: {\n    \"id\": \"video.pause\",\n    \"defaultMessage\": \"Pause\"\n  },\n  mute: {\n    \"id\": \"video.mute\",\n    \"defaultMessage\": \"Mute sound\"\n  },\n  unmute: {\n    \"id\": \"video.unmute\",\n    \"defaultMessage\": \"Unmute sound\"\n  },\n  download: {\n    \"id\": \"video.download\",\n    \"defaultMessage\": \"Download file\"\n  }\n});\nvar TICK_SIZE = 10;\nvar PADDING = 180;\n\nvar Audio = injectIntl(_class = (_temp = _class2 = /*#__PURE__*/function (_React$PureComponent) {\n  _inheritsLoose(Audio, _React$PureComponent);\n\n  function Audio(props) {\n    var _this;\n\n    _this = _React$PureComponent.call(this, props) || this;\n    _this.state = {\n      width: _this.props.width,\n      currentTime: 0,\n      buffer: 0,\n      duration: null,\n      paused: true,\n      muted: false,\n      volume: 0.5,\n      dragging: false\n    };\n\n    _this.setPlayerRef = function (c) {\n      _this.player = c;\n\n      if (_this.player) {\n        _this._setDimensions();\n      }\n    };\n\n    _this.setSeekRef = function (c) {\n      _this.seek = c;\n    };\n\n    _this.setVolumeRef = function (c) {\n      _this.volume = c;\n    };\n\n    _this.setAudioRef = function (c) {\n      _this.audio = c;\n\n      if (_this.audio) {\n        _this.setState({\n          volume: _this.audio.volume,\n          muted: _this.audio.muted\n        });\n      }\n    };\n\n    _this.setCanvasRef = function (c) {\n      _this.canvas = c;\n\n      _this.visualizer.setCanvas(c);\n    };\n\n    _this.togglePlay = function () {\n      if (!_this.audioContext) {\n        _this._initAudioContext();\n      }\n\n      if (_this.state.paused) {\n        _this.setState({\n          paused: false\n        }, function () {\n          return _this.audio.play();\n        });\n      } else {\n        _this.setState({\n          paused: true\n        }, function () {\n          return _this.audio.pause();\n        });\n      }\n    };\n\n    _this.handleResize = debounce(function () {\n      if (_this.player) {\n        _this._setDimensions();\n      }\n    }, 250, {\n      trailing: true\n    });\n\n    _this.handlePlay = function () {\n      _this.setState({\n        paused: false\n      });\n\n      if (_this.audioContext && _this.audioContext.state === 'suspended') {\n        _this.audioContext.resume();\n      }\n\n      _this._renderCanvas();\n    };\n\n    _this.handlePause = function () {\n      _this.setState({\n        paused: true\n      });\n\n      if (_this.audioContext) {\n        _this.audioContext.suspend();\n      }\n    };\n\n    _this.handleProgress = function () {\n      var lastTimeRange = _this.audio.buffered.length - 1;\n\n      if (lastTimeRange > -1) {\n        _this.setState({\n          buffer: Math.ceil(_this.audio.buffered.end(lastTimeRange) / _this.audio.duration * 100)\n        });\n      }\n    };\n\n    _this.toggleMute = function () {\n      var muted = !_this.state.muted;\n\n      _this.setState({\n        muted\n      }, function () {\n        _this.audio.muted = muted;\n      });\n    };\n\n    _this.handleVolumeMouseDown = function (e) {\n      document.addEventListener('mousemove', _this.handleMouseVolSlide, true);\n      document.addEventListener('mouseup', _this.handleVolumeMouseUp, true);\n      document.addEventListener('touchmove', _this.handleMouseVolSlide, true);\n      document.addEventListener('touchend', _this.handleVolumeMouseUp, true);\n\n      _this.handleMouseVolSlide(e);\n\n      e.preventDefault();\n      e.stopPropagation();\n    };\n\n    _this.handleVolumeMouseUp = function () {\n      document.removeEventListener('mousemove', _this.handleMouseVolSlide, true);\n      document.removeEventListener('mouseup', _this.handleVolumeMouseUp, true);\n      document.removeEventListener('touchmove', _this.handleMouseVolSlide, true);\n      document.removeEventListener('touchend', _this.handleVolumeMouseUp, true);\n    };\n\n    _this.handleMouseDown = function (e) {\n      document.addEventListener('mousemove', _this.handleMouseMove, true);\n      document.addEventListener('mouseup', _this.handleMouseUp, true);\n      document.addEventListener('touchmove', _this.handleMouseMove, true);\n      document.addEventListener('touchend', _this.handleMouseUp, true);\n\n      _this.setState({\n        dragging: true\n      });\n\n      _this.audio.pause();\n\n      _this.handleMouseMove(e);\n\n      e.preventDefault();\n      e.stopPropagation();\n    };\n\n    _this.handleMouseUp = function () {\n      document.removeEventListener('mousemove', _this.handleMouseMove, true);\n      document.removeEventListener('mouseup', _this.handleMouseUp, true);\n      document.removeEventListener('touchmove', _this.handleMouseMove, true);\n      document.removeEventListener('touchend', _this.handleMouseUp, true);\n\n      _this.setState({\n        dragging: false\n      });\n\n      _this.audio.play();\n    };\n\n    _this.handleMouseMove = throttle(function (e) {\n      var _getPointerPosition = getPointerPosition(_this.seek, e),\n          x = _getPointerPosition.x;\n\n      var currentTime = _this.audio.duration * x;\n\n      if (!isNaN(currentTime)) {\n        _this.setState({\n          currentTime\n        }, function () {\n          _this.audio.currentTime = currentTime;\n        });\n      }\n    }, 15);\n\n    _this.handleTimeUpdate = function () {\n      _this.setState({\n        currentTime: _this.audio.currentTime,\n        duration: _this.audio.duration\n      });\n    };\n\n    _this.handleMouseVolSlide = throttle(function (e) {\n      var _getPointerPosition2 = getPointerPosition(_this.volume, e),\n          x = _getPointerPosition2.x;\n\n      if (!isNaN(x)) {\n        _this.setState({\n          volume: x\n        }, function () {\n          _this.audio.volume = x;\n        });\n      }\n    }, 15);\n    _this.handleScroll = throttle(function () {\n      if (!_this.canvas || !_this.audio) {\n        return;\n      }\n\n      var _this$canvas$getBound = _this.canvas.getBoundingClientRect(),\n          top = _this$canvas$getBound.top,\n          height = _this$canvas$getBound.height;\n\n      var inView = top <= (window.innerHeight || document.documentElement.clientHeight) && top + height >= 0;\n\n      if (!_this.state.paused && !inView) {\n        _this.audio.pause();\n\n        if (_this.props.deployPictureInPicture) {\n          _this.props.deployPictureInPicture('audio', _this._pack());\n        }\n\n        _this.setState({\n          paused: true\n        });\n      }\n    }, 150, {\n      trailing: true\n    });\n\n    _this.handleMouseEnter = function () {\n      _this.setState({\n        hovered: true\n      });\n    };\n\n    _this.handleMouseLeave = function () {\n      _this.setState({\n        hovered: false\n      });\n    };\n\n    _this.handleLoadedData = function () {\n      var _this$props = _this.props,\n          autoPlay = _this$props.autoPlay,\n          currentTime = _this$props.currentTime,\n          volume = _this$props.volume,\n          muted = _this$props.muted;\n\n      if (currentTime) {\n        _this.audio.currentTime = currentTime;\n      }\n\n      if (volume !== undefined) {\n        _this.audio.volume = volume;\n      }\n\n      if (muted !== undefined) {\n        _this.audio.muted = muted;\n      }\n\n      if (autoPlay) {\n        _this.togglePlay();\n      }\n    };\n\n    _this.handleDownload = function () {\n      fetch(_this.props.src).then(function (res) {\n        return res.blob();\n      }).then(function (blob) {\n        var element = document.createElement('a');\n        var objectURL = URL.createObjectURL(blob);\n        element.setAttribute('href', objectURL);\n        element.setAttribute('download', fileNameFromURL(_this.props.src));\n        document.body.appendChild(element);\n        element.click();\n        document.body.removeChild(element);\n        URL.revokeObjectURL(objectURL);\n      }).catch(function (err) {\n        console.error(err);\n      });\n    };\n\n    _this.handleAudioKeyDown = function (e) {\n      // On the audio element or the seek bar, we can safely use the space bar\n      // for playback control because there are no buttons to press\n      if (e.key === ' ') {\n        e.preventDefault();\n        e.stopPropagation();\n\n        _this.togglePlay();\n      }\n    };\n\n    _this.handleKeyDown = function (e) {\n      switch (e.key) {\n        case 'k':\n          e.preventDefault();\n          e.stopPropagation();\n\n          _this.togglePlay();\n\n          break;\n\n        case 'm':\n          e.preventDefault();\n          e.stopPropagation();\n\n          _this.toggleMute();\n\n          break;\n\n        case 'j':\n          e.preventDefault();\n          e.stopPropagation();\n\n          _this.seekBy(-10);\n\n          break;\n\n        case 'l':\n          e.preventDefault();\n          e.stopPropagation();\n\n          _this.seekBy(10);\n\n          break;\n      }\n    };\n\n    _this.visualizer = new Visualizer(TICK_SIZE);\n    return _this;\n  }\n\n  var _proto = Audio.prototype;\n\n  _proto._pack = function _pack() {\n    return {\n      src: this.props.src,\n      volume: this.audio.volume,\n      muted: this.audio.muted,\n      currentTime: this.audio.currentTime,\n      poster: this.props.poster,\n      backgroundColor: this.props.backgroundColor,\n      foregroundColor: this.props.foregroundColor,\n      accentColor: this.props.accentColor\n    };\n  };\n\n  _proto._setDimensions = function _setDimensions() {\n    var width = this.player.offsetWidth;\n    var height = this.props.fullscreen ? this.player.offsetHeight : width / (16 / 9);\n\n    if (this.props.cacheWidth) {\n      this.props.cacheWidth(width);\n    }\n\n    this.setState({\n      width,\n      height\n    });\n  };\n\n  _proto.componentDidMount = function componentDidMount() {\n    window.addEventListener('scroll', this.handleScroll);\n    window.addEventListener('resize', this.handleResize, {\n      passive: true\n    });\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate(prevProps, prevState) {\n    if (prevProps.src !== this.props.src || this.state.width !== prevState.width || this.state.height !== prevState.height || prevProps.accentColor !== this.props.accentColor) {\n      this._clear();\n\n      this._draw();\n    }\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    window.removeEventListener('scroll', this.handleScroll);\n    window.removeEventListener('resize', this.handleResize);\n\n    if (!this.state.paused && this.audio && this.props.deployPictureInPicture) {\n      this.props.deployPictureInPicture('audio', this._pack());\n    }\n  };\n\n  _proto._initAudioContext = function _initAudioContext() {\n    var AudioContext = window.AudioContext || window.webkitAudioContext;\n    var context = new AudioContext();\n    var source = context.createMediaElementSource(this.audio);\n    this.visualizer.setAudioContext(context, source);\n    source.connect(context.destination);\n    this.audioContext = context;\n  };\n\n  _proto._renderCanvas = function _renderCanvas() {\n    var _this2 = this;\n\n    requestAnimationFrame(function () {\n      if (!_this2.audio) return;\n\n      _this2.handleTimeUpdate();\n\n      _this2._clear();\n\n      _this2._draw();\n\n      if (!_this2.state.paused) {\n        _this2._renderCanvas();\n      }\n    });\n  };\n\n  _proto._clear = function _clear() {\n    this.visualizer.clear(this.state.width, this.state.height);\n  };\n\n  _proto._draw = function _draw() {\n    this.visualizer.draw(this._getCX(), this._getCY(), this._getAccentColor(), this._getRadius(), this._getScaleCoefficient());\n  };\n\n  _proto._getRadius = function _getRadius() {\n    return parseInt(((this.state.height || this.props.height) - PADDING * this._getScaleCoefficient() * 2) / 2);\n  };\n\n  _proto._getScaleCoefficient = function _getScaleCoefficient() {\n    return (this.state.height || this.props.height) / 982;\n  };\n\n  _proto._getCX = function _getCX() {\n    return Math.floor(this.state.width / 2);\n  };\n\n  _proto._getCY = function _getCY() {\n    return Math.floor(this._getRadius() + PADDING * this._getScaleCoefficient());\n  };\n\n  _proto._getAccentColor = function _getAccentColor() {\n    return this.props.accentColor || '#ffffff';\n  };\n\n  _proto._getBackgroundColor = function _getBackgroundColor() {\n    return this.props.backgroundColor || '#000000';\n  };\n\n  _proto._getForegroundColor = function _getForegroundColor() {\n    return this.props.foregroundColor || '#ffffff';\n  };\n\n  _proto.seekBy = function seekBy(time) {\n    var _this3 = this;\n\n    var currentTime = this.audio.currentTime + time;\n\n    if (!isNaN(currentTime)) {\n      this.setState({\n        currentTime\n      }, function () {\n        _this3.audio.currentTime = currentTime;\n      });\n    }\n  };\n\n  _proto.render = function render() {\n    var _this$props2 = this.props,\n        src = _this$props2.src,\n        intl = _this$props2.intl,\n        alt = _this$props2.alt,\n        editable = _this$props2.editable,\n        autoPlay = _this$props2.autoPlay;\n    var _this$state = this.state,\n        paused = _this$state.paused,\n        muted = _this$state.muted,\n        volume = _this$state.volume,\n        currentTime = _this$state.currentTime,\n        duration = _this$state.duration,\n        buffer = _this$state.buffer,\n        dragging = _this$state.dragging;\n    var progress = Math.min(currentTime / duration * 100, 100);\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: classNames('audio-player', {\n        editable\n      }),\n      ref: this.setPlayerRef,\n      style: {\n        backgroundColor: this._getBackgroundColor(),\n        color: this._getForegroundColor(),\n        width: '100%',\n        height: this.props.fullscreen ? '100%' : this.state.height || this.props.height\n      },\n      onMouseEnter: this.handleMouseEnter,\n      onMouseLeave: this.handleMouseLeave,\n      tabIndex: \"0\",\n      onKeyDown: this.handleKeyDown,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 441,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"audio\", {\n      src: src,\n      ref: this.setAudioRef,\n      preload: autoPlay ? 'auto' : 'none',\n      onPlay: this.handlePlay,\n      onPause: this.handlePause,\n      onProgress: this.handleProgress,\n      onLoadedData: this.handleLoadedData,\n      crossOrigin: \"anonymous\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 442,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"canvas\", {\n      role: \"button\",\n      tabIndex: \"0\",\n      className: \"audio-player__canvas\",\n      width: this.state.width,\n      height: this.state.height,\n      style: {\n        width: '100%',\n        position: 'absolute',\n        top: 0,\n        left: 0\n      },\n      ref: this.setCanvasRef,\n      onClick: this.togglePlay,\n      onKeyDown: this.handleAudioKeyDown,\n      title: alt,\n      \"aria-label\": alt,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 453,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"img\", {\n      src: this.props.poster,\n      alt: \"\",\n      width: (this._getRadius() - TICK_SIZE) * 2,\n      height: (this._getRadius() - TICK_SIZE) * 2,\n      style: {\n        position: 'absolute',\n        left: this._getCX(),\n        top: this._getCY(),\n        transform: 'translate(-50%, -50%)',\n        borderRadius: '50%',\n        pointerEvents: 'none'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 467,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__seek\",\n      onMouseDown: this.handleMouseDown,\n      ref: this.setSeekRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 475,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__seek__buffer\",\n      style: {\n        width: buffer + \"%\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 476,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__seek__progress\",\n      style: {\n        width: progress + \"%\",\n        backgroundColor: this._getAccentColor()\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 477,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: classNames('video-player__seek__handle', {\n        active: dragging\n      }),\n      tabIndex: \"0\",\n      style: {\n        left: progress + \"%\",\n        backgroundColor: this._getAccentColor()\n      },\n      onKeyDown: this.handleAudioKeyDown,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 479,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__controls active\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 487,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__buttons-bar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 488,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__buttons left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 489,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      title: intl.formatMessage(paused ? messages.play : messages.pause),\n      \"aria-label\": intl.formatMessage(paused ? messages.play : messages.pause),\n      className: \"player-button\",\n      onClick: this.togglePlay,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 490,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      id: paused ? 'play' : 'pause',\n      fixedWidth: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 490,\n        columnNumber: 230\n      }\n    })), /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      title: intl.formatMessage(muted ? messages.unmute : messages.mute),\n      \"aria-label\": intl.formatMessage(muted ? messages.unmute : messages.mute),\n      className: \"player-button\",\n      onClick: this.toggleMute,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 491,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      id: muted ? 'volume-off' : 'volume-up',\n      fixedWidth: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 491,\n        columnNumber: 230\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: classNames('video-player__volume', {\n        active: this.state.hovered\n      }),\n      ref: this.setVolumeRef,\n      onMouseDown: this.handleVolumeMouseDown,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 493,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__volume__current\",\n      style: {\n        width: volume * 100 + \"%\",\n        backgroundColor: this._getAccentColor()\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 494,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"video-player__volume__handle\",\n      tabIndex: \"0\",\n      style: {\n        left: volume * 100 + \"%\",\n        backgroundColor: this._getAccentColor()\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 496,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"video-player__time\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 503,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"video-player__time-current\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 504,\n        columnNumber: 17\n      }\n    }, formatTime(Math.floor(currentTime))), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"video-player__time-sep\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 505,\n        columnNumber: 17\n      }\n    }, \"/\"), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"video-player__time-total\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 506,\n        columnNumber: 17\n      }\n    }, formatTime(Math.floor(this.state.duration || this.props.duration))))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__buttons right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 510,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"a\", {\n      title: intl.formatMessage(messages.download),\n      \"aria-label\": intl.formatMessage(messages.download),\n      className: \"video-player__download__icon player-button\",\n      href: this.props.src,\n      download: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 511,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      id: 'download',\n      fixedWidth: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 512,\n        columnNumber: 17\n      }\n    }))))));\n  };\n\n  return Audio;\n}(React.PureComponent), _class2.propTypes = {\n  src: PropTypes.string.isRequired,\n  alt: PropTypes.string,\n  poster: PropTypes.string,\n  duration: PropTypes.number,\n  width: PropTypes.number,\n  height: PropTypes.number,\n  editable: PropTypes.bool,\n  fullscreen: PropTypes.bool,\n  intl: PropTypes.object.isRequired,\n  cacheWidth: PropTypes.func,\n  backgroundColor: PropTypes.string,\n  foregroundColor: PropTypes.string,\n  accentColor: PropTypes.string,\n  currentTime: PropTypes.number,\n  autoPlay: PropTypes.bool,\n  volume: PropTypes.number,\n  muted: PropTypes.bool,\n  deployPictureInPicture: PropTypes.func\n}, _temp)) || _class;\n\nexport { Audio as default };","map":{"version":3,"sources":["/home/runner/Mastodon/live/app/javascript/mastodon/features/audio/index.js"],"names":["React","PropTypes","defineMessages","injectIntl","formatTime","Icon","classNames","throttle","getPointerPosition","fileNameFromURL","debounce","Visualizer","messages","play","pause","mute","unmute","download","TICK_SIZE","PADDING","Audio","props","state","width","currentTime","buffer","duration","paused","muted","volume","dragging","setPlayerRef","c","player","_setDimensions","setSeekRef","seek","setVolumeRef","setAudioRef","audio","setState","setCanvasRef","canvas","visualizer","setCanvas","togglePlay","audioContext","_initAudioContext","handleResize","trailing","handlePlay","resume","_renderCanvas","handlePause","suspend","handleProgress","lastTimeRange","buffered","length","Math","ceil","end","toggleMute","handleVolumeMouseDown","e","document","addEventListener","handleMouseVolSlide","handleVolumeMouseUp","preventDefault","stopPropagation","removeEventListener","handleMouseDown","handleMouseMove","handleMouseUp","x","isNaN","handleTimeUpdate","handleScroll","getBoundingClientRect","top","height","inView","window","innerHeight","documentElement","clientHeight","deployPictureInPicture","_pack","handleMouseEnter","hovered","handleMouseLeave","handleLoadedData","autoPlay","undefined","handleDownload","fetch","src","then","res","blob","element","createElement","objectURL","URL","createObjectURL","setAttribute","body","appendChild","click","removeChild","revokeObjectURL","catch","err","console","error","handleAudioKeyDown","key","handleKeyDown","seekBy","poster","backgroundColor","foregroundColor","accentColor","offsetWidth","fullscreen","offsetHeight","cacheWidth","componentDidMount","passive","componentDidUpdate","prevProps","prevState","_clear","_draw","componentWillUnmount","AudioContext","webkitAudioContext","context","source","createMediaElementSource","setAudioContext","connect","destination","requestAnimationFrame","clear","draw","_getCX","_getCY","_getAccentColor","_getRadius","_getScaleCoefficient","parseInt","floor","_getBackgroundColor","_getForegroundColor","time","render","intl","alt","editable","progress","min","color","position","left","transform","borderRadius","pointerEvents","active","formatMessage","PureComponent","propTypes","string","isRequired","number","bool","object","func"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { defineMessages, injectIntl } from 'react-intl';\nimport { formatTime } from 'mastodon/features/video';\nimport Icon from 'mastodon/components/icon';\nimport classNames from 'classnames';\nimport { throttle } from 'lodash';\nimport { getPointerPosition, fileNameFromURL } from 'mastodon/features/video';\nimport { debounce } from 'lodash';\nimport Visualizer from './visualizer';\n\nconst messages = defineMessages({\n  play: { id: 'video.play', defaultMessage: 'Play' },\n  pause: { id: 'video.pause', defaultMessage: 'Pause' },\n  mute: { id: 'video.mute', defaultMessage: 'Mute sound' },\n  unmute: { id: 'video.unmute', defaultMessage: 'Unmute sound' },\n  download: { id: 'video.download', defaultMessage: 'Download file' },\n});\n\nconst TICK_SIZE = 10;\nconst PADDING   = 180;\n\nexport default @injectIntl\nclass Audio extends React.PureComponent {\n\n  static propTypes = {\n    src: PropTypes.string.isRequired,\n    alt: PropTypes.string,\n    poster: PropTypes.string,\n    duration: PropTypes.number,\n    width: PropTypes.number,\n    height: PropTypes.number,\n    editable: PropTypes.bool,\n    fullscreen: PropTypes.bool,\n    intl: PropTypes.object.isRequired,\n    cacheWidth: PropTypes.func,\n    backgroundColor: PropTypes.string,\n    foregroundColor: PropTypes.string,\n    accentColor: PropTypes.string,\n    currentTime: PropTypes.number,\n    autoPlay: PropTypes.bool,\n    volume: PropTypes.number,\n    muted: PropTypes.bool,\n    deployPictureInPicture: PropTypes.func,\n  };\n\n  state = {\n    width: this.props.width,\n    currentTime: 0,\n    buffer: 0,\n    duration: null,\n    paused: true,\n    muted: false,\n    volume: 0.5,\n    dragging: false,\n  };\n\n  constructor (props) {\n    super(props);\n    this.visualizer = new Visualizer(TICK_SIZE);\n  }\n\n  setPlayerRef = c => {\n    this.player = c;\n\n    if (this.player) {\n      this._setDimensions();\n    }\n  }\n\n  _pack() {\n    return {\n      src: this.props.src,\n      volume: this.audio.volume,\n      muted: this.audio.muted,\n      currentTime: this.audio.currentTime,\n      poster: this.props.poster,\n      backgroundColor: this.props.backgroundColor,\n      foregroundColor: this.props.foregroundColor,\n      accentColor: this.props.accentColor,\n    };\n  }\n\n  _setDimensions () {\n    const width  = this.player.offsetWidth;\n    const height = this.props.fullscreen ? this.player.offsetHeight : (width / (16/9));\n\n    if (this.props.cacheWidth) {\n      this.props.cacheWidth(width);\n    }\n\n    this.setState({ width, height });\n  }\n\n  setSeekRef = c => {\n    this.seek = c;\n  }\n\n  setVolumeRef = c => {\n    this.volume = c;\n  }\n\n  setAudioRef = c => {\n    this.audio = c;\n\n    if (this.audio) {\n      this.setState({ volume: this.audio.volume, muted: this.audio.muted });\n    }\n  }\n\n  setCanvasRef = c => {\n    this.canvas = c;\n\n    this.visualizer.setCanvas(c);\n  }\n\n  componentDidMount () {\n    window.addEventListener('scroll', this.handleScroll);\n    window.addEventListener('resize', this.handleResize, { passive: true });\n  }\n\n  componentDidUpdate (prevProps, prevState) {\n    if (prevProps.src !== this.props.src || this.state.width !== prevState.width || this.state.height !== prevState.height || prevProps.accentColor !== this.props.accentColor) {\n      this._clear();\n      this._draw();\n    }\n  }\n\n  componentWillUnmount () {\n    window.removeEventListener('scroll', this.handleScroll);\n    window.removeEventListener('resize', this.handleResize);\n\n    if (!this.state.paused && this.audio && this.props.deployPictureInPicture) {\n      this.props.deployPictureInPicture('audio', this._pack());\n    }\n  }\n\n  togglePlay = () => {\n    if (!this.audioContext) {\n      this._initAudioContext();\n    }\n\n    if (this.state.paused) {\n      this.setState({ paused: false }, () => this.audio.play());\n    } else {\n      this.setState({ paused: true }, () => this.audio.pause());\n    }\n  }\n\n  handleResize = debounce(() => {\n    if (this.player) {\n      this._setDimensions();\n    }\n  }, 250, {\n    trailing: true,\n  });\n\n  handlePlay = () => {\n    this.setState({ paused: false });\n\n    if (this.audioContext && this.audioContext.state === 'suspended') {\n      this.audioContext.resume();\n    }\n\n    this._renderCanvas();\n  }\n\n  handlePause = () => {\n    this.setState({ paused: true });\n\n    if (this.audioContext) {\n      this.audioContext.suspend();\n    }\n  }\n\n  handleProgress = () => {\n    const lastTimeRange = this.audio.buffered.length - 1;\n\n    if (lastTimeRange > -1) {\n      this.setState({ buffer: Math.ceil(this.audio.buffered.end(lastTimeRange) / this.audio.duration * 100) });\n    }\n  }\n\n  toggleMute = () => {\n    const muted = !this.state.muted;\n\n    this.setState({ muted }, () => {\n      this.audio.muted = muted;\n    });\n  }\n\n  handleVolumeMouseDown = e => {\n    document.addEventListener('mousemove', this.handleMouseVolSlide, true);\n    document.addEventListener('mouseup', this.handleVolumeMouseUp, true);\n    document.addEventListener('touchmove', this.handleMouseVolSlide, true);\n    document.addEventListener('touchend', this.handleVolumeMouseUp, true);\n\n    this.handleMouseVolSlide(e);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  handleVolumeMouseUp = () => {\n    document.removeEventListener('mousemove', this.handleMouseVolSlide, true);\n    document.removeEventListener('mouseup', this.handleVolumeMouseUp, true);\n    document.removeEventListener('touchmove', this.handleMouseVolSlide, true);\n    document.removeEventListener('touchend', this.handleVolumeMouseUp, true);\n  }\n\n  handleMouseDown = e => {\n    document.addEventListener('mousemove', this.handleMouseMove, true);\n    document.addEventListener('mouseup', this.handleMouseUp, true);\n    document.addEventListener('touchmove', this.handleMouseMove, true);\n    document.addEventListener('touchend', this.handleMouseUp, true);\n\n    this.setState({ dragging: true });\n    this.audio.pause();\n    this.handleMouseMove(e);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  handleMouseUp = () => {\n    document.removeEventListener('mousemove', this.handleMouseMove, true);\n    document.removeEventListener('mouseup', this.handleMouseUp, true);\n    document.removeEventListener('touchmove', this.handleMouseMove, true);\n    document.removeEventListener('touchend', this.handleMouseUp, true);\n\n    this.setState({ dragging: false });\n    this.audio.play();\n  }\n\n  handleMouseMove = throttle(e => {\n    const { x } = getPointerPosition(this.seek, e);\n    const currentTime = this.audio.duration * x;\n\n    if (!isNaN(currentTime)) {\n      this.setState({ currentTime }, () => {\n        this.audio.currentTime = currentTime;\n      });\n    }\n  }, 15);\n\n  handleTimeUpdate = () => {\n    this.setState({\n      currentTime: this.audio.currentTime,\n      duration: this.audio.duration,\n    });\n  }\n\n  handleMouseVolSlide = throttle(e => {\n    const { x } = getPointerPosition(this.volume, e);\n\n    if(!isNaN(x)) {\n      this.setState({ volume: x }, () => {\n        this.audio.volume = x;\n      });\n    }\n  }, 15);\n\n  handleScroll = throttle(() => {\n    if (!this.canvas || !this.audio) {\n      return;\n    }\n\n    const { top, height } = this.canvas.getBoundingClientRect();\n    const inView = (top <= (window.innerHeight || document.documentElement.clientHeight)) && (top + height >= 0);\n\n    if (!this.state.paused && !inView) {\n      this.audio.pause();\n\n      if (this.props.deployPictureInPicture) {\n        this.props.deployPictureInPicture('audio', this._pack());\n      }\n\n      this.setState({ paused: true });\n    }\n  }, 150, { trailing: true });\n\n  handleMouseEnter = () => {\n    this.setState({ hovered: true });\n  }\n\n  handleMouseLeave = () => {\n    this.setState({ hovered: false });\n  }\n\n  handleLoadedData = () => {\n    const { autoPlay, currentTime, volume, muted } = this.props;\n\n    if (currentTime) {\n      this.audio.currentTime = currentTime;\n    }\n\n    if (volume !== undefined) {\n      this.audio.volume = volume;\n    }\n\n    if (muted !== undefined) {\n      this.audio.muted = muted;\n    }\n\n    if (autoPlay) {\n      this.togglePlay();\n    }\n  }\n\n  _initAudioContext () {\n    const AudioContext = window.AudioContext || window.webkitAudioContext;\n    const context      = new AudioContext();\n    const source       = context.createMediaElementSource(this.audio);\n\n    this.visualizer.setAudioContext(context, source);\n    source.connect(context.destination);\n\n    this.audioContext = context;\n  }\n\n  handleDownload = () => {\n    fetch(this.props.src).then(res => res.blob()).then(blob => {\n      const element   = document.createElement('a');\n      const objectURL = URL.createObjectURL(blob);\n\n      element.setAttribute('href', objectURL);\n      element.setAttribute('download', fileNameFromURL(this.props.src));\n\n      document.body.appendChild(element);\n      element.click();\n      document.body.removeChild(element);\n\n      URL.revokeObjectURL(objectURL);\n    }).catch(err => {\n      console.error(err);\n    });\n  }\n\n  _renderCanvas () {\n    requestAnimationFrame(() => {\n      if (!this.audio) return;\n\n      this.handleTimeUpdate();\n      this._clear();\n      this._draw();\n\n      if (!this.state.paused) {\n        this._renderCanvas();\n      }\n    });\n  }\n\n  _clear() {\n    this.visualizer.clear(this.state.width, this.state.height);\n  }\n\n  _draw() {\n    this.visualizer.draw(this._getCX(), this._getCY(), this._getAccentColor(), this._getRadius(), this._getScaleCoefficient());\n  }\n\n  _getRadius () {\n    return parseInt(((this.state.height || this.props.height) - (PADDING * this._getScaleCoefficient()) * 2) / 2);\n  }\n\n  _getScaleCoefficient () {\n    return (this.state.height || this.props.height) / 982;\n  }\n\n  _getCX() {\n    return Math.floor(this.state.width / 2);\n  }\n\n  _getCY() {\n    return Math.floor(this._getRadius() + (PADDING * this._getScaleCoefficient()));\n  }\n\n  _getAccentColor () {\n    return this.props.accentColor || '#ffffff';\n  }\n\n  _getBackgroundColor () {\n    return this.props.backgroundColor || '#000000';\n  }\n\n  _getForegroundColor () {\n    return this.props.foregroundColor || '#ffffff';\n  }\n\n  seekBy (time) {\n    const currentTime = this.audio.currentTime + time;\n\n    if (!isNaN(currentTime)) {\n      this.setState({ currentTime }, () => {\n        this.audio.currentTime = currentTime;\n      });\n    }\n  }\n\n  handleAudioKeyDown = e => {\n    // On the audio element or the seek bar, we can safely use the space bar\n    // for playback control because there are no buttons to press\n\n    if (e.key === ' ') {\n      e.preventDefault();\n      e.stopPropagation();\n      this.togglePlay();\n    }\n  }\n\n  handleKeyDown = e => {\n    switch(e.key) {\n    case 'k':\n      e.preventDefault();\n      e.stopPropagation();\n      this.togglePlay();\n      break;\n    case 'm':\n      e.preventDefault();\n      e.stopPropagation();\n      this.toggleMute();\n      break;\n    case 'j':\n      e.preventDefault();\n      e.stopPropagation();\n      this.seekBy(-10);\n      break;\n    case 'l':\n      e.preventDefault();\n      e.stopPropagation();\n      this.seekBy(10);\n      break;\n    }\n  }\n\n  render () {\n    const { src, intl, alt, editable, autoPlay } = this.props;\n    const { paused, muted, volume, currentTime, duration, buffer, dragging } = this.state;\n    const progress = Math.min((currentTime / duration) * 100, 100);\n\n    return (\n      <div className={classNames('audio-player', { editable })} ref={this.setPlayerRef} style={{ backgroundColor: this._getBackgroundColor(), color: this._getForegroundColor(), width: '100%', height: this.props.fullscreen ? '100%' : (this.state.height || this.props.height) }} onMouseEnter={this.handleMouseEnter} onMouseLeave={this.handleMouseLeave} tabIndex='0' onKeyDown={this.handleKeyDown}>\n        <audio\n          src={src}\n          ref={this.setAudioRef}\n          preload={autoPlay ? 'auto' : 'none'}\n          onPlay={this.handlePlay}\n          onPause={this.handlePause}\n          onProgress={this.handleProgress}\n          onLoadedData={this.handleLoadedData}\n          crossOrigin='anonymous'\n        />\n\n        <canvas\n          role='button'\n          tabIndex='0'\n          className='audio-player__canvas'\n          width={this.state.width}\n          height={this.state.height}\n          style={{ width: '100%', position: 'absolute', top: 0, left: 0 }}\n          ref={this.setCanvasRef}\n          onClick={this.togglePlay}\n          onKeyDown={this.handleAudioKeyDown}\n          title={alt}\n          aria-label={alt}\n        />\n\n        <img\n          src={this.props.poster}\n          alt=''\n          width={(this._getRadius() - TICK_SIZE) * 2}\n          height={(this._getRadius() - TICK_SIZE) * 2}\n          style={{ position: 'absolute', left: this._getCX(), top: this._getCY(), transform: 'translate(-50%, -50%)', borderRadius: '50%', pointerEvents: 'none' }}\n        />\n\n        <div className='video-player__seek' onMouseDown={this.handleMouseDown} ref={this.setSeekRef}>\n          <div className='video-player__seek__buffer' style={{ width: `${buffer}%` }} />\n          <div className='video-player__seek__progress' style={{ width: `${progress}%`, backgroundColor: this._getAccentColor() }} />\n\n          <span\n            className={classNames('video-player__seek__handle', { active: dragging })}\n            tabIndex='0'\n            style={{ left: `${progress}%`, backgroundColor: this._getAccentColor() }}\n            onKeyDown={this.handleAudioKeyDown}\n          />\n        </div>\n\n        <div className='video-player__controls active'>\n          <div className='video-player__buttons-bar'>\n            <div className='video-player__buttons left'>\n              <button type='button' title={intl.formatMessage(paused ? messages.play : messages.pause)} aria-label={intl.formatMessage(paused ? messages.play : messages.pause)} className='player-button' onClick={this.togglePlay}><Icon id={paused ? 'play' : 'pause'} fixedWidth /></button>\n              <button type='button' title={intl.formatMessage(muted ? messages.unmute : messages.mute)} aria-label={intl.formatMessage(muted ? messages.unmute : messages.mute)} className='player-button' onClick={this.toggleMute}><Icon id={muted ? 'volume-off' : 'volume-up'} fixedWidth /></button>\n\n              <div className={classNames('video-player__volume', { active: this.state.hovered })} ref={this.setVolumeRef} onMouseDown={this.handleVolumeMouseDown}>\n                <div className='video-player__volume__current' style={{ width: `${volume * 100}%`, backgroundColor: this._getAccentColor() }} />\n\n                <span\n                  className='video-player__volume__handle'\n                  tabIndex='0'\n                  style={{ left: `${volume * 100}%`, backgroundColor: this._getAccentColor() }}\n                />\n              </div>\n\n              <span className='video-player__time'>\n                <span className='video-player__time-current'>{formatTime(Math.floor(currentTime))}</span>\n                <span className='video-player__time-sep'>/</span>\n                <span className='video-player__time-total'>{formatTime(Math.floor(this.state.duration || this.props.duration))}</span>\n              </span>\n            </div>\n\n            <div className='video-player__buttons right'>\n              <a title={intl.formatMessage(messages.download)} aria-label={intl.formatMessage(messages.download)} className='video-player__download__icon player-button' href={this.props.src} download>\n                <Icon id={'download'} fixedWidth />\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n}\n"]},"metadata":{"react-intl":{"messages":[{"id":"video.play","defaultMessage":"Play"},{"id":"video.pause","defaultMessage":"Pause"},{"id":"video.mute","defaultMessage":"Mute sound"},{"id":"video.unmute","defaultMessage":"Unmute sound"},{"id":"video.download","defaultMessage":"Download file"}]}},"sourceType":"module"}