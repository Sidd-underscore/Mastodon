{"ast":null,"code":"var _jsxFileName = \"/home/runner/Mastodon/live/app/javascript/mastodon/features/video/index.js\",\n    _class,\n    _class2,\n    _temp;\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { defineMessages, injectIntl, FormattedMessage } from 'react-intl';\nimport { is } from 'immutable';\nimport { throttle, debounce } from 'lodash';\nimport classNames from 'classnames';\nimport { isFullscreen, requestFullscreen, exitFullscreen } from '../ui/util/fullscreen';\nimport { displayMedia, useBlurhash } from '../../initial_state';\nimport Icon from 'mastodon/components/icon';\nimport Blurhash from 'mastodon/components/blurhash';\nvar messages = defineMessages({\n  play: {\n    \"id\": \"video.play\",\n    \"defaultMessage\": \"Play\"\n  },\n  pause: {\n    \"id\": \"video.pause\",\n    \"defaultMessage\": \"Pause\"\n  },\n  mute: {\n    \"id\": \"video.mute\",\n    \"defaultMessage\": \"Mute sound\"\n  },\n  unmute: {\n    \"id\": \"video.unmute\",\n    \"defaultMessage\": \"Unmute sound\"\n  },\n  hide: {\n    \"id\": \"video.hide\",\n    \"defaultMessage\": \"Hide video\"\n  },\n  expand: {\n    \"id\": \"video.expand\",\n    \"defaultMessage\": \"Expand video\"\n  },\n  close: {\n    \"id\": \"video.close\",\n    \"defaultMessage\": \"Close video\"\n  },\n  fullscreen: {\n    \"id\": \"video.fullscreen\",\n    \"defaultMessage\": \"Full screen\"\n  },\n  exit_fullscreen: {\n    \"id\": \"video.exit_fullscreen\",\n    \"defaultMessage\": \"Exit full screen\"\n  }\n});\nexport var formatTime = function formatTime(secondsNum) {\n  var hours = Math.floor(secondsNum / 3600);\n  var minutes = Math.floor((secondsNum - hours * 3600) / 60);\n  var seconds = secondsNum - hours * 3600 - minutes * 60;\n  if (hours < 10) hours = '0' + hours;\n  if (minutes < 10) minutes = '0' + minutes;\n  if (seconds < 10) seconds = '0' + seconds;\n  return (hours === '00' ? '' : hours + \":\") + (minutes + \":\" + seconds);\n};\nexport var findElementPosition = function findElementPosition(el) {\n  var box;\n\n  if (el.getBoundingClientRect && el.parentNode) {\n    box = el.getBoundingClientRect();\n  }\n\n  if (!box) {\n    return {\n      left: 0,\n      top: 0\n    };\n  }\n\n  var docEl = document.documentElement;\n  var body = document.body;\n  var clientLeft = docEl.clientLeft || body.clientLeft || 0;\n  var scrollLeft = window.pageXOffset || body.scrollLeft;\n  var left = box.left + scrollLeft - clientLeft;\n  var clientTop = docEl.clientTop || body.clientTop || 0;\n  var scrollTop = window.pageYOffset || body.scrollTop;\n  var top = box.top + scrollTop - clientTop;\n  return {\n    left: Math.round(left),\n    top: Math.round(top)\n  };\n};\nexport var getPointerPosition = function getPointerPosition(el, event) {\n  var position = {};\n  var box = findElementPosition(el);\n  var boxW = el.offsetWidth;\n  var boxH = el.offsetHeight;\n  var boxY = box.top;\n  var boxX = box.left;\n  var pageY = event.pageY;\n  var pageX = event.pageX;\n\n  if (event.changedTouches) {\n    pageX = event.changedTouches[0].pageX;\n    pageY = event.changedTouches[0].pageY;\n  }\n\n  position.y = Math.max(0, Math.min(1, (pageY - boxY) / boxH));\n  position.x = Math.max(0, Math.min(1, (pageX - boxX) / boxW));\n  return position;\n};\nexport var fileNameFromURL = function fileNameFromURL(str) {\n  var url = new URL(str);\n  var pathname = url.pathname;\n  var index = pathname.lastIndexOf('/');\n  return pathname.substring(index + 1);\n};\n\nvar Video = injectIntl(_class = (_temp = _class2 = /*#__PURE__*/function (_React$PureComponent) {\n  _inheritsLoose(Video, _React$PureComponent);\n\n  function Video() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$PureComponent.call.apply(_React$PureComponent, [this].concat(args)) || this;\n    _this.state = {\n      currentTime: 0,\n      duration: 0,\n      volume: 0.5,\n      paused: true,\n      dragging: false,\n      containerWidth: _this.props.width,\n      fullscreen: false,\n      hovered: false,\n      muted: false,\n      revealed: _this.props.visible !== undefined ? _this.props.visible : displayMedia !== 'hide_all' && !_this.props.sensitive || displayMedia === 'show_all'\n    };\n\n    _this.setPlayerRef = function (c) {\n      _this.player = c;\n\n      if (_this.player) {\n        _this._setDimensions();\n      }\n    };\n\n    _this.setVideoRef = function (c) {\n      _this.video = c;\n\n      if (_this.video) {\n        _this.setState({\n          volume: _this.video.volume,\n          muted: _this.video.muted\n        });\n      }\n    };\n\n    _this.setSeekRef = function (c) {\n      _this.seek = c;\n    };\n\n    _this.setVolumeRef = function (c) {\n      _this.volume = c;\n    };\n\n    _this.handleClickRoot = function (e) {\n      return e.stopPropagation();\n    };\n\n    _this.handlePlay = function () {\n      _this.setState({\n        paused: false\n      });\n\n      _this._updateTime();\n    };\n\n    _this.handlePause = function () {\n      _this.setState({\n        paused: true\n      });\n    };\n\n    _this.handleTimeUpdate = function () {\n      _this.setState({\n        currentTime: _this.video.currentTime,\n        duration: _this.video.duration\n      });\n    };\n\n    _this.handleVolumeMouseDown = function (e) {\n      document.addEventListener('mousemove', _this.handleMouseVolSlide, true);\n      document.addEventListener('mouseup', _this.handleVolumeMouseUp, true);\n      document.addEventListener('touchmove', _this.handleMouseVolSlide, true);\n      document.addEventListener('touchend', _this.handleVolumeMouseUp, true);\n\n      _this.handleMouseVolSlide(e);\n\n      e.preventDefault();\n      e.stopPropagation();\n    };\n\n    _this.handleVolumeMouseUp = function () {\n      document.removeEventListener('mousemove', _this.handleMouseVolSlide, true);\n      document.removeEventListener('mouseup', _this.handleVolumeMouseUp, true);\n      document.removeEventListener('touchmove', _this.handleMouseVolSlide, true);\n      document.removeEventListener('touchend', _this.handleVolumeMouseUp, true);\n    };\n\n    _this.handleMouseVolSlide = throttle(function (e) {\n      var _getPointerPosition = getPointerPosition(_this.volume, e),\n          x = _getPointerPosition.x;\n\n      if (!isNaN(x)) {\n        _this.setState({\n          volume: x\n        }, function () {\n          _this.video.volume = x;\n        });\n      }\n    }, 15);\n\n    _this.handleMouseDown = function (e) {\n      document.addEventListener('mousemove', _this.handleMouseMove, true);\n      document.addEventListener('mouseup', _this.handleMouseUp, true);\n      document.addEventListener('touchmove', _this.handleMouseMove, true);\n      document.addEventListener('touchend', _this.handleMouseUp, true);\n\n      _this.setState({\n        dragging: true\n      });\n\n      _this.video.pause();\n\n      _this.handleMouseMove(e);\n\n      e.preventDefault();\n      e.stopPropagation();\n    };\n\n    _this.handleMouseUp = function () {\n      document.removeEventListener('mousemove', _this.handleMouseMove, true);\n      document.removeEventListener('mouseup', _this.handleMouseUp, true);\n      document.removeEventListener('touchmove', _this.handleMouseMove, true);\n      document.removeEventListener('touchend', _this.handleMouseUp, true);\n\n      _this.setState({\n        dragging: false\n      });\n\n      _this.video.play();\n    };\n\n    _this.handleMouseMove = throttle(function (e) {\n      var _getPointerPosition2 = getPointerPosition(_this.seek, e),\n          x = _getPointerPosition2.x;\n\n      var currentTime = _this.video.duration * x;\n\n      if (!isNaN(currentTime)) {\n        _this.setState({\n          currentTime\n        }, function () {\n          _this.video.currentTime = currentTime;\n        });\n      }\n    }, 15);\n\n    _this.handleVideoKeyDown = function (e) {\n      // On the video element or the seek bar, we can safely use the space bar\n      // for playback control because there are no buttons to press\n      if (e.key === ' ') {\n        e.preventDefault();\n        e.stopPropagation();\n\n        _this.togglePlay();\n      }\n    };\n\n    _this.handleKeyDown = function (e) {\n      var frameTime = 1 / _this.getFrameRate();\n\n      switch (e.key) {\n        case 'k':\n          e.preventDefault();\n          e.stopPropagation();\n\n          _this.togglePlay();\n\n          break;\n\n        case 'm':\n          e.preventDefault();\n          e.stopPropagation();\n\n          _this.toggleMute();\n\n          break;\n\n        case 'f':\n          e.preventDefault();\n          e.stopPropagation();\n\n          _this.toggleFullscreen();\n\n          break;\n\n        case 'j':\n          e.preventDefault();\n          e.stopPropagation();\n\n          _this.seekBy(-10);\n\n          break;\n\n        case 'l':\n          e.preventDefault();\n          e.stopPropagation();\n\n          _this.seekBy(10);\n\n          break;\n\n        case ',':\n          e.preventDefault();\n          e.stopPropagation();\n\n          _this.seekBy(-frameTime);\n\n          break;\n\n        case '.':\n          e.preventDefault();\n          e.stopPropagation();\n\n          _this.seekBy(frameTime);\n\n          break;\n      } // If we are in fullscreen mode, we don't want any hotkeys\n      // interacting with the UI that's not visible\n\n\n      if (_this.state.fullscreen) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (e.key === 'Escape') {\n          exitFullscreen();\n        }\n      }\n    };\n\n    _this.togglePlay = function () {\n      if (_this.state.paused) {\n        _this.setState({\n          paused: false\n        }, function () {\n          return _this.video.play();\n        });\n      } else {\n        _this.setState({\n          paused: true\n        }, function () {\n          return _this.video.pause();\n        });\n      }\n    };\n\n    _this.toggleFullscreen = function () {\n      if (isFullscreen()) {\n        exitFullscreen();\n      } else {\n        requestFullscreen(_this.player);\n      }\n    };\n\n    _this.handleResize = debounce(function () {\n      if (_this.player) {\n        _this._setDimensions();\n      }\n    }, 250, {\n      trailing: true\n    });\n    _this.handleScroll = throttle(function () {\n      if (!_this.video) {\n        return;\n      }\n\n      var _this$video$getBoundi = _this.video.getBoundingClientRect(),\n          top = _this$video$getBoundi.top,\n          height = _this$video$getBoundi.height;\n\n      var inView = top <= (window.innerHeight || document.documentElement.clientHeight) && top + height >= 0;\n\n      if (!_this.state.paused && !inView) {\n        _this.video.pause();\n\n        if (_this.props.deployPictureInPicture) {\n          _this.props.deployPictureInPicture('video', {\n            src: _this.props.src,\n            currentTime: _this.video.currentTime,\n            muted: _this.video.muted,\n            volume: _this.video.volume\n          });\n        }\n\n        _this.setState({\n          paused: true\n        });\n      }\n    }, 150, {\n      trailing: true\n    });\n\n    _this.handleFullscreenChange = function () {\n      _this.setState({\n        fullscreen: isFullscreen()\n      });\n    };\n\n    _this.handleMouseEnter = function () {\n      _this.setState({\n        hovered: true\n      });\n    };\n\n    _this.handleMouseLeave = function () {\n      _this.setState({\n        hovered: false\n      });\n    };\n\n    _this.toggleMute = function () {\n      var muted = !_this.video.muted;\n\n      _this.setState({\n        muted\n      }, function () {\n        _this.video.muted = muted;\n      });\n    };\n\n    _this.toggleReveal = function () {\n      if (_this.props.onToggleVisibility) {\n        _this.props.onToggleVisibility();\n      } else {\n        _this.setState({\n          revealed: !_this.state.revealed\n        });\n      }\n    };\n\n    _this.handleLoadedData = function () {\n      var _this$props = _this.props,\n          currentTime = _this$props.currentTime,\n          volume = _this$props.volume,\n          muted = _this$props.muted,\n          autoPlay = _this$props.autoPlay;\n\n      if (currentTime) {\n        _this.video.currentTime = currentTime;\n      }\n\n      if (volume !== undefined) {\n        _this.video.volume = volume;\n      }\n\n      if (muted !== undefined) {\n        _this.video.muted = muted;\n      }\n\n      if (autoPlay) {\n        _this.video.play();\n      }\n    };\n\n    _this.handleProgress = function () {\n      var lastTimeRange = _this.video.buffered.length - 1;\n\n      if (lastTimeRange > -1) {\n        _this.setState({\n          buffer: Math.ceil(_this.video.buffered.end(lastTimeRange) / _this.video.duration * 100)\n        });\n      }\n    };\n\n    _this.handleVolumeChange = function () {\n      _this.setState({\n        volume: _this.video.volume,\n        muted: _this.video.muted\n      });\n    };\n\n    _this.handleOpenVideo = function () {\n      _this.video.pause();\n\n      _this.props.onOpenVideo({\n        startTime: _this.video.currentTime,\n        autoPlay: !_this.state.paused,\n        defaultVolume: _this.state.volume,\n        componetIndex: _this.props.componetIndex\n      });\n    };\n\n    _this.handleCloseVideo = function () {\n      _this.video.pause();\n\n      _this.props.onCloseVideo();\n    };\n\n    return _this;\n  }\n\n  var _proto = Video.prototype;\n\n  _proto._setDimensions = function _setDimensions() {\n    var width = this.player.offsetWidth;\n\n    if (this.props.cacheWidth) {\n      this.props.cacheWidth(width);\n    }\n\n    this.setState({\n      containerWidth: width\n    });\n  };\n\n  _proto._updateTime = function _updateTime() {\n    var _this2 = this;\n\n    requestAnimationFrame(function () {\n      if (!_this2.video) return;\n\n      _this2.handleTimeUpdate();\n\n      if (!_this2.state.paused) {\n        _this2._updateTime();\n      }\n    });\n  };\n\n  _proto.seekBy = function seekBy(time) {\n    var _this3 = this;\n\n    var currentTime = this.video.currentTime + time;\n\n    if (!isNaN(currentTime)) {\n      this.setState({\n        currentTime\n      }, function () {\n        _this3.video.currentTime = currentTime;\n      });\n    }\n  };\n\n  _proto.componentDidMount = function componentDidMount() {\n    document.addEventListener('fullscreenchange', this.handleFullscreenChange, true);\n    document.addEventListener('webkitfullscreenchange', this.handleFullscreenChange, true);\n    document.addEventListener('mozfullscreenchange', this.handleFullscreenChange, true);\n    document.addEventListener('MSFullscreenChange', this.handleFullscreenChange, true);\n    window.addEventListener('scroll', this.handleScroll);\n    window.addEventListener('resize', this.handleResize, {\n      passive: true\n    });\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    window.removeEventListener('scroll', this.handleScroll);\n    window.removeEventListener('resize', this.handleResize);\n    document.removeEventListener('fullscreenchange', this.handleFullscreenChange, true);\n    document.removeEventListener('webkitfullscreenchange', this.handleFullscreenChange, true);\n    document.removeEventListener('mozfullscreenchange', this.handleFullscreenChange, true);\n    document.removeEventListener('MSFullscreenChange', this.handleFullscreenChange, true);\n\n    if (!this.state.paused && this.video && this.props.deployPictureInPicture) {\n      this.props.deployPictureInPicture('video', {\n        src: this.props.src,\n        currentTime: this.video.currentTime,\n        muted: this.video.muted,\n        volume: this.video.volume\n      });\n    }\n  };\n\n  _proto.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    if (!is(nextProps.visible, this.props.visible) && nextProps.visible !== undefined) {\n      this.setState({\n        revealed: nextProps.visible\n      });\n    }\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate(prevProps, prevState) {\n    if (prevState.revealed && !this.state.revealed && this.video) {\n      this.video.pause();\n    }\n  };\n\n  _proto.getFrameRate = function getFrameRate() {\n    if (this.props.frameRate && isNaN(this.props.frameRate)) {\n      // The frame rate is returned as a fraction string so we\n      // need to convert it to a number\n      return this.props.frameRate.split('/').reduce(function (p, c) {\n        return p / c;\n      });\n    }\n\n    return this.props.frameRate;\n  };\n\n  _proto.render = function render() {\n    var _this$props2 = this.props,\n        preview = _this$props2.preview,\n        src = _this$props2.src,\n        inline = _this$props2.inline,\n        onOpenVideo = _this$props2.onOpenVideo,\n        onCloseVideo = _this$props2.onCloseVideo,\n        intl = _this$props2.intl,\n        alt = _this$props2.alt,\n        detailed = _this$props2.detailed,\n        sensitive = _this$props2.sensitive,\n        editable = _this$props2.editable,\n        blurhash = _this$props2.blurhash;\n    var _this$state = this.state,\n        containerWidth = _this$state.containerWidth,\n        currentTime = _this$state.currentTime,\n        duration = _this$state.duration,\n        volume = _this$state.volume,\n        buffer = _this$state.buffer,\n        dragging = _this$state.dragging,\n        paused = _this$state.paused,\n        fullscreen = _this$state.fullscreen,\n        hovered = _this$state.hovered,\n        muted = _this$state.muted,\n        revealed = _this$state.revealed;\n    var progress = Math.min(currentTime / duration * 100, 100);\n    var playerStyle = {};\n    var _this$props3 = this.props,\n        width = _this$props3.width,\n        height = _this$props3.height;\n\n    if (inline && containerWidth) {\n      width = containerWidth;\n      height = containerWidth / (16 / 9);\n      playerStyle.height = height;\n    }\n\n    var preload;\n\n    if (this.props.currentTime || fullscreen || dragging) {\n      preload = 'auto';\n    } else if (detailed) {\n      preload = 'metadata';\n    } else {\n      preload = 'none';\n    }\n\n    var warning;\n\n    if (sensitive) {\n      warning = /*#__PURE__*/React.createElement(FormattedMessage, {\n        id: \"status.sensitive_warning\",\n        defaultMessage: \"Sensitive content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 553,\n          columnNumber: 17\n        }\n      });\n    } else {\n      warning = /*#__PURE__*/React.createElement(FormattedMessage, {\n        id: \"status.media_hidden\",\n        defaultMessage: \"Media hidden\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 555,\n          columnNumber: 17\n        }\n      });\n    }\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      role: \"menuitem\",\n      className: classNames('video-player', {\n        inactive: !revealed,\n        detailed,\n        inline: inline && !fullscreen,\n        fullscreen,\n        editable\n      }),\n      style: playerStyle,\n      ref: this.setPlayerRef,\n      onMouseEnter: this.handleMouseEnter,\n      onMouseLeave: this.handleMouseLeave,\n      onClick: this.handleClickRoot,\n      onKeyDown: this.handleKeyDown,\n      tabIndex: 0,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 559,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Blurhash, {\n      hash: blurhash,\n      className: classNames('media-gallery__preview', {\n        'media-gallery__preview--hidden': revealed\n      }),\n      dummy: !useBlurhash,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 570,\n        columnNumber: 9\n      }\n    }), (revealed || editable) && /*#__PURE__*/React.createElement(\"video\", {\n      ref: this.setVideoRef,\n      src: src,\n      poster: preview,\n      preload: preload,\n      role: \"button\",\n      tabIndex: \"0\",\n      \"aria-label\": alt,\n      title: alt,\n      width: width,\n      height: height,\n      volume: volume,\n      onClick: this.togglePlay,\n      onKeyDown: this.handleVideoKeyDown,\n      onPlay: this.handlePlay,\n      onPause: this.handlePause,\n      onLoadedData: this.handleLoadedData,\n      onProgress: this.handleProgress,\n      onVolumeChange: this.handleVolumeChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 578,\n        columnNumber: 36\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: classNames('spoiler-button', {\n        'spoiler-button--hidden': revealed || editable\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 599,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      className: \"spoiler-button__overlay\",\n      onClick: this.toggleReveal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 600,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"spoiler-button__overlay__label\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 601,\n        columnNumber: 13\n      }\n    }, warning))), /*#__PURE__*/React.createElement(\"div\", {\n      className: classNames('video-player__controls', {\n        active: paused || hovered\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 605,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__seek\",\n      onMouseDown: this.handleMouseDown,\n      ref: this.setSeekRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 606,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__seek__buffer\",\n      style: {\n        width: buffer + \"%\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 607,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__seek__progress\",\n      style: {\n        width: progress + \"%\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 608,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: classNames('video-player__seek__handle', {\n        active: dragging\n      }),\n      tabIndex: \"0\",\n      style: {\n        left: progress + \"%\"\n      },\n      onKeyDown: this.handleVideoKeyDown,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 610,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__buttons-bar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 618,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__buttons left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 619,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      title: intl.formatMessage(paused ? messages.play : messages.pause),\n      \"aria-label\": intl.formatMessage(paused ? messages.play : messages.pause),\n      className: \"player-button\",\n      onClick: this.togglePlay,\n      autoFocus: detailed,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 620,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      id: paused ? 'play' : 'pause',\n      fixedWidth: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 620,\n        columnNumber: 251\n      }\n    })), /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      title: intl.formatMessage(muted ? messages.unmute : messages.mute),\n      \"aria-label\": intl.formatMessage(muted ? messages.unmute : messages.mute),\n      className: \"player-button\",\n      onClick: this.toggleMute,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 621,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      id: muted ? 'volume-off' : 'volume-up',\n      fixedWidth: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 621,\n        columnNumber: 230\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: classNames('video-player__volume', {\n        active: this.state.hovered\n      }),\n      onMouseDown: this.handleVolumeMouseDown,\n      ref: this.setVolumeRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 623,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__volume__current\",\n      style: {\n        width: volume * 100 + \"%\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 624,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: classNames('video-player__volume__handle'),\n      tabIndex: \"0\",\n      style: {\n        left: volume * 100 + \"%\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 626,\n        columnNumber: 17\n      }\n    })), (detailed || fullscreen) && /*#__PURE__*/React.createElement(\"span\", {\n      className: \"video-player__time\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 634,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"video-player__time-current\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 635,\n        columnNumber: 19\n      }\n    }, formatTime(Math.floor(currentTime))), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"video-player__time-sep\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 636,\n        columnNumber: 19\n      }\n    }, \"/\"), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"video-player__time-total\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 637,\n        columnNumber: 19\n      }\n    }, formatTime(Math.floor(duration))))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-player__buttons right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 642,\n        columnNumber: 13\n      }\n    }, !onCloseVideo && !editable && !fullscreen && !this.props.alwaysVisible && /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      title: intl.formatMessage(messages.hide),\n      \"aria-label\": intl.formatMessage(messages.hide),\n      className: \"player-button\",\n      onClick: this.toggleReveal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 643,\n        columnNumber: 92\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      id: \"eye-slash\",\n      fixedWidth: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 643,\n        columnNumber: 257\n      }\n    })), !fullscreen && onOpenVideo && /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      title: intl.formatMessage(messages.expand),\n      \"aria-label\": intl.formatMessage(messages.expand),\n      className: \"player-button\",\n      onClick: this.handleOpenVideo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 644,\n        columnNumber: 48\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      id: \"expand\",\n      fixedWidth: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 644,\n        columnNumber: 220\n      }\n    })), onCloseVideo && /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      title: intl.formatMessage(messages.close),\n      \"aria-label\": intl.formatMessage(messages.close),\n      className: \"player-button\",\n      onClick: this.handleCloseVideo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 645,\n        columnNumber: 32\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      id: \"compress\",\n      fixedWidth: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 645,\n        columnNumber: 203\n      }\n    })), /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      title: intl.formatMessage(fullscreen ? messages.exit_fullscreen : messages.fullscreen),\n      \"aria-label\": intl.formatMessage(fullscreen ? messages.exit_fullscreen : messages.fullscreen),\n      className: \"player-button\",\n      onClick: this.toggleFullscreen,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 646,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      id: fullscreen ? 'compress' : 'arrows-alt',\n      fixedWidth: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 646,\n        columnNumber: 276\n      }\n    }))))));\n  };\n\n  return Video;\n}(React.PureComponent), _class2.propTypes = {\n  preview: PropTypes.string,\n  frameRate: PropTypes.string,\n  src: PropTypes.string.isRequired,\n  alt: PropTypes.string,\n  width: PropTypes.number,\n  height: PropTypes.number,\n  sensitive: PropTypes.bool,\n  currentTime: PropTypes.number,\n  onOpenVideo: PropTypes.func,\n  onCloseVideo: PropTypes.func,\n  detailed: PropTypes.bool,\n  inline: PropTypes.bool,\n  editable: PropTypes.bool,\n  alwaysVisible: PropTypes.bool,\n  cacheWidth: PropTypes.func,\n  visible: PropTypes.bool,\n  onToggleVisibility: PropTypes.func,\n  deployPictureInPicture: PropTypes.func,\n  intl: PropTypes.object.isRequired,\n  blurhash: PropTypes.string,\n  autoPlay: PropTypes.bool,\n  volume: PropTypes.number,\n  muted: PropTypes.bool,\n  componetIndex: PropTypes.number\n}, _class2.defaultProps = {\n  frameRate: '25'\n}, _temp)) || _class;\n\nexport { Video as default };","map":{"version":3,"sources":["/home/runner/Mastodon/live/app/javascript/mastodon/features/video/index.js"],"names":["React","PropTypes","defineMessages","injectIntl","FormattedMessage","is","throttle","debounce","classNames","isFullscreen","requestFullscreen","exitFullscreen","displayMedia","useBlurhash","Icon","Blurhash","messages","play","pause","mute","unmute","hide","expand","close","fullscreen","exit_fullscreen","formatTime","secondsNum","hours","Math","floor","minutes","seconds","findElementPosition","el","box","getBoundingClientRect","parentNode","left","top","docEl","document","documentElement","body","clientLeft","scrollLeft","window","pageXOffset","clientTop","scrollTop","pageYOffset","round","getPointerPosition","event","position","boxW","offsetWidth","boxH","offsetHeight","boxY","boxX","pageY","pageX","changedTouches","y","max","min","x","fileNameFromURL","str","url","URL","pathname","index","lastIndexOf","substring","Video","state","currentTime","duration","volume","paused","dragging","containerWidth","props","width","hovered","muted","revealed","visible","undefined","sensitive","setPlayerRef","c","player","_setDimensions","setVideoRef","video","setState","setSeekRef","seek","setVolumeRef","handleClickRoot","e","stopPropagation","handlePlay","_updateTime","handlePause","handleTimeUpdate","handleVolumeMouseDown","addEventListener","handleMouseVolSlide","handleVolumeMouseUp","preventDefault","removeEventListener","isNaN","handleMouseDown","handleMouseMove","handleMouseUp","handleVideoKeyDown","key","togglePlay","handleKeyDown","frameTime","getFrameRate","toggleMute","toggleFullscreen","seekBy","handleResize","trailing","handleScroll","height","inView","innerHeight","clientHeight","deployPictureInPicture","src","handleFullscreenChange","handleMouseEnter","handleMouseLeave","toggleReveal","onToggleVisibility","handleLoadedData","autoPlay","handleProgress","lastTimeRange","buffered","length","buffer","ceil","end","handleVolumeChange","handleOpenVideo","onOpenVideo","startTime","defaultVolume","componetIndex","handleCloseVideo","onCloseVideo","cacheWidth","requestAnimationFrame","time","componentDidMount","passive","componentWillUnmount","componentWillReceiveProps","nextProps","componentDidUpdate","prevProps","prevState","frameRate","split","reduce","p","render","preview","inline","intl","alt","detailed","editable","blurhash","progress","playerStyle","preload","warning","inactive","active","formatMessage","alwaysVisible","PureComponent","propTypes","string","isRequired","number","bool","func","object","defaultProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { defineMessages, injectIntl, FormattedMessage } from 'react-intl';\nimport { is } from 'immutable';\nimport { throttle, debounce } from 'lodash';\nimport classNames from 'classnames';\nimport { isFullscreen, requestFullscreen, exitFullscreen } from '../ui/util/fullscreen';\nimport { displayMedia, useBlurhash } from '../../initial_state';\nimport Icon from 'mastodon/components/icon';\nimport Blurhash from 'mastodon/components/blurhash';\n\nconst messages = defineMessages({\n  play: { id: 'video.play', defaultMessage: 'Play' },\n  pause: { id: 'video.pause', defaultMessage: 'Pause' },\n  mute: { id: 'video.mute', defaultMessage: 'Mute sound' },\n  unmute: { id: 'video.unmute', defaultMessage: 'Unmute sound' },\n  hide: { id: 'video.hide', defaultMessage: 'Hide video' },\n  expand: { id: 'video.expand', defaultMessage: 'Expand video' },\n  close: { id: 'video.close', defaultMessage: 'Close video' },\n  fullscreen: { id: 'video.fullscreen', defaultMessage: 'Full screen' },\n  exit_fullscreen: { id: 'video.exit_fullscreen', defaultMessage: 'Exit full screen' },\n});\n\nexport const formatTime = secondsNum => {\n  let hours   = Math.floor(secondsNum / 3600);\n  let minutes = Math.floor((secondsNum - (hours * 3600)) / 60);\n  let seconds = secondsNum - (hours * 3600) - (minutes * 60);\n\n  if (hours   < 10) hours   = '0' + hours;\n  if (minutes < 10) minutes = '0' + minutes;\n  if (seconds < 10) seconds = '0' + seconds;\n\n  return (hours === '00' ? '' : `${hours}:`) + `${minutes}:${seconds}`;\n};\n\nexport const findElementPosition = el => {\n  let box;\n\n  if (el.getBoundingClientRect && el.parentNode) {\n    box = el.getBoundingClientRect();\n  }\n\n  if (!box) {\n    return {\n      left: 0,\n      top: 0,\n    };\n  }\n\n  const docEl = document.documentElement;\n  const body  = document.body;\n\n  const clientLeft = docEl.clientLeft || body.clientLeft || 0;\n  const scrollLeft = window.pageXOffset || body.scrollLeft;\n  const left       = (box.left + scrollLeft) - clientLeft;\n\n  const clientTop = docEl.clientTop || body.clientTop || 0;\n  const scrollTop = window.pageYOffset || body.scrollTop;\n  const top       = (box.top + scrollTop) - clientTop;\n\n  return {\n    left: Math.round(left),\n    top: Math.round(top),\n  };\n};\n\nexport const getPointerPosition = (el, event) => {\n  const position = {};\n  const box = findElementPosition(el);\n  const boxW = el.offsetWidth;\n  const boxH = el.offsetHeight;\n  const boxY = box.top;\n  const boxX = box.left;\n\n  let pageY = event.pageY;\n  let pageX = event.pageX;\n\n  if (event.changedTouches) {\n    pageX = event.changedTouches[0].pageX;\n    pageY = event.changedTouches[0].pageY;\n  }\n\n  position.y = Math.max(0, Math.min(1, (pageY - boxY) / boxH));\n  position.x = Math.max(0, Math.min(1, (pageX - boxX) / boxW));\n\n  return position;\n};\n\nexport const fileNameFromURL = str => {\n  const url      = new URL(str);\n  const pathname = url.pathname;\n  const index    = pathname.lastIndexOf('/');\n\n  return pathname.substring(index + 1);\n};\n\nexport default @injectIntl\nclass Video extends React.PureComponent {\n\n  static propTypes = {\n    preview: PropTypes.string,\n    frameRate: PropTypes.string,\n    src: PropTypes.string.isRequired,\n    alt: PropTypes.string,\n    width: PropTypes.number,\n    height: PropTypes.number,\n    sensitive: PropTypes.bool,\n    currentTime: PropTypes.number,\n    onOpenVideo: PropTypes.func,\n    onCloseVideo: PropTypes.func,\n    detailed: PropTypes.bool,\n    inline: PropTypes.bool,\n    editable: PropTypes.bool,\n    alwaysVisible: PropTypes.bool,\n    cacheWidth: PropTypes.func,\n    visible: PropTypes.bool,\n    onToggleVisibility: PropTypes.func,\n    deployPictureInPicture: PropTypes.func,\n    intl: PropTypes.object.isRequired,\n    blurhash: PropTypes.string,\n    autoPlay: PropTypes.bool,\n    volume: PropTypes.number,\n    muted: PropTypes.bool,\n    componetIndex: PropTypes.number,\n  };\n\n  static defaultProps = {\n    frameRate: '25',\n  };\n\n  state = {\n    currentTime: 0,\n    duration: 0,\n    volume: 0.5,\n    paused: true,\n    dragging: false,\n    containerWidth: this.props.width,\n    fullscreen: false,\n    hovered: false,\n    muted: false,\n    revealed: this.props.visible !== undefined ? this.props.visible : (displayMedia !== 'hide_all' && !this.props.sensitive || displayMedia === 'show_all'),\n  };\n\n  setPlayerRef = c => {\n    this.player = c;\n\n    if (this.player) {\n      this._setDimensions();\n    }\n  }\n\n  _setDimensions () {\n    const width = this.player.offsetWidth;\n\n    if (this.props.cacheWidth) {\n      this.props.cacheWidth(width);\n    }\n\n    this.setState({\n      containerWidth: width,\n    });\n  }\n\n  setVideoRef = c => {\n    this.video = c;\n\n    if (this.video) {\n      this.setState({ volume: this.video.volume, muted: this.video.muted });\n    }\n  }\n\n  setSeekRef = c => {\n    this.seek = c;\n  }\n\n  setVolumeRef = c => {\n    this.volume = c;\n  }\n\n  handleClickRoot = e => e.stopPropagation();\n\n  handlePlay = () => {\n    this.setState({ paused: false });\n    this._updateTime();\n  }\n\n  handlePause = () => {\n    this.setState({ paused: true });\n  }\n\n  _updateTime () {\n    requestAnimationFrame(() => {\n      if (!this.video) return;\n\n      this.handleTimeUpdate();\n\n      if (!this.state.paused) {\n        this._updateTime();\n      }\n    });\n  }\n\n  handleTimeUpdate = () => {\n    this.setState({\n      currentTime: this.video.currentTime,\n      duration:this.video.duration,\n    });\n  }\n\n  handleVolumeMouseDown = e => {\n    document.addEventListener('mousemove', this.handleMouseVolSlide, true);\n    document.addEventListener('mouseup', this.handleVolumeMouseUp, true);\n    document.addEventListener('touchmove', this.handleMouseVolSlide, true);\n    document.addEventListener('touchend', this.handleVolumeMouseUp, true);\n\n    this.handleMouseVolSlide(e);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  handleVolumeMouseUp = () => {\n    document.removeEventListener('mousemove', this.handleMouseVolSlide, true);\n    document.removeEventListener('mouseup', this.handleVolumeMouseUp, true);\n    document.removeEventListener('touchmove', this.handleMouseVolSlide, true);\n    document.removeEventListener('touchend', this.handleVolumeMouseUp, true);\n  }\n\n  handleMouseVolSlide = throttle(e => {\n    const { x } = getPointerPosition(this.volume, e);\n\n    if(!isNaN(x)) {\n      this.setState({ volume: x }, () => {\n        this.video.volume = x;\n      });\n    }\n  }, 15);\n\n  handleMouseDown = e => {\n    document.addEventListener('mousemove', this.handleMouseMove, true);\n    document.addEventListener('mouseup', this.handleMouseUp, true);\n    document.addEventListener('touchmove', this.handleMouseMove, true);\n    document.addEventListener('touchend', this.handleMouseUp, true);\n\n    this.setState({ dragging: true });\n    this.video.pause();\n    this.handleMouseMove(e);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  handleMouseUp = () => {\n    document.removeEventListener('mousemove', this.handleMouseMove, true);\n    document.removeEventListener('mouseup', this.handleMouseUp, true);\n    document.removeEventListener('touchmove', this.handleMouseMove, true);\n    document.removeEventListener('touchend', this.handleMouseUp, true);\n\n    this.setState({ dragging: false });\n    this.video.play();\n  }\n\n  handleMouseMove = throttle(e => {\n    const { x } = getPointerPosition(this.seek, e);\n    const currentTime = this.video.duration * x;\n\n    if (!isNaN(currentTime)) {\n      this.setState({ currentTime }, () => {\n        this.video.currentTime = currentTime;\n      });\n    }\n  }, 15);\n\n  seekBy (time) {\n    const currentTime = this.video.currentTime + time;\n\n    if (!isNaN(currentTime)) {\n      this.setState({ currentTime }, () => {\n        this.video.currentTime = currentTime;\n      });\n    }\n  }\n\n  handleVideoKeyDown = e => {\n    // On the video element or the seek bar, we can safely use the space bar\n    // for playback control because there are no buttons to press\n\n    if (e.key === ' ') {\n      e.preventDefault();\n      e.stopPropagation();\n      this.togglePlay();\n    }\n  }\n\n  handleKeyDown = e => {\n    const frameTime = 1 / this.getFrameRate();\n\n    switch(e.key) {\n    case 'k':\n      e.preventDefault();\n      e.stopPropagation();\n      this.togglePlay();\n      break;\n    case 'm':\n      e.preventDefault();\n      e.stopPropagation();\n      this.toggleMute();\n      break;\n    case 'f':\n      e.preventDefault();\n      e.stopPropagation();\n      this.toggleFullscreen();\n      break;\n    case 'j':\n      e.preventDefault();\n      e.stopPropagation();\n      this.seekBy(-10);\n      break;\n    case 'l':\n      e.preventDefault();\n      e.stopPropagation();\n      this.seekBy(10);\n      break;\n    case ',':\n      e.preventDefault();\n      e.stopPropagation();\n      this.seekBy(-frameTime);\n      break;\n    case '.':\n      e.preventDefault();\n      e.stopPropagation();\n      this.seekBy(frameTime);\n      break;\n    }\n\n    // If we are in fullscreen mode, we don't want any hotkeys\n    // interacting with the UI that's not visible\n\n    if (this.state.fullscreen) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (e.key === 'Escape') {\n        exitFullscreen();\n      }\n    }\n  }\n\n  togglePlay = () => {\n    if (this.state.paused) {\n      this.setState({ paused: false }, () => this.video.play());\n    } else {\n      this.setState({ paused: true }, () => this.video.pause());\n    }\n  }\n\n  toggleFullscreen = () => {\n    if (isFullscreen()) {\n      exitFullscreen();\n    } else {\n      requestFullscreen(this.player);\n    }\n  }\n\n  componentDidMount () {\n    document.addEventListener('fullscreenchange', this.handleFullscreenChange, true);\n    document.addEventListener('webkitfullscreenchange', this.handleFullscreenChange, true);\n    document.addEventListener('mozfullscreenchange', this.handleFullscreenChange, true);\n    document.addEventListener('MSFullscreenChange', this.handleFullscreenChange, true);\n\n    window.addEventListener('scroll', this.handleScroll);\n    window.addEventListener('resize', this.handleResize, { passive: true });\n  }\n\n  componentWillUnmount () {\n    window.removeEventListener('scroll', this.handleScroll);\n    window.removeEventListener('resize', this.handleResize);\n\n    document.removeEventListener('fullscreenchange', this.handleFullscreenChange, true);\n    document.removeEventListener('webkitfullscreenchange', this.handleFullscreenChange, true);\n    document.removeEventListener('mozfullscreenchange', this.handleFullscreenChange, true);\n    document.removeEventListener('MSFullscreenChange', this.handleFullscreenChange, true);\n\n    if (!this.state.paused && this.video && this.props.deployPictureInPicture) {\n      this.props.deployPictureInPicture('video', {\n        src: this.props.src,\n        currentTime: this.video.currentTime,\n        muted: this.video.muted,\n        volume: this.video.volume,\n      });\n    }\n  }\n\n  componentWillReceiveProps (nextProps) {\n    if (!is(nextProps.visible, this.props.visible) && nextProps.visible !== undefined) {\n      this.setState({ revealed: nextProps.visible });\n    }\n  }\n\n  componentDidUpdate (prevProps, prevState) {\n    if (prevState.revealed && !this.state.revealed && this.video) {\n      this.video.pause();\n    }\n  }\n\n  handleResize = debounce(() => {\n    if (this.player) {\n      this._setDimensions();\n    }\n  }, 250, {\n    trailing: true,\n  });\n\n  handleScroll = throttle(() => {\n    if (!this.video) {\n      return;\n    }\n\n    const { top, height } = this.video.getBoundingClientRect();\n    const inView = (top <= (window.innerHeight || document.documentElement.clientHeight)) && (top + height >= 0);\n\n    if (!this.state.paused && !inView) {\n      this.video.pause();\n\n      if (this.props.deployPictureInPicture) {\n        this.props.deployPictureInPicture('video', {\n          src: this.props.src,\n          currentTime: this.video.currentTime,\n          muted: this.video.muted,\n          volume: this.video.volume,\n        });\n      }\n\n      this.setState({ paused: true });\n    }\n  }, 150, { trailing: true })\n\n  handleFullscreenChange = () => {\n    this.setState({ fullscreen: isFullscreen() });\n  }\n\n  handleMouseEnter = () => {\n    this.setState({ hovered: true });\n  }\n\n  handleMouseLeave = () => {\n    this.setState({ hovered: false });\n  }\n\n  toggleMute = () => {\n    const muted = !this.video.muted;\n\n    this.setState({ muted }, () => {\n      this.video.muted = muted;\n    });\n  }\n\n  toggleReveal = () => {\n    if (this.props.onToggleVisibility) {\n      this.props.onToggleVisibility();\n    } else {\n      this.setState({ revealed: !this.state.revealed });\n    }\n  }\n\n  handleLoadedData = () => {\n    const { currentTime, volume, muted, autoPlay } = this.props;\n\n    if (currentTime) {\n      this.video.currentTime = currentTime;\n    }\n\n    if (volume !== undefined) {\n      this.video.volume = volume;\n    }\n\n    if (muted !== undefined) {\n      this.video.muted = muted;\n    }\n\n    if (autoPlay) {\n      this.video.play();\n    }\n  }\n\n  handleProgress = () => {\n    const lastTimeRange = this.video.buffered.length - 1;\n\n    if (lastTimeRange > -1) {\n      this.setState({ buffer: Math.ceil(this.video.buffered.end(lastTimeRange) / this.video.duration * 100) });\n    }\n  }\n\n  handleVolumeChange = () => {\n    this.setState({ volume: this.video.volume, muted: this.video.muted });\n  }\n\n  handleOpenVideo = () => {\n    this.video.pause();\n\n    this.props.onOpenVideo({\n      startTime: this.video.currentTime,\n      autoPlay: !this.state.paused,\n      defaultVolume: this.state.volume,\n      componetIndex: this.props.componetIndex,\n    });\n  }\n\n  handleCloseVideo = () => {\n    this.video.pause();\n    this.props.onCloseVideo();\n  }\n\n  getFrameRate () {\n    if (this.props.frameRate && isNaN(this.props.frameRate)) {\n      // The frame rate is returned as a fraction string so we\n      // need to convert it to a number\n\n      return this.props.frameRate.split('/').reduce((p, c) => p / c);\n    }\n\n    return this.props.frameRate;\n  }\n\n  render () {\n    const { preview, src, inline, onOpenVideo, onCloseVideo, intl, alt, detailed, sensitive, editable, blurhash } = this.props;\n    const { containerWidth, currentTime, duration, volume, buffer, dragging, paused, fullscreen, hovered, muted, revealed } = this.state;\n    const progress = Math.min((currentTime / duration) * 100, 100);\n    const playerStyle = {};\n\n    let { width, height } = this.props;\n\n    if (inline && containerWidth) {\n      width  = containerWidth;\n      height = containerWidth / (16/9);\n\n      playerStyle.height = height;\n    }\n\n    let preload;\n\n    if (this.props.currentTime || fullscreen || dragging) {\n      preload = 'auto';\n    } else if (detailed) {\n      preload = 'metadata';\n    } else {\n      preload = 'none';\n    }\n\n    let warning;\n\n    if (sensitive) {\n      warning = <FormattedMessage id='status.sensitive_warning' defaultMessage='Sensitive content' />;\n    } else {\n      warning = <FormattedMessage id='status.media_hidden' defaultMessage='Media hidden' />;\n    }\n\n    return (\n      <div\n        role='menuitem'\n        className={classNames('video-player', { inactive: !revealed, detailed, inline: inline && !fullscreen, fullscreen, editable })}\n        style={playerStyle}\n        ref={this.setPlayerRef}\n        onMouseEnter={this.handleMouseEnter}\n        onMouseLeave={this.handleMouseLeave}\n        onClick={this.handleClickRoot}\n        onKeyDown={this.handleKeyDown}\n        tabIndex={0}\n      >\n        <Blurhash\n          hash={blurhash}\n          className={classNames('media-gallery__preview', {\n            'media-gallery__preview--hidden': revealed,\n          })}\n          dummy={!useBlurhash}\n        />\n\n        {(revealed || editable) && <video\n          ref={this.setVideoRef}\n          src={src}\n          poster={preview}\n          preload={preload}\n          role='button'\n          tabIndex='0'\n          aria-label={alt}\n          title={alt}\n          width={width}\n          height={height}\n          volume={volume}\n          onClick={this.togglePlay}\n          onKeyDown={this.handleVideoKeyDown}\n          onPlay={this.handlePlay}\n          onPause={this.handlePause}\n          onLoadedData={this.handleLoadedData}\n          onProgress={this.handleProgress}\n          onVolumeChange={this.handleVolumeChange}\n        />}\n\n        <div className={classNames('spoiler-button', { 'spoiler-button--hidden': revealed || editable })}>\n          <button type='button' className='spoiler-button__overlay' onClick={this.toggleReveal}>\n            <span className='spoiler-button__overlay__label'>{warning}</span>\n          </button>\n        </div>\n\n        <div className={classNames('video-player__controls', { active: paused || hovered })}>\n          <div className='video-player__seek' onMouseDown={this.handleMouseDown} ref={this.setSeekRef}>\n            <div className='video-player__seek__buffer' style={{ width: `${buffer}%` }} />\n            <div className='video-player__seek__progress' style={{ width: `${progress}%` }} />\n\n            <span\n              className={classNames('video-player__seek__handle', { active: dragging })}\n              tabIndex='0'\n              style={{ left: `${progress}%` }}\n              onKeyDown={this.handleVideoKeyDown}\n            />\n          </div>\n\n          <div className='video-player__buttons-bar'>\n            <div className='video-player__buttons left'>\n              <button type='button' title={intl.formatMessage(paused ? messages.play : messages.pause)} aria-label={intl.formatMessage(paused ? messages.play : messages.pause)} className='player-button' onClick={this.togglePlay} autoFocus={detailed}><Icon id={paused ? 'play' : 'pause'} fixedWidth /></button>\n              <button type='button' title={intl.formatMessage(muted ? messages.unmute : messages.mute)} aria-label={intl.formatMessage(muted ? messages.unmute : messages.mute)} className='player-button' onClick={this.toggleMute}><Icon id={muted ? 'volume-off' : 'volume-up'} fixedWidth /></button>\n\n              <div className={classNames('video-player__volume', { active: this.state.hovered })} onMouseDown={this.handleVolumeMouseDown} ref={this.setVolumeRef}>\n                <div className='video-player__volume__current' style={{ width: `${volume * 100}%` }} />\n\n                <span\n                  className={classNames('video-player__volume__handle')}\n                  tabIndex='0'\n                  style={{ left: `${volume * 100}%` }}\n                />\n              </div>\n\n              {(detailed || fullscreen) && (\n                <span className='video-player__time'>\n                  <span className='video-player__time-current'>{formatTime(Math.floor(currentTime))}</span>\n                  <span className='video-player__time-sep'>/</span>\n                  <span className='video-player__time-total'>{formatTime(Math.floor(duration))}</span>\n                </span>\n              )}\n            </div>\n\n            <div className='video-player__buttons right'>\n              {(!onCloseVideo && !editable && !fullscreen && !this.props.alwaysVisible) && <button type='button' title={intl.formatMessage(messages.hide)} aria-label={intl.formatMessage(messages.hide)} className='player-button' onClick={this.toggleReveal}><Icon id='eye-slash' fixedWidth /></button>}\n              {(!fullscreen && onOpenVideo) && <button type='button' title={intl.formatMessage(messages.expand)} aria-label={intl.formatMessage(messages.expand)} className='player-button' onClick={this.handleOpenVideo}><Icon id='expand' fixedWidth /></button>}\n              {onCloseVideo && <button type='button' title={intl.formatMessage(messages.close)} aria-label={intl.formatMessage(messages.close)} className='player-button' onClick={this.handleCloseVideo}><Icon id='compress' fixedWidth /></button>}\n              <button type='button' title={intl.formatMessage(fullscreen ? messages.exit_fullscreen : messages.fullscreen)} aria-label={intl.formatMessage(fullscreen ? messages.exit_fullscreen : messages.fullscreen)} className='player-button' onClick={this.toggleFullscreen}><Icon id={fullscreen ? 'compress' : 'arrows-alt'} fixedWidth /></button>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n}\n"]},"metadata":{"react-intl":{"messages":[{"id":"video.play","defaultMessage":"Play"},{"id":"video.pause","defaultMessage":"Pause"},{"id":"video.mute","defaultMessage":"Mute sound"},{"id":"video.unmute","defaultMessage":"Unmute sound"},{"id":"video.hide","defaultMessage":"Hide video"},{"id":"video.expand","defaultMessage":"Expand video"},{"id":"video.close","defaultMessage":"Close video"},{"id":"video.fullscreen","defaultMessage":"Full screen"},{"id":"video.exit_fullscreen","defaultMessage":"Exit full screen"},{"id":"status.sensitive_warning","defaultMessage":"Sensitive content"},{"id":"status.media_hidden","defaultMessage":"Media hidden"}]}},"sourceType":"module"}